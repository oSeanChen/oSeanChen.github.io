<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>UnitTest(1) - Junit 5 基本介紹及建立測試程式</title>
      <link href="/2024/10/04/UnitTest-1-Junit-5-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%B4%B9%E5%8F%8A%E5%BB%BA%E7%AB%8B%E6%B8%AC%E8%A9%A6%E7%A8%8B%E5%BC%8F/"/>
      <url>/2024/10/04/UnitTest-1-Junit-5-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%B4%B9%E5%8F%8A%E5%BB%BA%E7%AB%8B%E6%B8%AC%E8%A9%A6%E7%A8%8B%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<p>相信有許多人知道開發有一個重要的環節就是進行測試，不管是透過直接操作功能、打 API 或是程式內部執行測是程式等等都是測試的一種，今天要介紹的單元測試就是指測試程式碼最小功能單位的運作。</p><h2 id="單元測試目的"><a href="#單元測試目的" class="headerlink" title="單元測試目的"></a>單元測試目的</h2><ul><li>測試功能運作邏輯</li><li>確保不會改壞程式</li></ul><h2 id="單元測試特性"><a href="#單元測試特性" class="headerlink" title="單元測試特性"></a>單元測試特性</h2><ul><li>一次只測一個功能點或一個 api</li><li>可被自動化運行</li><li>各單元測試互相獨立，不依賴</li></ul><h2 id="JUnit-5-介紹"><a href="#JUnit-5-介紹" class="headerlink" title="JUnit 5 介紹"></a>JUnit 5 介紹</h2><p>Java 常見的開源測試框架，目前最新版本為 JUnit5，使用了 Java 8 及更高版本的 Java 語言特性。 進行單元測試的可讀性更強，編寫更容易，且可以輕鬆擴充。</p><h3 id="版本相容注意"><a href="#版本相容注意" class="headerlink" title="版本相容注意"></a>版本相容注意</h3><table><thead><tr><th><strong>Spring Boot 版本</strong></th><th><strong>相容的 JUnit 版本</strong></th></tr></thead><tbody><tr><td>≤ 2.1</td><td>JUnit 4</td></tr><tr><td>2.2, 2.3</td><td>JUnit 4、JUnit 5</td></tr><tr><td>≥ 2.4</td><td>JUnit 5</td></tr></tbody></table><h2 id="Spring-Boot-導入-JUnit"><a href="#Spring-Boot-導入-JUnit" class="headerlink" title="Spring Boot 導入 JUnit"></a>Spring Boot 導入 JUnit</h2><p>通常只要建立一般 web 的專案就會導入 spring-boot-starter-test 裡面就會包含 Junit 測試框架了</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>導入注意</p><ul><li>測試程式放到 test 資料夾</li><li>class 名稱保持原本 class 加上 Test 為結尾</li><li>測試的 package 結構和原本一致 (下圖紅框及橘框的結構)## 建立一個測試程式</li></ul><p>先建立一個 Calculator 類別並有一個 add 方法:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>依照前面導入注意在 test 資料夾下面建構與 main 相同的結構，並建立一個 class 並依照對應的命名規則來建立。</p><p>或是你使用 intellij 可以對這個個類別或是方法按下 Alt + Insert (Windows) 或 command + N (Mac) 來叫出特殊功能選單並選 test 就可以看到編輯器會自動幫我們建立對應的 package 結構至 test 內，並且可以選擇自動產生哪些對應內部 class 有的方法至新的測試程式內。<br><img src="https://ithelp.ithome.com.tw/upload/images/20240926/20150977G3JJ1bKSQt.png" alt="https://ithelp.ithome.com.tw/upload/images/20240926/20150977G3JJ1bKSQt.png"></p><h2 id="建立一個測試程式"><a href="#建立一個測試程式" class="headerlink" title="建立一個測試程式"></a>建立一個測試程式</h2><p>先建立一個 Calculator 類別並有一個 add 方法:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>依照前面導入注意在 test 資料夾下面建構與 main 相同的結構，並建立一個 class 並依照對應的命名規則來建立。</p><p>或是你使用 intellij 可以對這個個類別或是方法按下 Alt + Insert (Windows) 或 command + N (Mac) 來叫出特殊功能選單並選 test 就可以看到編輯器會自動幫我們建立對應的 package 結構至 test 內，並且可以選擇自動產生哪些對應內部 class 有的方法至新的測試程式內。<br><img src="https://ithelp.ithome.com.tw/upload/images/20240926/20150977bWVt0xm0OU.png" alt="https://ithelp.ithome.com.tw/upload/images/20240926/20150977bWVt0xm0OU.png"></p><p>建立測試程式測試 add 方法，要在方法上面加入 @Test 告訴 Spring Boot 這是測試程式</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CalculatorTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">testAdd</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Calculator</span> <span class="variable">calc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Calculator</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> calc.add(x, y);</span><br><span class="line"></span><br><span class="line">        assertEquals(<span class="number">2</span>, result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>assertEquals() 就是斷言方法，可以幫助我們驗證預期結果，這邊就先確定測是可以正常運行，我們放入第 1 個參數是預期值及第 2 個是實際結果，如果帶入的兩個值相等就會通過測試。<br><img src="https://ithelp.ithome.com.tw/upload/images/20240926/20150977L9TZTv5s5U.png" alt="https://ithelp.ithome.com.tw/upload/images/20240926/20150977L9TZTv5s5U.png"></p><p>如果有寫好多個測試方法想要一次跑完，就可以點選 class 左方的圖示一次執行全部的測試<br><img src="https://ithelp.ithome.com.tw/upload/images/20240927/20150977h7RY71N0Z7.png" alt="https://ithelp.ithome.com.tw/upload/images/20240927/20150977h7RY71N0Z7.png"></p><p>這一篇先完成基本的測試方法建立，下一篇會詳細介紹更多的斷言用法。</p><hr><p>Ref:</p><ul><li>Java 工程師必備！Spring Boot 零基礎入門 （hahow 課程）</li><li><a href="https://junit.org/junit5/docs/current/user-guide/">JUnit 5 User Guide</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
          <category> Unit Test </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> JUnit 5 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lombok</title>
      <link href="/2024/09/30/Lombok/"/>
      <url>/2024/09/30/Lombok/</url>
      
        <content type="html"><![CDATA[<p>前面在介紹使用 Spring Data JPA 的時候，在關聯的部分有碰到一些使用 Lombok 的問題，這篇就來介紹一下個別的註解作用，也可以讓大家使用的時候也知道背後運作的邏輯。</p><p>Lombok 是一個套件可以幫助我們定義物件時省去許多重複冗長的 code ，可以大幅提升開發效率，下面是常見的註解。</p><h2 id="套件引入"><a href="#套件引入" class="headerlink" title="套件引入"></a>套件引入</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="常用註解介紹"><a href="#常用註解介紹" class="headerlink" title="常用註解介紹"></a>常用註解介紹</h2><p><img src="https://ithelp.ithome.com.tw/upload/images/20240928/20150977eUFDzWPaBM.png" alt="https://ithelp.ithome.com.tw/upload/images/20240928/20150977eUFDzWPaBM.png"></p><p>小補充: 其實有很多方法如果是用 Intellij 都可以在物件內點選右鍵使用 generate 產生，但是如果可以用一個註解就解決這些還是來得方便很多，但建議剛開始新手可以先用這些 generate 來產生對應方法，也可以藉此了解每個註解背後的原始 code 是怎麼運作。</p><p><img src="https://ithelp.ithome.com.tw/upload/images/20240928/20150977gPXIq87igK.png" alt="https://ithelp.ithome.com.tw/upload/images/20240928/20150977gPXIq87igK.png"></p><p><img src="https://ithelp.ithome.com.tw/upload/images/20240928/20150977mvcWRtENVH.png" alt="https://ithelp.ithome.com.tw/upload/images/20240928/20150977mvcWRtENVH.png"></p><h3 id="Getter-x2F-Setter"><a href="#Getter-x2F-Setter" class="headerlink" title="@Getter &#x2F; @Setter"></a>@Getter &#x2F; @Setter</h3><p>進行物件導向的撰寫必備的方法，用來取得或修改物件屬性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">product</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(原始定義方法) 效果同上</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">product</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ToString"><a href="#ToString" class="headerlink" title="@ToString"></a>@ToString</h3><p>自動 override <code>toString()</code>  方法，使用時會印出所有屬性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">product</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(註解生效原始碼) 效果同上</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">product</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Product&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;id=&quot;</span> + id +</span><br><span class="line">                <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="NoArgsConstructor-x2F-AllArgsConstructor-x2F-RequiredArgsConstructor"><a href="#NoArgsConstructor-x2F-AllArgsConstructor-x2F-RequiredArgsConstructor" class="headerlink" title="@NoArgsConstructor &#x2F; @AllArgsConstructor &#x2F; @RequiredArgsConstructor"></a><strong>@NoArgsConstructor &#x2F; @AllArgsConstructor &#x2F; @RequiredArgsConstructor</strong></h3><p>起始子 (Constructor) 的創建，有三種註解是根據創建時是否包含內部屬性作為參數來決定。</p><p>例如有個 product 有 id, name 的屬性</p><ul><li><strong>@AllArgsConstructo</strong>r 自動帶入當前所有屬性作為可建立時的值</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">product</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(註解生效原始碼) 效果同上，使用註解表示我們獲得一個創建物件時可以帶入這些屬性並賦予值的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">product</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">(Integer id, String name)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>@NoArgsConstructor</strong> 自動產生一個空的起始子</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">product</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(註解生效原始碼) 效果同上，創建時就只是建立出空的物件，但沒辦法帶入任何屬性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">product</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>@RequiredArgsConstructor</strong> 可以讓你建立一個包含 “final 修飾屬性” 的起始子。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequiredArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">product</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(註解生效原始碼) 效果同上，使用註解後可以看到只有帶 final 的屬性可以被帶入建立</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">product</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">final</span> Integer id;</span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">Product</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>**補充如果所有的屬性都沒有用 final 修飾的話，那就會生成一個沒有參數的起始子，等同 @NoArgsConstructor</p><h3 id="EqualsAndHashCode"><a href="#EqualsAndHashCode" class="headerlink" title="@EqualsAndHashCode"></a>@EqualsAndHashCode</h3><p>可以產生 <code>equals(Object other)</code>  和  <code>hashcode()</code>  方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(註解生效原始碼) 效果同上，可以看到這兩個方法會 Override 原本 equals(0 和 hashcode()</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> price;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">equals</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span> == o) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="literal">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> (Product) o;</span><br><span class="line">        <span class="keyword">return</span> id == product.id &amp;&amp; price == product.price &amp;&amp; Objects.equals(name, product.name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Objects.hash(id, name, price);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>舉例來說如果比較兩個物件，內部屬性相同</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(MybatisDemoApplication.class, args);</span><br><span class="line"><span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> Product.builder()</span><br><span class="line">.id(<span class="number">1</span>)</span><br><span class="line">.name(<span class="string">&quot;book&quot;</span>)</span><br><span class="line">.price(<span class="number">100</span>)</span><br><span class="line">.build();</span><br><span class="line"></span><br><span class="line"><span class="type">Product</span> <span class="variable">product1</span> <span class="operator">=</span> Product.builder()</span><br><span class="line">.id(<span class="number">1</span>)</span><br><span class="line">.name(<span class="string">&quot;book&quot;</span>)</span><br><span class="line">.price(<span class="number">100</span>)</span><br><span class="line">.build();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 判斷物件是否相等</span></span><br><span class="line">System.out.println(product.equals(product1));</span><br><span class="line">System.out.println(product.hashCode() == product1.hashCode());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>預設的狀況會是兩個都是 False，因為只要新產生一個物件預設就是會有不同的記憶體位置，所以 reference 不同導致這兩個比較都 False，但是我們透過註解改寫上面兩個方法可以根據內部屬性的值是否都相等來判斷這兩個物件是否相等，hashcode 也會將內部的屬性值帶入去比較，就會得到兩個都是 True</p><h3 id="Data"><a href="#Data" class="headerlink" title="@Data"></a><strong>@Data</strong></h3><p>等於同時加了以下注解</p><ul><li>@Getter</li><li>@Setter</li><li>@ToString</li><li>@EqualsAndHashCode</li><li>@RequiredArgsConstructor</li></ul><p>使用上可以讓 code 很簡潔，但須要注意這個註解實做哪些方法，才不會不知道為什麼有些東西不是如你所想的在運作，這註解也會導致一些部分的問題，像是有物件繼承時，@EqualsAndHashCode 這註解預設是不考慮父類別的屬性，可能就會導致你物件比較時會出錯。詳細可以閱讀參考資料<a href="https://blog.cashwu.com/blog/2024/java-lombok-data-annotation-equals-and-hashcode">4</a>。</p><h3 id="Value"><a href="#Value" class="headerlink" title="@Value"></a>@Value</h3><p>等於同時加了以下注解，通常用來宣告給只讀取資料的物件使用，不提供任何 Setter</p><ul><li>@Getter</li><li>@ToString</li><li>@EqualsAndHashCode</li><li>@RequiredArgsConstructor</li></ul><h3 id="Builder"><a href="#Builder" class="headerlink" title="@Builder"></a>@Builder</h3><p>可以讓你使用特殊的流式語法來創建物件，簡化物件的創建過程。用了建造者模式（Builder Pattern），使得創建物件時更具靈活性和可讀性。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Builder</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> price;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>流式寫法，可讀性提高，也可以選擇性創建屬性提高靈活性，例如你可以只帶入 name , price 不帶 id 創建。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> Product.builder()</span><br><span class="line">.id(<span class="number">1</span>)</span><br><span class="line">.name(<span class="string">&quot;book&quot;</span>)</span><br><span class="line">.price(<span class="number">100</span>)</span><br><span class="line">.build();</span><br></pre></td></tr></table></figure><p>不過使用這個通常還是會搭配 @Setter 因為有許多時候還是會操作物件去進行 set，所以通常 Builder 會配合 @Data 一起使用。</p><h3 id="Slf4j"><a href="#Slf4j" class="headerlink" title="@Slf4j"></a>@Slf4j</h3><p>自動產生 Log 的物件可以提供當前物件內使用，除了 @Slf4j 之外，lombok 也提供其他日誌框架，像是 @Log、@Log4j…等</p><p>註解使用後就可以直接使用 Slf4j 相關的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogDemo</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(原始定義方法)未使用需自行建立 Slf4j 物件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogDemo</span> &#123;</span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> java.util.logging.<span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> java.util.logging.Logger.getLogger(LogDemo.class.getName());</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String... args)</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="總結"><a href="#總結" class="headerlink" title="總結:"></a>總結:</h2><p>其實在進一步認識了解之後，發現這個套件其實有蠻多討論針對是否要引用，甚至有許多團隊開發會不建議使用，其中我也是了解了一下這些部分，工作開發上我有碰過有使用也有碰過沒有使用，自己是開發個人小專案基本會使用，但多人開發上其實團隊內需要好好討論是否使用及一些規範需要訂出來，畢竟有許多缺點都是多人協作下會有問題，下面總結一些優缺點:</p><p>優點：</p><ul><li>提高開發效率：透過註解的形式自動生成方法，讓代碼變得簡潔</li><li>減少維護成本：屬性做修改時，也簡化維護這些屬性所生成的 getter&#x2F;setter 方法等</li></ul><p>缺點：</p><ul><li>侵入性高：如果有一個人使用了 Lombok，那麼其他依賴這個專案的專案或是協作開發者，就須要安裝 IDE 插件或是引入套件。</li><li>技術債提升：如果對於各種註解的底層原理不理解的話，很容易產生問題，像是 @Data 這種簡化多種註解及方法的就需要考量是否該使用。</li><li>影響升級：如需要升級到某個新版本的 JDK 的時候，若在 Lombok 中不支持的話就會受到影響。</li><li>破壞封裝：使用 getter, setter 註解後會讓每個屬性的方法都開放，如果有些部分需要自行控制就會破壞封裝性，可能會讓一些部份不被</li></ul><hr><p>參考資料:</p><ol><li><a href="https://projectlombok.org/">projectlombok</a></li><li><a href="https://kucw.io/blog/2020/3/java-lombok/">五分鐘學會 Lombok 用法</a></li><li><a href="https://www.cnblogs.com/hollischuang/p/12294100.html">新來個技術總監，禁止我們使用 Lombok！</a></li><li><a href="https://blog.cashwu.com/blog/2024/java-lombok-data-annotation-equals-and-hashcode">Lombok @Data 的魔法與陷阱：深入探討 @EqualsAndHashCode</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
          <category> Lombok </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Spring Data Jpa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Data JPA (4) 資料庫關聯 1 : N</title>
      <link href="/2024/09/27/SpringBoot/Spring-Data-JPA-%EF%BC%884%EF%BC%89%E8%B3%87%E6%96%99%E5%BA%AB%E9%97%9C%E8%81%AF-1-N/"/>
      <url>/2024/09/27/SpringBoot/Spring-Data-JPA-%EF%BC%884%EF%BC%89%E8%B3%87%E6%96%99%E5%BA%AB%E9%97%9C%E8%81%AF-1-N/</url>
      
        <content type="html"><![CDATA[<p><img src="https://ithelp.ithome.com.tw/upload/images/20240904/20150977s7zH4hK4Ja.png" alt="https://ithelp.ithome.com.tw/upload/images/20240904/20150977s7zH4hK4Ja.png"></p><h2 id="一對多-1-N"><a href="#一對多-1-N" class="headerlink" title="一對多 1 : N"></a>一對多 1 : N</h2><p>一對多關聯可以看到，products 和 reviews 這兩張表的關係，一個商品會有多則評論，所以設計上會在 reviews 裡面紀錄 product_id 來關聯回去 products。會應用到 <code>@OneToMany</code> <code>@ManyToOne</code> 這兩種註解來根據你是哪一方進行關聯。</p><p>建立父實體 reviews，標記 @ManyToOne</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table(name = &quot;reviews&quot;)</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(&#123;&quot;product&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Review</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String comment;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> rating;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;product_id&quot;, referencedColumnName = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Product product;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意 reviews 是多的那邊所以用 <code>@ManyToOne</code> ，和一對一配置相同，如果是父實體就會用上 @JoinColumn 並且標出 FK 的欄位。</p><p>建立子實體 products，標記 @OneToMany</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table(name = &quot;products&quot;)</span></span><br><span class="line"><span class="comment">//@JsonIgnoreProperties(&#123;&quot;productDetail&quot;&#125;)</span></span><br><span class="line"><span class="comment">//@JsonIgnoreProperties(&#123;&quot;reviews&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne(cascade = CascadeType.ALL, fetch = FetchType.EAGER)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;product_detail_id&quot;, referencedColumnName = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ProductDetails productDetails;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(cascade = CascadeType.ALL, fetch = FetchType.LAZY, mappedBy = &quot;product&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Review&gt; reviews;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>這邊也配置雙向關聯回去，但是要記得使用 @JsonIgnoreProperties 來指定某些屬性不要序列化成 Json 避免雙向循環，假設你是純粹要把關聯用再查 Review 時可以帶出關聯的 Product 就可以不用在 Product 的 Entity 寫 @OneToMany 的部分，但如果要從 Product 關聯回去 Review 就必須兩邊都綁定，因為 Product 在這邊屬於被子實體，要 mappedBy 確定父實體的關聯屬性，沒辦法單方向關聯回去。</p><p>這邊我們讓 Product 可以關聯回去 Review 所以可以查到下面這樣</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;最後生還者&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">59.99</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;由 Naughty Dog 開發的動作冒險遊戲。&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;productDetails&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;developer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Naughty Dog&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;publisher&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Sony Interactive Entertainment&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;releaseDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2013-06-14&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;languageSupport&quot;</span><span class="punctuation">:</span> <span class="string">&quot;English, Japanese, Chinese&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reviews&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;comment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;這是一款令人驚嘆的遊戲，擁有引人入勝的故事和令人驚嘆的視覺效果！&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rating&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">11</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;comment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;遊戲不錯，但希望戰鬥系統能更具挑戰性。&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rating&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">12</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;comment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;每一秒鐘都充滿樂趣，真的是一款精緻的遊戲！&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rating&quot;</span><span class="punctuation">:</span> <span class="number">5</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;巫師3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">49.99</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;由 CD Projekt Red 開發的開放世界角色扮演遊戲。&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;productDetails&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;developer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CD Projekt Red&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;publisher&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CD Projekt&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;releaseDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2015-05-19&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;languageSupport&quot;</span><span class="punctuation">:</span> <span class="string">&quot;English, Chinese, Polish&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;reviews&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;comment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;很棒的遊戲，但某些部分的節奏感覺有點慢。&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rating&quot;</span><span class="punctuation">:</span> <span class="number">4</span></span><br><span class="line">      <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">13</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;comment&quot;</span><span class="punctuation">:</span> <span class="string">&quot;畫質很好，但劇情有點單調。&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;rating&quot;</span><span class="punctuation">:</span> <span class="number">3</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">// ......略</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>關於一對多的設置上其實跟一對一很類似，主要都是要區別出哪個是父實體和子實體，一開始規劃資料表時就可以根據此來配置關聯的欄位，實際撈取資料上也要根據需求決定是否需要雙向關聯，回傳的資料上也可以採用 DTO 的方式可以回傳需要的欄位，中間實作上也要避免雙向循環，這樣就可以好好應用這些關聯方式，下一篇來介紹多對多的部分。</p><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref:"></a>Ref:</h2><ul><li><a href="https://chikuwa-tech-study.blogspot.com/2024/06/spring-boot-jpa-one-to-many-relationship-and-bidirectional-association.html">使用 JPA 配置資料表關聯（以一對多關聯為例）</a></li><li><a href="https://openhome.cc/Gossip/EJB3Gossip/BidirectionalAssociation.html">雙向關聯</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Spring Data Jpa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Data JPA (3) 資料庫關聯 1 : 1</title>
      <link href="/2024/09/27/SpringBoot/Spring-Data-JPA-%EF%BC%883%EF%BC%89%E8%B3%87%E6%96%99%E5%BA%AB%E9%97%9C%E8%81%AF-1-1/"/>
      <url>/2024/09/27/SpringBoot/Spring-Data-JPA-%EF%BC%883%EF%BC%89%E8%B3%87%E6%96%99%E5%BA%AB%E9%97%9C%E8%81%AF-1-1/</url>
      
        <content type="html"><![CDATA[<p>操作 Spring Data JPA 需要對於資料表之間的關聯與配置有一定的了解，可以幫助你在規劃資料庫及撈取資料上有很大的幫助。</p><p>後續文章會依序介紹常見的幾種關聯操作，若這邊設計一個情境開設一個電商平台，賣電玩的商品，會有一些表紀錄商品的一些資訊，我們可以藉此來探討資料表之間的關聯。主要有下面這幾張表:</p><ul><li>products 商品資訊，記錄名稱 (name)、價錢 (price)、描述 (description)等資訊</li><li>product_details 商品細節，紀錄開發商 (developer)、發行商 (publisher)、發行日 (release_date)、支援語言 (language_support)等資訊</li><li>reviews 評論，紀錄評論者 (reviewer_name)、內容 (comment)、分數 (rating)</li><li>tags 標籤，遊戲類型及各式分類標註 (name)</li><li>product_tags 商品及標籤的關聯表 (多對多需要)</li></ul><p><img src="https://ithelp.ithome.com.tw/upload/images/20240904/201509775cEGhSRpBL.png" alt="https://ithelp.ithome.com.tw/upload/images/20240904/201509775cEGhSRpBL.png"></p><h2 id="關聯配置相關參數介紹"><a href="#關聯配置相關參數介紹" class="headerlink" title="關聯配置相關參數介紹"></a>關聯配置相關參數介紹</h2><p>關聯時必須知道誰是父實體(或稱維護方，具有 FK 可以關聯被維護 PK)，誰是子實體（被維護、被參考對象）</p><table><thead><tr><th></th><th>父實體(維護方)</th><th>子實體(被維護方)</th></tr></thead><tbody><tr><td>關聯</td><td>具有 FK</td><td>被關聯 PK 或其他</td></tr><tr><td>註解應用區別</td><td>@JoinColumn()</td><td>關聯註解加入參數 mappedBy</td></tr></tbody></table><h3 id="Cascade"><a href="#Cascade" class="headerlink" title="Cascade"></a>Cascade</h3><p>級聯配置參數，針對父實體的資料操作，子實體會有對應自動操作</p><ul><li>CascadeType.ALL：無論儲存、更新、刷新或移除，一併對被參考物件作出對應動作。</li><li>CascadeType.PERSIST：父實體進行儲存 （repository 的 save） 操作，自動對被關聯子實體進行儲存操作</li><li>CascadeType.MERGE：父實體進行更新操作時，自動對關聯的子實體執行更新操作。</li><li>CascadeType.REFRESH：父實體進行刷新操作時，自動對關聯的子實體執行刷新操作。</li><li>CascadeType.REMOVE：父實體進行刪除操作時，自動對關聯的子實體執行刪除操作。</li></ul><h3 id="Fetch"><a href="#Fetch" class="headerlink" title="Fetch"></a>Fetch</h3><p>資料讀取配置參數，設定讀取的方式是立即或是特定條件才讀</p><ul><li>FetchType.EARGE：馬上加載子實體</li><li>FetchType.LAZY：只有應用到子實體的屬性時才會被加載</li></ul><p>各類關聯註解預設值參考</p><table><thead><tr><th><strong>Relation</strong></th><th><strong>Default</strong></th></tr></thead><tbody><tr><td>@OneToOne</td><td>FetchType.EARGE</td></tr><tr><td>@ManyToOne</td><td>FetchType.EARGE</td></tr><tr><td>@OneToMany</td><td>FetchType.LAZY</td></tr><tr><td>@ManyToMany</td><td>FetchType.LAZY</td></tr></tbody></table><h2 id="一對一-1-1"><a href="#一對一-1-1" class="headerlink" title="一對一 1 : 1"></a>一對一 1 : 1</h2><p>一對一的關聯可以從 products 和 product_details 這兩張表之間的關聯看到，一個商品會對應一個詳細資料，要透過 JPA 會用到 <code>@OneToOne</code> 註解來進行關聯，這些關聯註解都有一些參數可以設置。在這邊的範例就是 products 是父實體，product_details 是子實體。</p><p>定義父實體 products</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table(name = &quot;products&quot;)</span></span><br><span class="line"><span class="comment">//@JsonIgnoreProperties(&#123;&quot;productDetail&quot;&#125;) // 避免循環引用</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne(cascade = CascadeType.ALL)</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;product_detail_id&quot;, referencedColumnName = &quot;id&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> ProductDetails productDetails;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@JoinColumn 的 name 參數指的是要提供 FK 的欄位名稱，referencedColumnName 是指被關聯方的 關聯欄位（不寫預設是被關聯的主鍵 PK）</p><p>定義子實體 product_details</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Table(name = &quot;product_details&quot;)</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(&quot;product&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductDetails</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String developer;</span><br><span class="line">    <span class="keyword">private</span> String publisher;</span><br><span class="line">    <span class="keyword">private</span> String releaseDate;</span><br><span class="line">    <span class="keyword">private</span> String languageSupport;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToOne(mappedBy = &quot;productDetails&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Product product;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>這邊需要注意如果需要雙向關聯，這邊也要在關聯要呈現的屬性上面加上 @OneToOne(mappedBy &#x3D; “{父方映射關聯的欄位}”)，這邊也就是指父實體放 ＠OneToOne 欄位的變數名 productDetails</p><p>另外補充如果雙向關聯開啟，就會出現無限循環關聯的問題，你可以想像會出現 product 關聯出 product_details 但裡面又關聯回 product 就會一直永無止境導致回傳資料混亂，有幾個方法可以解決：</p><ol><li>改用 DTO 將需要關聯資料裝入回傳</li><li>＠JsonIgnore 放在被關聯欄位上面就可以忽略關聯</li><li>＠JsonIgnoreProperties(”{關聯欄位變數名}”) 放在實體 class 上面</li></ol><p>實際撈回來的資料</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;最後生還者&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">59.99</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;由 Naughty Dog 開發的動作冒險遊戲。&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;productDetails&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;developer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Naughty Dog&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;publisher&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Sony Interactive Entertainment&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;releaseDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2013-06-14&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;languageSupport&quot;</span><span class="punctuation">:</span> <span class="string">&quot;English, Japanese, Chinese&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;巫師3&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">49.99</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;由 CD Projekt Red 開發的開放世界角色扮演遊戲。&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;productDetails&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;developer&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CD Projekt Red&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;publisher&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CD Projekt&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;releaseDate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2015-05-19&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;languageSupport&quot;</span><span class="punctuation">:</span> <span class="string">&quot;English, Chinese, Polish&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="comment">// 略......</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure><p>以上就是基本一對一的關聯操作，下篇會來介紹一對多 (1 : N) 的操作模式。</p><p>這邊想要補充一下推薦有使用 Intellij 的 database UI ，連接好資料庫之後，對資料庫點右鍵選 Diagrams &gt; Show Diagram 他就可以將各欄位之間的關聯狀況畫出來，還可以匯出圖片，就可以不用自己畫 ER 圖了，真的太強大 !!<br><img src="https://ithelp.ithome.com.tw/upload/images/20240905/20150977RPC1MnpZSG.png" alt="https://ithelp.ithome.com.tw/upload/images/20240905/20150977RPC1MnpZSG.png"></p><hr><h2 id="Ref"><a href="#Ref" class="headerlink" title="Ref:"></a>Ref:</h2><ul><li><a href="https://openhome.cc/Gossip/EJB3Gossip/CascadeTypeFetchType.html">CascadeType 與 FetchType</a></li><li><a href="https://chikuwa-tech-study.blogspot.com/2024/05/spring-boot-jpa-one-to-one-relationship.html">使用 JPA 配置資料表關聯（以一對一關聯為例）</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Spring Data Jpa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Data JPA (2) 資料庫查詢應用</title>
      <link href="/2024/09/25/SpringBoot/Spring-Data-JPA-%EF%BC%882%EF%BC%89%E8%B3%87%E6%96%99%E5%BA%AB%E6%9F%A5%E8%A9%A2%E6%87%89%E7%94%A8/"/>
      <url>/2024/09/25/SpringBoot/Spring-Data-JPA-%EF%BC%882%EF%BC%89%E8%B3%87%E6%96%99%E5%BA%AB%E6%9F%A5%E8%A9%A2%E6%87%89%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<p>這邊來認識一些我們可能會用到的一些資料庫查詢操作</p><p>根據前面的 products 結構來插入一些資料熟悉一些操作的用法吧。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> products (name, price, description) <span class="keyword">VALUES</span></span><br><span class="line">(<span class="string">&#x27;薩爾達傳說：曠野之息&#x27;</span>, <span class="number">59.99</span>, <span class="string">&#x27;設定在幻想世界中的開放世界動作冒險遊戲。&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;超級瑪利歐：奧德賽&#x27;</span>, <span class="number">49.99</span>, <span class="string">&#x27;以瑪利歐為主角的平臺遊戲，探索各種世界。&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;集合啦！動物森友會&#x27;</span>, <span class="number">54.99</span>, <span class="string">&#x27;在無人島上進行發展的生活模擬遊戲。&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;最終幻想 VII 重製版&#x27;</span>, <span class="number">69.99</span>, <span class="string">&#x27;經典 RPG 的重製版，具有更新的圖像和遊戲玩法。&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;巫師3：狂獵&#x27;</span>, <span class="number">39.99</span>, <span class="string">&#x27;開放世界 RPG，玩家扮演狩魔獵人傑洛特。&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;電馭叛客2077&#x27;</span>, <span class="number">59.99</span>, <span class="string">&#x27;設定在反烏托邦未來世界的開放世界 RPG。&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;對馬戰鬼&#x27;</span>, <span class="number">59.99</span>, <span class="string">&#x27;設定在日本封建時代的動作冒險遊戲。&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;碧血狂殺2&#x27;</span>, <span class="number">49.99</span>, <span class="string">&#x27;以西部為主題的開放世界動作冒險遊戲。&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;黑帝斯&#x27;</span>, <span class="number">24.99</span>, <span class="string">&#x27;在地下城中進行逃脫的類 Roguelike 遊戲。&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;我們之中&#x27;</span>, <span class="number">4.99</span>, <span class="string">&#x27;在太空船上進行的多人派對遊戲，涉及團隊合作與背叛。&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="操作查詢方法"><a href="#操作查詢方法" class="headerlink" title="操作查詢方法"></a>操作查詢方法</h2><h3 id="一-根據欄位值的相等條件"><a href="#一-根據欄位值的相等條件" class="headerlink" title="(一) 根據欄位值的相等條件"></a><strong>(一) 根據欄位值的相等條件</strong></h3><p>前面一篇有提到可以直接透過欄位名稱來查找，JPA 會自動幫我們對應，最常用到的就是 findById，如果想要查找其他欄位就可以直接改成像是 findByName, findByPrice 等等都可以讓 JPA 幫我們匹配。</p><p>這邊根據 findByName 我們可以透過名稱找到對應商品</p><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/q&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Product <span class="title function_">getProductsByName</span><span class="params">(<span class="meta">@RequestParam</span> String name)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> productService.getProductByName(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductRepository productRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">getProductByName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.findByName(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>repository</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Product, Integer&gt; &#123;</span><br><span class="line">    Product <span class="title function_">findByName</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://ithelp.ithome.com.tw/upload/images/20240902/20150977BLTg7Zm4IW.png" alt="https://ithelp.ithome.com.tw/upload/images/20240902/20150977BLTg7Zm4IW.png"></p><h3 id="二-範圍條件"><a href="#二-範圍條件" class="headerlink" title="(二) 範圍條件"></a><strong>(二) 範圍條件</strong></h3><p>可以根據數值的範圍來進行查詢，像是這邊可以用價錢來進行示範</p><p>他的格式會像 findBy{判斷欄位}GreaterThanEqual()</p><ul><li>大於 <code>findByPriceGreaterThan()</code></li><li>大於等於 <code>findByPriceGreaterThanEqual()</code></li><li>小於 <code>findByPriceLessThan()</code></li><li>小於等於 <code>findByPriceLessThanEqual()</code></li></ul><p>這邊用大於等於</p><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/priceGreaterThanEqual&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getProductsByPriceGreaterThanEqual</span><span class="params">(<span class="meta">@RequestParam</span> <span class="type">int</span> range)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> productService.getProductGreaterThanEqual(range);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductRepository productRepository;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getProductGreaterThanEqual</span><span class="params">(<span class="type">int</span> range)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.findByPriceGreaterThanEqual(range);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>repository</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Product, Integer&gt; &#123;</span><br><span class="line">    Product <span class="title function_">findByName</span><span class="params">(String name)</span>;</span><br><span class="line">    List&lt;Product&gt; <span class="title function_">findByPriceGreaterThanEqual</span><span class="params">(<span class="type">int</span> range)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查詢大於 60 元剛好只有 69.99 元的最終幻想符合<br><img src="https://ithelp.ithome.com.tw/upload/images/20240902/20150977HBj3KmiXkx.png" alt="https://ithelp.ithome.com.tw/upload/images/20240902/20150977HBj3KmiXkx.png"></p><h3 id="多個條件"><a href="#多個條件" class="headerlink" title="多個條件"></a><strong>多個條件</strong></h3><p>可透過 And 或 Or 組合</p><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@GetMapping(&quot;/nameOrPrice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getProductsByNameOrPrice</span><span class="params">(<span class="meta">@RequestParam</span> String name, <span class="meta">@RequestParam</span> <span class="type">double</span> price)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> productService.getProductByNameOrPrice(name, price);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>service</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getProductByNameOrPrice</span><span class="params">(String name, <span class="type">double</span> price)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> productRepository.findByNameOrPrice(name, price);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>repository</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Product, Integer&gt; &#123;</span><br><span class="line">    List&lt;Product&gt; <span class="title function_">findByNameOrPrice</span><span class="params">(String name, <span class="type">double</span> price)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://ithelp.ithome.com.tw/upload/images/20240902/20150977UIMYJWNpeV.png" alt="https://ithelp.ithome.com.tw/upload/images/20240902/20150977UIMYJWNpeV.png"><br>or 的話只要其中一項條件符合就會執行，像是下面有搜出 name &#x3D; 黑帝斯 也有搜出 price &#x3D; 49.99</p><h3 id="原生-SQL"><a href="#原生-SQL" class="headerlink" title="原生 SQL"></a>原生 SQL</h3><p>使用 JPA 如果不夠彈性你也可使用原生的語法 <code>@Query</code></p><p>@Query 裡面要第一個參數註明是 <code>nativeQuery = true</code> ， 第二個參數是 vlaue &#x3D; “{sql 語法}” ，也可以把 value 省略，直接用 SQL 字串放第二個參數，注意這邊 SQL 語法結尾請不要加分號 “;”</p><p>參數的帶入也可以用 :param 的方式，這邊其實寫法有很多種，大家就找到自己喜歡或是團隊易懂的方式來撰寫。</p><p>*如果 nativeQuery 沒有開啟就是使用 JPQL</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//    用 &quot;&quot;&quot; &quot;&quot;&quot; 可以不用顧慮換行問題</span></span><br><span class="line"><span class="comment">//    @Query(</span></span><br><span class="line"><span class="comment">//            nativeQuery = true,</span></span><br><span class="line"><span class="comment">//            value = &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">//                SELECT *</span></span><br><span class="line"><span class="comment">//                FROM `products`</span></span><br><span class="line"><span class="comment">//                WHERE `name` = ?1 OR `price` = ?2</span></span><br><span class="line"><span class="comment">//            &quot;&quot;&quot;</span></span><br><span class="line"><span class="comment">//    )</span></span><br><span class="line"><span class="comment">// JPQL 須注意如果語法長中間可能換行及空格導致語法錯誤</span></span><br><span class="line"><span class="meta">@Query(&quot;SELECT p FROM Product p WHERE p.name = :name OR p.price = :price&quot;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Native SQL 須注意如果語法長中間可能換行及空格導致語法錯誤</span></span><br><span class="line">    <span class="meta">@Query(</span></span><br><span class="line"><span class="meta">            nativeQuery = true,</span></span><br><span class="line"><span class="meta">            value = &quot;SELECT * FROM products WHERE name = ?1 OR price = ?2&quot;</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    List&lt;Product&gt; <span class="title function_">findByNameOrPriceNative</span><span class="params">(String name, <span class="type">double</span> price)</span>;</span><br></pre></td></tr></table></figure><h2 id="排序-Sorting-與分頁-Pagination"><a href="#排序-Sorting-與分頁-Pagination" class="headerlink" title="排序(Sorting)與分頁(Pagination)"></a>排序(Sorting)與分頁(Pagination)</h2><h3 id="Sort-物件"><a href="#Sort-物件" class="headerlink" title="Sort 物件"></a>Sort 物件</h3><p>利用 Sort 物件可以做到排序，看是要升序(ASC)或是降序(DESC)，這個物件是可以直接帶入 repository 的方法中告知 JPA 要進行排序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// asc</span></span><br><span class="line"><span class="type">Sort</span> <span class="variable">sort</span> <span class="operator">=</span> Sort.by(&#123;欄位&#125;).ascending()</span><br><span class="line"><span class="comment">// desc</span></span><br><span class="line"><span class="type">Sort</span> <span class="variable">sort</span> <span class="operator">=</span> Sort.by(&#123;欄位&#125;).descending();</span><br></pre></td></tr></table></figure><p>以撈出全部資料 Service 方法為例，根據價錢進行升序</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getAllProducts</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Sort</span> <span class="variable">sort</span> <span class="operator">=</span> Sort.by(<span class="string">&quot;price&quot;</span>).ascending();</span><br><span class="line">    <span class="keyword">return</span> productRepository.findAll(sort);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到顯示資料就照價錢由小到大排了</p><p><img src="https://ithelp.ithome.com.tw/upload/images/20240903/20150977FBBLSm2UcJ.png" alt="https://ithelp.ithome.com.tw/upload/images/20240903/20150977FBBLSm2UcJ.png"><br>Sort 也可以整合下面分頁物件一起做到排序及分頁</p><h3 id="Pageable-物件"><a href="#Pageable-物件" class="headerlink" title="Pageable 物件"></a>Pageable 物件</h3><p>Pageabe 是一個介面，通常會放入三個參數來透過 PageRequest 方法實作</p><ul><li>第一個參數 page 表示第幾頁(需要特別注意第一頁是 0)</li><li>第二個參數 limit 表示回傳資料筆數上限</li><li>第三個參數 sort 表示排序物件</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(page, limit, sort);</span><br></pre></td></tr></table></figure><p>把上面的 Sort 物件一起帶進去，並且告知我要取得第一頁的 3 筆資料</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Page&lt;Product&gt; <span class="title function_">getAllProducts</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Sort</span> <span class="variable">sort</span> <span class="operator">=</span> Sort.by(<span class="string">&quot;price&quot;</span>).ascending();</span><br><span class="line"></span><br><span class="line">        <span class="type">Pageable</span> <span class="variable">pageable</span> <span class="operator">=</span> PageRequest.of(<span class="number">0</span>,<span class="number">3</span>, sort);</span><br><span class="line"></span><br><span class="line">        Page&lt;Product&gt; productPage = productRepository.findAll(pageable);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> productPage;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>回傳的資料可以看到確實有排序，還有提供分頁的相關資訊，也只顯示出第一頁的 3 筆資料</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;最終幻想 VII 重製版&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">69.99</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;經典 RPG 的重製版，具有更新的圖像和遊戲玩法。&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;薩爾達傳說：曠野之息&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">59.99</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;設定在幻想世界中的開放世界動作冒險遊戲。&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">6</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;電馭叛客2077&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;price&quot;</span><span class="punctuation">:</span> <span class="number">59.99</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;description&quot;</span><span class="punctuation">:</span> <span class="string">&quot;設定在反烏托邦未來世界的開放世界 RPG。&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pageable&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;pageNumber&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;pageSize&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;empty&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;sorted&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;unsorted&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;offset&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;paged&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;unpaged&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalPages&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalElements&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;last&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;number&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;sort&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;empty&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sorted&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;unsorted&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;numberOfElements&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;first&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;empty&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>以上就是基本的一些查詢跟應用，對於許多網站的搜尋及資料的查找都是相當基本的用法，Spring Data Jpa 也提供給我們許多方便的用法，還有一定的彈性可以自行撰寫原生 SQL。那下篇來講一些關於資料庫關聯的一些操作介紹吧。</p><hr><p>參考資料：</p><ul><li><a href="https://chikuwa-tech-study.blogspot.com/2024/05/spring-boot-mysql-using-jpa-repository.html">使用 JPA Repository 存取 MySQL 資料庫</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Spring Data Jpa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Data JPA（1）基礎應用架構</title>
      <link href="/2024/09/24/SpringBoot/Spring-Data-JPA-%EF%BC%881%EF%BC%89%E5%9F%BA%E7%A4%8E%E6%87%89%E7%94%A8%E6%9E%B6%E6%A7%8B/"/>
      <url>/2024/09/24/SpringBoot/Spring-Data-JPA-%EF%BC%881%EF%BC%89%E5%9F%BA%E7%A4%8E%E6%87%89%E7%94%A8%E6%9E%B6%E6%A7%8B/</url>
      
        <content type="html"><![CDATA[<p>前面已經介紹過各類資料操作框架的特色之後，這邊來介紹其中我比較熟悉也蠻多人使用的 Spring Data Jpa，雖然比較不用寫 SQL 所以可能會對於 SQL 掌握比較少，但我覺得透過物件的方式來操作資料也是本身 Java 的特色之一，搭配 Spring Boot 能夠整合在框架中使用是很方便的</p><h2 id="使用前概念"><a href="#使用前概念" class="headerlink" title="使用前概念"></a>使用前概念</h2><p>根據常用開發架構的 MVC 架構，資料庫的部分主要是由 Model 層部分進行處理，這邊對應在 Spring Boot 的開發上會放在 Dao 和 Service，Dao 主要是定義我們與資料庫的溝通連結，在 Spring Data Jpa 主要就是繼承 JpaRepository 去處理資料的存取，最後將拿到得資料返回給 Service 進行業務邏輯的操作或是資料的組裝，最後回給 Controller。</p><h2 id="引入套件"><a href="#引入套件" class="headerlink" title="引入套件"></a>引入套件</h2><p>pom.xml 加入下面套件，spring-boot-starter-data-jpa 就是我們要使用的 JPA 套件，另外一個則是 mysql 連線用的套件，可以根據使用不同資料庫做更換</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="配置-application-properties"><a href="#配置-application-properties" class="headerlink" title="配置 application properties"></a>配置 application properties</h2><p>這部分根據你使用的資料庫不同會有一些差異，以下拿 Mysql 為例，主要需要配置概念都差不多，就是配置你的資料庫 Driver, 資料來源, 使用者名稱, 密碼等等</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本來源配置</span></span><br><span class="line">spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver</span><br><span class="line">spring.datasource.url=jdbc:mysql://localhost:3306/&#123;databaseName&#125;</span><br><span class="line">spring.datasource.username=&#123;username&#125;</span><br><span class="line">spring.datasource.password=&#123;userPassword&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 額外配置</span></span><br><span class="line"><span class="comment"># 資料表初始化及自動更新</span></span><br><span class="line">spring.jpa.hibernate.ddl-auto=update</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否在 console 印出 SQL 指令並對其格式化</span></span><br><span class="line">spring.jpa.properties.hibernate.show_sql=<span class="literal">true</span></span><br><span class="line">spring.jpa.properties.hibernate.format_sql=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>假設我們想要設計產品 <code>Product</code> 的資料操作，會定義他的實體類別 (Entity)，來對應到資料庫的 <code>products</code> 表，當我們進行資料都是用 Product 這個物件來操作資料的存取，查詢就將資料轉成我們定義好的物件回給我們，儲存、修改、刪除等等的操作也是由此物件去進行。</p><h3 id="資料庫建立及資料表建立"><a href="#資料庫建立及資料表建立" class="headerlink" title="資料庫建立及資料表建立"></a>資料庫建立及資料表建立</h3><p>資料庫建立部分大家可以自行找自己所使用的用法，這邊就不說明，提供一個簡單通用的 SQL 例子方便沒使用過的可以有環境進行操作</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE <span class="title function_">products</span> <span class="params">(</span></span><br><span class="line"><span class="params">    id BIGINT AUTO_INCREMENT PRIMARY KEY,</span></span><br><span class="line"><span class="params">    name VARCHAR(<span class="number">255</span>)</span> NOT NULL,</span><br><span class="line">    price <span class="title function_">DECIMAL</span><span class="params">(<span class="number">10</span>, <span class="number">2</span>)</span> NOT NULL,</span><br><span class="line">    description TEXT,</span><br><span class="line">    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,</span><br><span class="line">    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h2 id="Entity"><a href="#Entity" class="headerlink" title="Entity"></a>Entity</h2><p>新增一個 class，定義我們要作為資料庫操作物件，會對應到資料表的個別欄位</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jakarta.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> jakarta.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> jakarta.persistence.GenerationType;</span><br><span class="line"><span class="keyword">import</span> jakarta.persistence.Id;</span><br><span class="line"><span class="keyword">import</span> jakarta.persistence.Table;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;products&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Product</span> &#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Double price;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter and Setter...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>@Entity 告訴 Jpa 它是要儲存到資料庫的實體類別</p><p>@Table 則設定它在資料庫中，要對應到叫做「products」的 table 。</p><p>@Id 表示 table 中的主鍵（Primary Key，PK）</p><p>@GernatedValue() 定義了主鍵值的產生方式。設定的方式 strategy &#x3D; GenerationType.IDENTITY 就是表示主鍵會自動增長。</p><blockquote><p>後面章節會講到一些 Lombok 註解的應用，可以讓 Spring Data Jpa 使用上更加簡潔方便，但希望各位使用時還是要清楚知道每個註解的由來跟原始作法</p></blockquote><h2 id="Dao-層繼承-JpaRepository"><a href="#Dao-層繼承-JpaRepository" class="headerlink" title="Dao 層繼承 JpaRepository"></a>Dao 層繼承 JpaRepository</h2><p>新增 Repository 來做為資料庫溝通介面</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Repository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ProductRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;Product, Long&gt; &#123;</span><br><span class="line">    Product <span class="title function_">findByName</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Respository 就是屬於 Dao 的部分，這邊會新增一個介面( interface) 來繼承 JpaRepository，就可以將 JPA 對於物件實體的映射包含資料庫的連線等等實現，後面&lt;&gt; 內需要放入你要操作的物件實體及他內部主鍵型別 (id 的型別) 最後會是像這樣 JpaRepository&lt;Entity, 主鍵型別&gt;，下面可以加入任何你想要使用的方法來操作資料庫，通常預設已經有基本可以針對 id 搜尋單筆，或是直接查詢整筆，就不用宣告出來，透過繼承就可以後續直接再 Service 層中使用。</p><h2 id="Service-層中用慣例優於配置來進行-CRUD-操作"><a href="#Service-層中用慣例優於配置來進行-CRUD-操作" class="headerlink" title="Service 層中用慣例優於配置來進行 CRUD 操作"></a>Service 層中用慣例優於配置來進行 CRUD 操作</h2><p>新增 Service 層應用 JPA Repository 定義好的或是預設的方法操作資料</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductRepository productRepository;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 新增產品</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">createProduct</span><span class="params">(Product product)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.save(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根據 id 查詢單一產品</span></span><br><span class="line">    <span class="keyword">public</span> Optional&lt;Product&gt; <span class="title function_">getProductById</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.findById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根據名稱查詢單一產品</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">getProductByName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.findByName(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查詢所有產品</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getAllProducts</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productRepository.findAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新產品</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">updateProduct</span><span class="params">(Long id, Product productDetails)</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Product not found with id: &quot;</span> + id));</span><br><span class="line"></span><br><span class="line">        product.setName(productDetails.getName());</span><br><span class="line">        product.setPrice(productDetails.getPrice());</span><br><span class="line">        product.setDescription(productDetails.getDescription());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> productRepository.save(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 刪除產品</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteProduct</span><span class="params">(Long id)</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> productRepository.findById(id)</span><br><span class="line">            .orElseThrow(() -&gt; <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Product not found with id: &quot;</span> + id));</span><br><span class="line"></span><br><span class="line">        productRepository.delete(product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>這邊就可以看到我們使用 JPA 所帶來的好處，已經直接提供給我們很多 ORM 包裝好的方法，像是 findById(), findAll(), save(), delete()，這些本該是自己要撰寫 Sql 才能和資料庫溝通的，但我們在 Repository 沒有定義任何方法就可以使用，除了一個 findByName 這個是我們自己定義的，但你也會發現這方法也沒進行任何處理，只是一個簡單明瞭的名稱就可以做到查詢，其實都是 JPA 幫我們處理好，他會自行匹配你定義好在 Entity 的個別欄位，所以當你寫 findBy{欄位名} 他就會自行匹配對應的 sql ( <code>SELECT * FROM prodcuts WHERE &#123;欄位名&#125; = ‘&#123;值&#125;’</code>; )，確實都不用寫到任何 SQL 就可以完成基本的操作。</p><p>這些慣例優於配置的用法其實還有很多，是你想要進行複雜查詢要自己寫的話要怎麼使用，後面會有進一步介紹。</p><h3 id="Controller-建立接口接收請求及回傳結果"><a href="#Controller-建立接口接收請求及回傳結果" class="headerlink" title="Controller 建立接口接收請求及回傳結果"></a>Controller 建立接口接收請求及回傳結果</h3><p>最後就是開端口接收請求及回傳 Service 的結果</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.ResponseEntity;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Optional;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/products&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ProductService productService;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 新增產品</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">createProduct</span><span class="params">(<span class="meta">@RequestBody</span> Product product)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productService.createProduct(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查詢單一產品</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Product&gt; <span class="title function_">getProductById</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        Optional&lt;Product&gt; product = productService.getProductById(id);</span><br><span class="line">        <span class="keyword">return</span> product.map(ResponseEntity::ok)</span><br><span class="line">                      .orElseGet(() -&gt; ResponseEntity.notFound().build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查詢所有產品</span></span><br><span class="line">    <span class="meta">@GetMapping</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Product&gt; <span class="title function_">getAllProducts</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> productService.getAllProducts();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新產品</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Product&gt; <span class="title function_">updateProduct</span><span class="params">(<span class="meta">@PathVariable</span> Long id, <span class="meta">@RequestBody</span> Product productDetails)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Product</span> <span class="variable">updatedProduct</span> <span class="operator">=</span> productService.updateProduct(id, productDetails);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.ok(updatedProduct);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.notFound().build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 刪除產品</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Void&gt; <span class="title function_">deleteProduct</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            productService.deleteProduct(id);</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.noContent().build();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (RuntimeException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.notFound().build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>看完你會對於 Spring Data JPA 有進一步的了解了，也大概知道其中的特色在哪，有太多太多細節再透過後面的章節慢慢介紹。</p><hr><p>參考資料 :</p><ul><li><a href="https://chikuwa-tech-study.blogspot.com/2024/05/spring-boot-setup-mysql-and-introduce-jpa.html"><strong>準備 MySQL 資料庫與認識 Spring Data JPA</strong></a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Spring Data Jpa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Data JPA, JDBC Template, Mybatis 比較</title>
      <link href="/2024/09/23/SpringBoot/Spring-Data-JPA-JDBC-Template-Mybatis-%E6%AF%94%E8%BC%83/"/>
      <url>/2024/09/23/SpringBoot/Spring-Data-JPA-JDBC-Template-Mybatis-%E6%AF%94%E8%BC%83/</url>
      
        <content type="html"><![CDATA[<p>今天就來認識一下使用 Spring Boot 的時候可能會碰到的三種資料存取框架 Spring Data JPA、JDBC Template 和 MyBatis ，他們都各有其特色和適合的應用場景，當你需要碰到資料庫的處理，肯定需要來了解一下。</p><h2 id="Spring-Data-JPA"><a href="#Spring-Data-JPA" class="headerlink" title="Spring Data JPA"></a>Spring Data <strong>JPA</strong></h2><h3 id="特點："><a href="#特點：" class="headerlink" title="特點："></a><strong>特點：</strong></h3><ul><li><strong>ORM 的框架：</strong>將資料庫表格映射到我們定義的 Java 物件上面，並提供自動化的資料庫操作。資料操作可以用物件的概念還進行操作，程式碼具物件特性和可讀性。</li><li><strong>簡化資料存取：</strong>透過 JPA(<strong>(Java Persistence API</strong>)，可自動根據操作的慣例來減少手動撰寫 SQL 的需求，例如 findById, findAll 等等的直觀方法可以直接進行操作，不需要另外定義。</li><li><strong>支援 JPQL (Java Persistence Query Language)：</strong> 提供類似 SQL 的查詢語言，但更強調物件導向，使用的是物件屬性而非資料庫欄位。</li><li><strong>與 Spring 整合：</strong>由於是 Spring Framework 的一部分，與 Spring 框架可自然引入整合。</li></ul><h3 id="優點："><a href="#優點：" class="headerlink" title="優點："></a><strong>優點：</strong></h3><ul><li>減少 SQL 操作的細節，並專注於物件導向設計時。</li><li>資料庫結構相對穩定，不需要頻繁修改時操作方便。</li></ul><h3 id="缺點："><a href="#缺點：" class="headerlink" title="缺點："></a><strong>缺點：</strong></h3><ul><li>對複雜查詢支持不夠靈活。 雖提供 JPQL 但對於複雜的操作上較侷限，可能仍需使用 Native Query 使用原生 SQL 進行。</li><li>在高效能需求下，可能因自動生成的 SQL 語句效能不佳。</li></ul><h2 id="JDBC-Template"><a href="#JDBC-Template" class="headerlink" title="JDBC Template"></a><strong>JDBC Template</strong></h2><h3 id="特點：-1"><a href="#特點：-1" class="headerlink" title="特點："></a><strong>特點：</strong></h3><ul><li><strong>簡化原生 JDBC 操作：</strong>JDBC Template 封裝了原生 JDBC API，簡化了連接、資源管理和錯誤處理等繁瑣細節。</li><li><strong>高度控制 SQL 語句：</strong>需要開發者手動撰寫 SQL 語句，讓開發者完全掌握 SQL 的細節和效能。</li><li><strong>簡單易用：</strong>支援查詢單一資料、多筆資料、更新、插入和批次操作，容易學習和掌握。</li><li><strong>與 Spring 整合：</strong> 由於是 Spring Framework 的一部分，與 Spring 框架可自然引入整合。</li></ul><h3 id="優點：-1"><a href="#優點：-1" class="headerlink" title="優點："></a><strong>優點：</strong></h3><ul><li>靈活撰寫 SQL</li><li>可應對資料庫結構不斷變動或查詢需求複雜的系統。</li></ul><h3 id="缺點：-1"><a href="#缺點：-1" class="headerlink" title="缺點："></a><strong>缺點：</strong></h3><ul><li>需要手動撰寫和維護 SQL 語句，增加代碼量。</li><li>不如 JPA 那樣自動處理關聯或物件映射。</li></ul><h2 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a><strong>MyBatis</strong></h2><h3 id="特點：-2"><a href="#特點：-2" class="headerlink" title="特點："></a><strong>特點：</strong></h3><ul><li><strong>類 ORM：</strong>因為 ORM 的設計概念就是要減少 SQL 的使用，自動透過語法去產生 SQL，MyBatis 支援將 SQL 查詢結果自動映射到 Java 物件這樣類似 ORM 的概念，但 SQL 需要開發者自行撰寫，所以不算 ORM。</li><li><strong>高靈活性：</strong>開發者可以完全掌控 SQL 語句，適合處理複雜查詢或動態 SQL 的場景，例如可以在 SQL 中加入特定條件判斷，選擇性的執行語句。</li><li><strong>XML 和註解配置：</strong> 可以使用 XML 或註解配置 SQL 語句，適合團隊協作和代碼重用。也將 SQL 結果自動映射到 Java 類別，減少手動處理的麻煩。</li></ul><h3 id="適用場景："><a href="#適用場景：" class="headerlink" title="適用場景："></a><strong>適用場景：</strong></h3><ul><li>靈活撰寫 SQL</li><li>可應對資料庫結構不斷變動或查詢需求複雜的系統。</li></ul><h3 id="缺點：-2"><a href="#缺點：-2" class="headerlink" title="缺點："></a><strong>缺點：</strong></h3><ul><li>XML 配置可能過於冗長，增加代碼複雜度。</li><li>需要維護大量自訂 SQL，若不加以管理，可能導致代碼難以維護。</li></ul><h3 id="JPA、JDBC-Template-和-MyBatis-的比較與選擇指引"><a href="#JPA、JDBC-Template-和-MyBatis-的比較與選擇指引" class="headerlink" title="JPA、JDBC Template 和 MyBatis 的比較與選擇指引"></a><strong>JPA、JDBC Template 和 MyBatis 的比較與選擇指引</strong></h3><table><thead><tr><th><strong>特性</strong></th><th><strong>JPA</strong></th><th><strong>JDBC Template</strong></th><th><strong>MyBatis</strong></th></tr></thead><tbody><tr><td><strong>SQL 控制</strong></td><td>低（自動生成）</td><td>高（手動撰寫）</td><td>高（手動撰寫）</td></tr><tr><td><strong>資料庫操作簡易度</strong></td><td>高（自動化映射與操作）</td><td>中（簡化資源管理與操作）</td><td>中（映射支援，但 SQL 需自行處理）</td></tr><tr><td><strong>ORM 支援</strong></td><td>完整支援</td><td>無（需要手動處理）</td><td>半自動化（SQL 自訂，結果自動映射）</td></tr><tr><td><strong>複雜查詢</strong></td><td>一般（使用 JPQL，靈活性有限）</td><td>高（完全自訂 SQL）</td><td>高（動態 SQL 支援）</td></tr><tr><td><strong>學習曲線</strong></td><td>中（需理解 ORM 概念）</td><td>低（適合熟悉 SQL 的開發者）</td><td>中（需學習 XML 或註解配置）</td></tr><tr><td><strong>效能</strong></td><td>中（依賴 ORM 實現）</td><td>高（手動優化 SQL）</td><td>高（可完全控制 SQL）</td></tr></tbody></table><h2 id="使用心得分享："><a href="#使用心得分享：" class="headerlink" title="使用心得分享："></a>使用心得分享：</h2><p>目前我工作上有碰過的就是 JPA 和 MyBatis 這兩種，自己使用的心得會覺得，如果資料庫簡單，多半都是進行比較單純的 CRUD 操作時，因為物件關係明確時，JPA 會比較方便去操作，像是自己做一些小專案可以很快地建立起操作資料的連結或；當資料庫比較複雜需要較多 SQL 操作，並且對 SQL 熟悉，有高度掌控需求時，MyBatis 會更適合，JDBC 雖然我沒用過，但看過一些用法也是著重原生 SQL 的特性，所以也會比較接近 MyBatis 的應用場景。</p><h2 id="小總結："><a href="#小總結：" class="headerlink" title="小總結："></a>小總結：</h2><ul><li>若開發專案重視物件導向設計與簡化 CRUD 操作，並且不太需要控制 SQL 細節，選擇 JPA。</li><li>若專案需要靈活控制 SQL 並希望減少手動管理 JDBC 資源的複雜度，選擇 JDBC Template</li><li>若專案需要高度靈活的 SQL 控制，並且涉及大量複雜查詢和動態 SQL，選擇 MyBatis</li></ul><hr><p>參考資料:</p><ul><li><a href="https://medium.com/@zzzzzYang/spring-data-jpa-vs-mybatis-8611acff00ec"><strong>Spring Data JPA vs MyBatis</strong></a></li><li><a href="https://juejin.cn/post/7221800875742773307"><strong>MyBatis、Spring JDBC 和 Spring Data JPA：選擇哪種持久框架？</strong></a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> ORM </tag>
            
            <tag> Database </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring MVC -  Thymeleaf</title>
      <link href="/2024/09/22/SpringBoot/Spring-MVC-Thymeleaf/"/>
      <url>/2024/09/22/SpringBoot/Spring-MVC-Thymeleaf/</url>
      
        <content type="html"><![CDATA[<p>這篇來補充一下一些 Spring MVC 的 View 的部分吧，這部分其實就是前端的處理，雖然業界許多已經前後端分離，所以後端只需要著重在 Spring Boot 本身的後端 Server 上進行資料的處理，但其實過去前後端整合 FullStack 的部分也是有許多公司仍在使用， Spring Boot 其實也有提供和許多前端模板整合的方式來進行全端的處理，所以這部分如果碰到也是需要</p><h2 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h2><ul><li>SpringBoot 推薦使用的 web 前端模板引擎</li><li>能夠輕鬆實現 MVC 架構並配合後端資料動態渲染前端頁面</li><li>可在 Html 中嵌入動態內容</li><li>其他類似的模板引擎: JSP, Freemarker, Groovy, Velocity 等</li></ul><h2 id="引入套件及配置"><a href="#引入套件及配置" class="headerlink" title="引入套件及配置"></a>引入套件及配置</h2><p>pom.xml</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>application.properties</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 表示是否啟用Thymeleaf 的快取，開發階段建議關閉</span><br><span class="line">spring.thymeleaf.cache=<span class="literal">false</span></span><br><span class="line"># 模板前綴設置，預設即為classpath:/templates/</span><br><span class="line">spring.thymeleaf.prefix=classpath:/templates/</span><br><span class="line"># 模板後綴設置，預設為.html</span><br><span class="line">spring.thymeleaf.suffix=.html</span><br></pre></td></tr></table></figure><p>項目結構</p><p>主要需要注意的是模板放的位置</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">src/</span><br><span class="line">├── main/</span><br><span class="line">│   ├── java/</span><br><span class="line">│   │   └── com/example/demo/</span><br><span class="line">│   │       ├── DemoApplication.java</span><br><span class="line">│   │       └── HomeController.java</span><br><span class="line">│   ├── resources/</span><br><span class="line">│   │   ├── application.properties</span><br><span class="line">│   │   └── templates/</span><br><span class="line">│   │       └── home.html</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="後端資料處理及傳遞"><a href="#後端資料處理及傳遞" class="headerlink" title="後端資料處理及傳遞"></a>後端資料處理及傳遞</h2><p>假設我們在後端建立一個 HomeController</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/home&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">home</span><span class="params">(Model model)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//模擬 Service 回傳的資料</span></span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student.setId(<span class="number">1</span>);</span><br><span class="line">        student.setName(<span class="string">&quot;Sean&quot;</span>);</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Welcome to Thymeleaf!&quot;</span>);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;student&quot;</span>, student);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以用到前面的設計 URL 方法來設計，注意的是這邊就需要用到一個重要的註解 <code>@Controller</code> 這個註解表示不是直接傳遞一個 Json 或 Xml 格式的資料，而是包含前端渲染的模板，當使用這個註解之後 Spring Boot 就會幫我們自動匹配 &#x2F;resources&#x2F;templates 下面的模板配合我們所傳遞的資料回傳給前端渲染。</p><p>也要特別注意到前端要接收的資料需要裝在一個 <code>Model</code> 的物件內，我們可以用 <code>addAttribute(”key”, “value”)</code> 來裝進去，key 就會是前端需要取值時候帶入的，然後就會呈現 value 的值，value 可以是任意類型可以是字串、數值或是物件。</p><p>最後回傳的資料都是用 String 格式，且回傳的值就是要呈現的模板名稱，像是這邊我們要呈現在 home.html 就是回傳 “home”，很直觀就可以聯想把剛剛我們設定好的資料丟到這個模板呈現。</p><h2 id="前端渲染接收到資料"><a href="#前端渲染接收到資料" class="headerlink" title="前端渲染接收到資料"></a>前端渲染接收到資料</h2><p>創建 home.html 頁面至 templates，並且設定好需要 thymeleaf 渲染的資料，使用 <code>&lt;tag th:text = “$&#123;key&#125;”&gt;&lt;tag&gt;</code> 的語法來呈現，前面 tag 可以是任意 html 標籤，要呈現的值放在中間並用 “${key}” 來抓出Model 帶來要呈現的資料，如果是物件可以用 “${object.key}” 來抓到內部的個別屬性</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Thymeleaf Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span>Default message<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;student.id&#125;&quot;</span>&gt;</span>Default id<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span>&gt;</span>NAME<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;student.name&#125;&quot;</span>&gt;</span>Default name<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://ithelp.ithome.com.tw/upload/images/20240828/20150977r8OaaGDF2k.png" alt="https://ithelp.ithome.com.tw/upload/images/20240828/20150977r8OaaGDF2k.png"></p><h2 id="如果有多筆資料要呈現"><a href="#如果有多筆資料要呈現" class="headerlink" title="如果有多筆資料要呈現"></a>如果有多筆資料要呈現</h2><p>多筆學生資料可以用 List 來裝，也同樣存進去 model</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HelloController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/home&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">home</span><span class="params">(Model model)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//模擬 Service, dao 回傳的資料</span></span><br><span class="line">        List&lt;Student&gt; studentList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student1.setId(<span class="number">1</span>);</span><br><span class="line">        student1.setName(<span class="string">&quot;Sean&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">Student</span> <span class="variable">student2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">        student2.setId(<span class="number">2</span>);</span><br><span class="line">        student2.setName(<span class="string">&quot;Ken&quot;</span>);</span><br><span class="line"></span><br><span class="line">        studentList.add(student1);</span><br><span class="line">        studentList.add(student2);</span><br><span class="line"></span><br><span class="line">        model.addAttribute(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;Welcome to Thymeleaf!&quot;</span>);</span><br><span class="line">        model.addAttribute(<span class="string">&quot;student&quot;</span>, studentList);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;home&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>前端改用 Thymeleaf For 迴圈語法，<code>&lt;tag th:each=”item : $&#123;itemList&#125;”&gt;</code> 同樣 tag 可以用在各種類型的標籤上面，後面的用法概念都是一樣。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Thymeleaf Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span>Default message<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">th</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;student : $&#123;student&#125;&quot;</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;student.id&#125;&quot;</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;student.name&#125;&quot;</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>可以呈現多筆的資料</p><p><img src="https://ithelp.ithome.com.tw/upload/images/20240828/20150977RFIX55tolo.png" alt="https://ithelp.ithome.com.tw/upload/images/20240828/20150977RFIX55tolo.png"></p><h2 id="頁面抽為片段模組化"><a href="#頁面抽為片段模組化" class="headerlink" title="頁面抽為片段模組化"></a>頁面抽為片段模組化</h2><p>首先，將前面 home.html 表格的片段抽取到一個單獨的模板中，這個模板也放在 <code>src/main/resources/templates/</code> 目錄下，並命名為 <code>fragments.html</code>。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Fragments<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定義一個 fragment，名為 studentTable --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:fragment</span>=<span class="string">&quot;studentTable&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">thead</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">th</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">th</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tbody</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">tr</span> <span class="attr">th:each</span>=<span class="string">&quot;student : $&#123;student&#125;&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;student.id&#125;&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;student.name&#125;&quot;</span>&gt;</span>Name<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在要插入的主模板 <code>home.html</code> 中引入這個 fragment，並將 student 列表傳遞進去。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Student List<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;message&#125;&quot;</span>&gt;</span>Welcome to Thymeleaf!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 引入顯示 fragment --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">th:include</span>=<span class="string">&quot;fragments :: studentTable&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>controller 可以不用更動，但這樣抽成片段可以讓你嵌入任何你想要顯示的模板內。</p><p>以上就是一些基本的用法，這樣方便的整合真的是很適合後端工程師做一些簡單專案，如果需要一些前端處理可以透過這樣的框架輕鬆呈現，降低學習成本，不過這樣也是有一些優缺點，面對不同開發環境或是專案類型大家還是可以評估是否需要前後端分離，這邊也整理分享一下我認為一些前後端分離跟合併的優缺點</p><h2 id="前後端分離和合併的特色整理"><a href="#前後端分離和合併的特色整理" class="headerlink" title="前後端分離和合併的特色整理"></a>前後端分離和合併的特色整理</h2><table><thead><tr><th><strong>方面</strong></th><th><strong>前後端分離</strong></th><th><strong>前後端合併</strong></th></tr></thead><tbody><tr><td><strong>定義</strong></td><td>前端與後端開發為獨立系統，前端使用框架如 React&#x2F;Vue&#x2F;Angular 等，後端提供 API</td><td>前端與後端統一開發，通常使用如 Thymeleaf、JSP 等服務端渲染技術</td></tr><tr><td><strong>技術選擇自由度</strong></td><td>高，前後端可以選擇不同的技術</td><td>低，前後端技術需統一，受限於後端技術</td></tr><tr><td><strong>團隊合作效率</strong></td><td>高，前後端團隊可平行開發，互不影響</td><td>低，前後端開發耦合較高，需要更多協作</td></tr><tr><td><strong>可重用性</strong></td><td>高，後端 API 可被多個前端應用共享</td><td>低，前端與後端綁定，難以重用其他應用</td></tr><tr><td><strong>可維護性</strong></td><td>好，前後端獨立，修改不會相互影響</td><td>差，前後端修改需同步進行，耦合度高</td></tr><tr><td><strong>前端性能優化</strong></td><td>易，前端完全控制資源加載與渲染，可進行各種性能優化</td><td>難，受限於後端技術，性能優化空間有限</td></tr><tr><td><strong>開發初期成本</strong></td><td>高，需要額外搭建 API 與前端構建工具等基礎設施</td><td>低，整合開發環境，開發初期更為簡單</td></tr><tr><td><strong>部署與運維</strong></td><td>複雜，前後端獨立部署，需處理更多部署與運維細節</td><td>簡單，單一應用部署與運維更容易</td></tr><tr><td><strong>SEO 優勢</strong></td><td>低，前端渲染的應用對 SEO 不友好，需要額外處理</td><td>高，服務端渲染的應用對 SEO 更友好，爬蟲易於抓取</td></tr><tr><td><strong>應用場景</strong></td><td>- 大型或組織分工明確團隊，可同步開發，提升效率。(社交平台、電商)</td><td></td></tr></tbody></table><ul><li>有多平台需要通用 API。（如 Web、行動裝置、桌面應用）</li><li>迭代更動快速、可前後端分開的微服務系統。(SaaS、SaaP) | - 中小型團隊，簡化部屬及初期開發成本、降低偏後端人員的學習曲線</li><li>SEO 要求高 (新聞網站、Blog)</li><li>依賴後端邏輯，前端基本展示，前後端整合會更直觀。 （如 ERP、CRM） |</li></ul><hr><p>參考資料:</p><ul><li><a href="https://www.thymeleaf.org/">thymeleaf</a></li><li><a href="https://blog.csdn.net/weixin_44814196/article/details/135288104"><strong>前後端分離架構的特性以及優缺點</strong></a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Thymeleaf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring MVC - 基本介紹</title>
      <link href="/2024/09/22/SpringBoot/Spring-MVC-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%B4%B9/"/>
      <url>/2024/09/22/SpringBoot/Spring-MVC-%E5%9F%BA%E6%9C%AC%E4%BB%8B%E7%B4%B9/</url>
      
        <content type="html"><![CDATA[<h2 id="Spring-MVC"><a href="#Spring-MVC" class="headerlink" title="Spring MVC"></a>Spring MVC</h2><p>Spring MVC 是基於 Servlet API 建構的網頁開發框架，根據 MVC 架構的原則，提供了的合適的開發流程和功能，也是 Spring 框架的一部分，可與 Spring 生態系統無缝整合。</p><h2 id="Spring-MVC-中的-MVC-架構"><a href="#Spring-MVC-中的-MVC-架構" class="headerlink" title="Spring MVC 中的 MVC 架構"></a>Spring MVC 中的 MVC 架構</h2><p>一般我們常說到的 MVC 架構，就是 Model, View, Controller 這三層，在 Spring Boot 中則是定義成 Dao, Service, Controller, Template(View)，前端部分就是 View 層的處理，而 Spring Boot 則是針對後端資料部分進行處理剩下的 Controller、Model。</p><h3 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h3><ul><li>Controller: 針對請求首先進入的位置，就是一個 API 或是 APP 的進入點，通常只負責將請求處理，驗證，並讓符合格式的請求進入到後面 Service 進行後續資料處理</li></ul><h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><ul><li>Service: 業務邏輯處理，根據請求與資料庫溝通，拿出對應的資料進行操作</li><li>Dao: 負責與資料庫溝通的介面，早期透過 JPA 來處理，現多半透過資料庫操作的框架輔助像是 Spring Data JPA, JDBC Template, My batis 等</li></ul><h2 id="引入套件-Spring-Web"><a href="#引入套件-Spring-Web" class="headerlink" title="引入套件 Spring Web"></a>引入套件 Spring Web</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Spring Web (spring-boot-starter-web)套件就是 Spring MVC 的核心，引入之後就可以透過瀏覽器和我們啟動的程式有所連結，給與指定的 URL 就可以連結到我們程式的 Controller。</p><h2 id="URL-Routing"><a href="#URL-Routing" class="headerlink" title="URL Routing"></a>URL Routing</h2><p>我們要能夠使用 Spring MVC 的框架來完成一個請求，首先要把我們的端口和 URL 可以配對上，也就是 Routing，要完成這部分的配置就必須熟悉這套件提供給我們的一些註解的使用，可以參考先前 <a href="https://www.notion.so/Day-3-Bean-5b205fe4fa2e44758f9306a7906585e6?pvs=21">Day 3 - Bean 介紹及常見應用</a> 的 Web 與 RESTful API 部分，還有需要對於基本 HTTP 協定及方法要有一定了解， 底下就不做詳細介紹。</p><p>以下列出一些基本常見的用法舉例</p><p><code>@RestController</code> 和 <code>@Controller</code> 用來標記類別成為端口，標記後你就可以設定底下的方法成為端口。而 <code>@RestController</code> 會自動將返回的物件轉成 Json 格式， <code>@Controller</code> 通常是搭配前後端整合把 View 層的處理也整合進 Spring Boot，後面介紹到 Thymeleaf 這個前端模組就會講到。</p><p>假設我們需要來做一些基本的 CRUD 端口</p><table><thead><tr><th></th><th>Http Method</th><th>URL</th></tr></thead><tbody><tr><td>查詢商品</td><td>GET</td><td>&#x2F;api&#x2F;products&#x2F;{id}</td></tr><tr><td>新增商品</td><td>POST</td><td>&#x2F;api&#x2F;products</td></tr><tr><td>更新商品</td><td>PUT</td><td>&#x2F;api&#x2F;products&#x2F;{id}</td></tr><tr><td>刪除商品</td><td>DELETE</td><td>&#x2F;api&#x2F;products&#x2F;{id}</td></tr></tbody></table><p>設定端口就會需要配置接受的 http 方法參數等等，所以就要透過下面的註解來實現:</p><ul><li><code>@RequestMapping</code>，可以放在主類別表示進入這個地方的主要 URL path，如果根據上面 Restful 的設計，前面共同的區域 <code>/api/products</code> 就可以放在這裡去設定。也可以放在方法上定義每個方法的 URL path，但需要多帶入參數設定來配置端口的限制(http method, content type…)，使用上會建議方法可以用下面的，除非需要做很精細的配置或條件，選擇下面的方式比較簡潔明瞭。</li><li><code>@GetMapping</code> <code>@PostMapping</code> <code>@DeleteMapping</code> 等可以標記使用的 Http 方，這邊定義的路徑會接續上面 <code>@RequestMapping</code> 定義的後面</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/products&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> &#123;</span><br><span class="line">    <span class="comment">// 新增產品</span></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;成功新增產品&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查詢單一產品</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="comment">// @RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAllProducts</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;成功查詢產品&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新產品</span></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;成功更新產品&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 刪除產品</span></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;成功刪除產品&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>都改成使用 <code>@RequestMapping</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/products&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ProductController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 新增產品</span></span><br><span class="line">    <span class="meta">@RequestMapping(method = RequestMethod.POST)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">createProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;成功新增產品&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 查詢單一產品</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.GET)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAllProducts</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;成功查詢產品&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 更新產品</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.PUT)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">updateProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;成功更新產品&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 刪除產品</span></span><br><span class="line">    <span class="meta">@RequestMapping(value = &quot;/&#123;id&#125;&quot;, method = RequestMethod.DELETE)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">deleteProduct</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;成功刪除產品&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>大家可以自行用 Postman 或是 Talent Api Tester 這個 chrome 插件 (<a href="https://chromewebstore.google.com/detail/talend-api-tester-free-ed/aejoelaoggembcahagimdiliamlcdmfm?hl=zh-TW&amp;pli=1">https://chromewebstore.google.com/detail/talend-api-tester-free-ed/aejoelaoggembcahagimdiliamlcdmfm?hl=zh-TW&amp;pli=1</a>) 來測試一下上面的 api 回傳結果，通常啟動程式後預設 port 都是 8080，所以 server 的位置就是 <a href="http://localhost:8080，我們上面定義的路徑就是接著這個後面。">http://localhost:8080，我們上面定義的路徑就是接著這個後面。</a></p><p><code>http://localhost:8080/api/products</code> 對這個位置用 GET 請求就可以成功拿到回傳”成功查詢商品”<br><img src="https://ithelp.ithome.com.tw/upload/images/20240827/20150977kdSdqmj3nI.png" alt="https://ithelp.ithome.com.tw/upload/images/20240827/20150977kdSdqmj3nI.png"></p><p><a href="http://localhost:8080/api/products">http://localhost:8080/api/products</a> 如果這路徑用 PUT 方法請求會失敗，表示不允許的方法<br><img src="https://ithelp.ithome.com.tw/upload/images/20240827/20150977zexFWzs9Ad.png" alt="https://ithelp.ithome.com.tw/upload/images/20240827/20150977zexFWzs9Ad.png"></p><p>但如果用<code>http://localhost:8080/api/products/1</code> 就可以成功，因為我們上面定義的路徑要多帶 id<br><img src="https://ithelp.ithome.com.tw/upload/images/20240827/20150977rRUEEebHIu.png" alt="https://ithelp.ithome.com.tw/upload/images/20240827/20150977rRUEEebHIu.png"></p><hr><p>參考資料:</p><ul><li>[Spring MVC 介紹及使用]<a href="https://blog.csdn.net/m0_64338546/article/details/132071506">(https://blog.csdn.net/zzuhkp/article/details/120685952</a>)</li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>專案管理 Maven</title>
      <link href="/2024/09/21/SpringBoot/%E5%B0%88%E6%A1%88%E7%AE%A1%E7%90%86-Maven/"/>
      <url>/2024/09/21/SpringBoot/%E5%B0%88%E6%A1%88%E7%AE%A1%E7%90%86-Maven/</url>
      
        <content type="html"><![CDATA[<h2 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h2><p>Maven 是一個<strong>專案管理與自動化構建的工具</strong>，主要用於 Java 的專案。 目前由  Apache 軟體基金會管理。另外一個常見的工具 Gradle，這邊就不多介紹，主要的用途都類似。</p><p>是根據專案物件模型（Project Object Model, POM）概念設計，在 pom.xml 檔案中描述專案的基本資訊、與外部模組的依賴關係、建構順序、目錄與外掛程式，並執行 Maven 提供的構建方法就可快速完成編譯、打包等等。剛進入透過 Maven 管理的專案會自動從遠端的程式庫 (<a href="https://mvnrepository.com/">mvn repository</a>)下載依賴</p><h2 id="專案結構"><a href="#專案結構" class="headerlink" title="專案結構"></a>專案結構</h2><p>當我們剛創建好一個由 Maven 構建的 Spring Boot 專案，他的結構會像是下面這樣</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">my-spring-boot-app</span><br><span class="line">│   pom.xml</span><br><span class="line">└───src</span><br><span class="line">    └───main</span><br><span class="line">    │   ├───java</span><br><span class="line">    │   │   └───com</span><br><span class="line">    │   │       └───example</span><br><span class="line">    │   │           └───demo</span><br><span class="line">    │   │               └───DemoApplication.java</span><br><span class="line">    │   └───resources</span><br><span class="line">    │       ├───application.properties</span><br><span class="line">    │       └───static</span><br><span class="line">    │       └───templates</span><br><span class="line">    └───test</span><br><span class="line">        └───java</span><br><span class="line">            └───com</span><br><span class="line">                └───example</span><br><span class="line">                    └───demo</span><br><span class="line">                        └───DemoApplicationTests.java</span><br><span class="line"></span><br><span class="line">![https://ithelp.ithome.com.tw/upload/images/20240821/201509775QKIvymNt5.png](https://ithelp.ithome.com.tw/upload/images/20240821/201509775QKIvymNt5.png)</span><br><span class="line"></span><br><span class="line">## pom.xml</span><br><span class="line"></span><br><span class="line">可以點開 pom.xml</span><br><span class="line"></span><br><span class="line">```xml</span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns=&quot;http://maven.apache.org/POM/4.0.0&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">xsi:schemaLocation=&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span><br><span class="line">&lt;parent&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;3.3.2&lt;/version&gt;</span><br><span class="line">&lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line">&lt;groupId&gt;com.oseanchen&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;demoproj&lt;/artifactId&gt;</span><br><span class="line">&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</span><br><span class="line">&lt;name&gt;demoproj&lt;/name&gt;</span><br><span class="line">&lt;description&gt;demoproj&lt;/description&gt;</span><br><span class="line">&lt;url/&gt;</span><br><span class="line">&lt;licenses&gt;</span><br><span class="line">&lt;license/&gt;</span><br><span class="line">&lt;/licenses&gt;</span><br><span class="line">&lt;developers&gt;</span><br><span class="line">&lt;developer/&gt;</span><br><span class="line">&lt;/developers&gt;</span><br><span class="line">&lt;scm&gt;</span><br><span class="line">&lt;connection/&gt;</span><br><span class="line">&lt;developerConnection/&gt;</span><br><span class="line">&lt;tag/&gt;</span><br><span class="line">&lt;url/&gt;</span><br><span class="line">&lt;/scm&gt;</span><br><span class="line">&lt;properties&gt;</span><br><span class="line">&lt;java.version&gt;17&lt;/java.version&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;build&gt;</span><br><span class="line">&lt;plugins&gt;</span><br><span class="line">&lt;plugin&gt;</span><br><span class="line">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">&lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">&lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>這個檔案紀錄目前該專案所有重要構建資訊，</p><p>只要你對這份文件上面有進行任何修改 Maven 都會自動根據你的需求重新構建</p><p>一些重要資訊說明</p><h3 id="SpringBoot-相關資訊"><a href="#SpringBoot-相關資訊" class="headerlink" title="SpringBoot 相關資訊"></a>SpringBoot 相關資訊</h3><p>可以知道目前運行版本，如果直接改動 reload 後會自動轉換成不同版</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="專案資訊"><a href="#專案資訊" class="headerlink" title="專案資訊"></a>專案資訊</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.oseanchen<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>demoproj<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>demoproj<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>demoproj<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br></pre></td></tr></table></figure><p>groupId : 通常預設建議是公司或個人名稱及網域</p><p>artifactId: groupid 下一層 package，通常也是專案名稱</p><blockquote><p>仔細看一下專案結構會發現啟動類就放在 com.oseanchen.demoproj 下面，這也是根據當初建立專案時設定這些內容所產生</p></blockquote><p>version: 專案版本</p><p>name: 專案名稱</p><p>decription: 專案描述</p><h3 id="Java-版本"><a href="#Java-版本" class="headerlink" title="Java 版本"></a>Java 版本</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">java.version</span>&gt;</span>17<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="依賴-dependencies"><a href="#依賴-dependencies" class="headerlink" title="依賴(dependencies)"></a>依賴(dependencies)</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>這邊可以根據我們需要加入，如果你不確定對應的 gorupId, artifacId 可到 mvn repository 上面搜尋對應的套件名稱及版本(下圖紅框) 就可以根據同樣的格式引入，下面是只有引入 mysql，你可以選擇你要的版本進到最後資訊頁下面有引入的 xml (下圖綠框) 可以直接複製貼到 pom.xml 裡面</p><p><img src="https://ithelp.ithome.com.tw/upload/images/20240822/20150977E1uQPtwuBw.png" alt="https://ithelp.ithome.com.tw/upload/images/20240822/20150977E1uQPtwuBw.png"></p><h3 id="Maven-Lifecycle"><a href="#Maven-Lifecycle" class="headerlink" title="Maven Lifecycle"></a>Maven Lifecycle</h3><p>再來通常 IDE 都會整合 maven 的構建功能直接讓我們可以使用，也可以透過指令，但要另外安裝 maven 至本機，我這邊以 Intellij 提供 maven 整合的插件做說明，可以直接點選右邊 maven 圖示(我有改過 icon，所以原本應該是個 m 的圖示)，點開後選擇專案的 package 下面會有一個 life cycle，就可以看到整個專案構件的生命週期分成哪些步驟。</p><p><img src="https://ithelp.ithome.com.tw/upload/images/20240822/201509771qUmVDYZa0.png" alt="https://ithelp.ithome.com.tw/upload/images/20240822/201509771qUmVDYZa0.png"></p><h3 id="三種基本的-build-life-cycle"><a href="#三種基本的-build-life-cycle" class="headerlink" title="三種基本的 build life cycle:"></a>三種基本的 build life cycle:</h3><ul><li><strong>Clean Lifecycle</strong> — 清理專案的生命週期 (共 3 個 Phase) 用於清除先前建置或打包專案時所產生的檔案。通常在專案建置時，所產生的那些檔案都會被放置於 target 的資料夾底下，因此當你執行<code>clean</code> 的生命週期時，也就會把 target 資料夾給刪除。</li><li><strong>Default Lifecycle</strong> — 建構專案的預設生命週期 (共 23 個 Phase) 流程中，包含幾個重要階段下面會依照順序執行，也是 Intellij maven pulgin 右側選單可以看到的。<ol><li>validate：檢查專案是否所有必需的資訊都有符合或都為正確資訊。</li><li>compile：編譯專案的原始程式碼。</li><li>test：透過一些單元測試的框架來執行測試。</li><li>package：將編譯完成後的內容打包成被指定的格式，例如 .jar 或 .war，放入 target 資料夾內，顯示的名稱會是 pom.xml 專案資訊部分 artifactId + version。</li><li>verify：檢查測試結果，以確保專案的品質</li><li>install：將打包後的結果安裝在本地端的 maven repository，供其他本地端的專案導入使用。</li><li>deploy：在本地端(建構環境)中完成建構確認沒有錯誤發生後，就會將打包後的結果上傳到遠端的 maven repository 供全世界的人使用。</li></ol></li><li><strong>Site Lifecycle</strong> — 建立專案站點的生命週期(共 4 個 Phase)用於產生一些專案說明文件的網站，會將生成 html 的頁面作為網站的說明文件。</li></ul><p>當你執行了任何一個 Phase，則 maven 會從第一個 Phase 開始執行，直到你所指定的 Phase 執行完成後才會結束動作，除非中間有遇到問題，例如選擇 package 就會依序 validate → compile → test → package ，如果 test 有未通過就會中斷，測試部分是可以自己配置是否要略過。</p><p>實務上這些過程都會根據自身需求調整配置，像是多半現在許多專案都會配合 docker build , push 上雲等等，也可以加入 docker plugin 進行，不一定走完完整的 life cycle，這些就是基本 Maven 的構件 SpringBoot 專案的</p><p>Ref:</p><ul><li><a href="https://maven.apache.org/"><a href="http://maven.apache.org/">maven.apache.org</a></a></li><li><a href="https://ithelp.ithome.com.tw/articles/10303335">Maven 簡介</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
            <tag> Maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot Bean 介紹及常見應用</title>
      <link href="/2024/09/21/SpringBoot/Spring-Boot-Bean-%E4%BB%8B%E7%B4%B9%E5%8F%8A%E5%B8%B8%E8%A6%8B%E6%87%89%E7%94%A8/"/>
      <url>/2024/09/21/SpringBoot/Spring-Boot-Bean-%E4%BB%8B%E7%B4%B9%E5%8F%8A%E5%B8%B8%E8%A6%8B%E6%87%89%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Bean-註解-Annotation"><a href="#Spring-Bean-註解-Annotation" class="headerlink" title="Spring Bean (註解 Annotation)"></a>Spring Bean (註解 Annotation)</h1><p>由 Spring IoC 容器管理的對象稱為 Bean 。Bean 是由 Spring IoC 容器實例化、組裝和管理的對象。應用 Annotation 可以將一個物件註冊成為 Bean。</p><p>使用 Annotation 的好處:</p><ul><li>只要在任意的 class 開頭定義好，Spring 啟動後就會自動去找，不需要一個一個匯入</li><li>名稱就可以對應該 Class 要做甚麼或是被引入甚麼套件</li><li>Spring 會自動根據 Annotation 去將該 class 設定成特定的用途或是引入特定套件。</li></ul><h2 id="依照不同應用層面分類"><a href="#依照不同應用層面分類" class="headerlink" title="依照不同應用層面分類:"></a>依照不同應用層面分類:</h2><h3 id="1-配置與啟動"><a href="#1-配置與啟動" class="headerlink" title="1. 配置與啟動"></a>1. <strong>配置與啟動</strong></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>@SpringBootApplication</code>：<ul><li>結合了 <code>@Configuration</code>、<code>@EnableAutoConfiguration</code> 和 <code>@ComponentScan</code>，是啟動 Spring Boot 應用的核心註解。</li></ul></li><li><code>@Configuration</code>：<ul><li>標記一個類為配置類，通常用來定義 <code>@Bean</code> 方法。</li></ul></li><li><code>@ComponentScan</code>：<ul><li>自動掃描並註冊被 <code>@Component</code>、<code>@Service</code>、<code>@Repository</code> 等註解的類別，通常在 <code>@SpringBootApplication</code> 中已隱式配置。</li></ul></li><li><code>@EnableAutoConfiguration</code>：<ul><li>讓 Spring Boot 根據加入的依賴自動配置 Spring 應用程式，通常已被包含在 <code>@SpringBootApplication</code> 中。</li></ul></li></ul><h3 id="2-依賴注入-DI"><a href="#2-依賴注入-DI" class="headerlink" title="2. 依賴注入 (DI)"></a>2. <strong>依賴注入 (DI)</strong></h3><ul><li><code>@Component</code>：<ul><li>標記一個類別為 Spring 管理的組件（Bean），會自動加入到 Spring 容器中。</li></ul></li><li><code>@Service</code>：<ul><li><code>@Component</code>的一種，表示 Service 業務邏輯層的類別。</li></ul></li><li><code>@Repository</code>：<ul><li><code>@Component</code>的一種，表示 Dao 資料存取層的類別，並且會自動處理資料庫例外。</li></ul></li><li><code>@Controller</code>：<ul><li><code>@Component</code>的一種， 表示 Controller 端口控制層的類別，包含資料取得或是配合前端模板 Thymeleaf 等前端頁面呈現。</li></ul></li><li><code>@Autowired</code>：<ul><li>自動注入 Bean，各類別內部要使用已經註冊的 bean 就可以注入使用</li></ul></li><li><code>@Bean</code><ul><li>針對方法類進行 bean 注冊</li></ul></li><li><code>@Value</code>：<ul><li>用來注入配置檔中的值，通常從 <code>application.properties</code> 或 <code>application.yml</code> 中獲取。</li></ul></li></ul><h3 id="3-Web-與-RESTful-API"><a href="#3-Web-與-RESTful-API" class="headerlink" title="3. Web 與 RESTful API"></a>3. <strong>Web 與 RESTful API</strong></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>@RestController</code>：<ul><li>結合了 <code>@Controller</code> 和 <code>@ResponseBody</code>，表示這個類別是 RESTful Controller，方法返回的資料會直接轉換成 JSON 或 XML，用於純資料取得的 API 端口。</li></ul></li><li><code>@RequestMapping</code>：<ul><li>定義 Controller 中的 URL 規則，可以用於類別或方法上。也可以用更具體的註解如 <code>@GetMapping</code>, <code>@PostMapping</code>, <code>@PutMapping</code>, <code>@DeleteMapping</code> 來指定 HTTP 方法。</li></ul></li><li><code>@PathVariable</code>：<ul><li>用來擷取 URL 路徑中的參數，通常用在動態路徑中。</li></ul></li><li><code>@RequestParam</code>：<ul><li>用來擷取 URL 中的查詢參數或表單資料。</li></ul></li><li><code>@RequestBody</code>：<ul><li>用來將 HTTP 請求的 JSON 或 XML 資料直接轉換為 Java 物件，通常用於 POST&#x2F;PUT 請求。</li></ul></li><li><code>@ResponseBody</code>：<ul><li>將方法的返回值直接轉換為 JSON 或 XML 並返回給前端，適合 RESTful API。</li></ul></li></ul><h3 id="4-ORM-資料庫操作"><a href="#4-ORM-資料庫操作" class="headerlink" title="4. ORM, 資料庫操作"></a>4. ORM, <strong>資料庫操作</strong></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>@Entity</code>：<ul><li>標記一個類別為 JPA 實體，代表資料庫中的一個表格。</li></ul></li><li><code>@Table</code>：<ul><li>用來指定實體對應的資料表名稱，若不指定，預設會使用類名作為表名。</li></ul></li><li><code>@Id</code>：<ul><li>指定實體的主鍵欄位。</li></ul></li><li><code>@GeneratedValue</code>：<ul><li>指定主鍵的生成策略，常見的有 <code>IDENTITY</code>、<code>SEQUENCE</code> 等。</li></ul></li><li><code>@Column</code>：<ul><li>用來定義實體中屬性對應的資料庫欄位，包含名稱、長度等設定。</li></ul></li><li><code>@Repository</code>：<ul><li>用於標記資料存取層，搭配 Spring Data JPA 時，可以自動生成 CRUD 操作。</li></ul></li><li><code>@Query</code>：<ul><li>自定義查詢語句，適合需要複雜查詢的情境。</li></ul></li></ul><h3 id="5-AOP-與異常處理"><a href="#5-AOP-與異常處理" class="headerlink" title="5. AOP 與異常處理"></a>5. <strong>AOP 與異常處理</strong></h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li><code>@Aspect</code>：<ul><li>定義切面類別，用來實現橫切關注點。</li></ul></li><li><code>@Before</code>、<code>@After</code>、<code>@Around</code>：<ul><li>用來在方法執行的前、後或周圍插入額外的邏輯。</li></ul></li><li><code>@ExceptionHandler</code>：<ul><li>用於定義控制器中的異常處理方法。</li></ul></li></ul><h3 id="6-其他常用註解"><a href="#6-其他常用註解" class="headerlink" title="6. 其他常用註解"></a>6. <strong>其他常用註解</strong></h3><ul><li><code>@Valid</code>, <code>@Validated</code>：<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-validation<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>用於啟動 Bean 驗證，可限制參數或內部屬性輸入長度或是格式等等，通常和 <code>@RequestBody</code> 或 <code>@RequestParam</code> 搭配使用。</li></ul></li></ul><p>Ref:</p><ul><li><a href="https://zh.wikipedia.org/wiki/Java%E6%B3%A8%E8%A7%A3">Java 注解</a></li><li><a href="https://medium.com/@maskwork77.dev/prepare-2631b972c1f8">Java — Spring Annotation</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot 介紹</title>
      <link href="/2024/09/15/SpringBoot/Spring-Boot-%E4%BB%8B%E7%B4%B9/"/>
      <url>/2024/09/15/SpringBoot/Spring-Boot-%E4%BB%8B%E7%B4%B9/</url>
      
        <content type="html"><![CDATA[<h2 id="Spring-Boot"><a href="#Spring-Boot" class="headerlink" title="Spring Boot"></a>Spring Boot</h2><p>是 <strong>Java 最主流的後端開發框架</strong>，<strong>Spring Boot 其實算是早期的框架 Spring 的擴充升級</strong>，其核心的概念都有延續。過往框架 Spring 配置繁瑣，為跟上其他語言的框架，像是 Python (Django), PHP (Laravel) 等主流框架簡化配置的設計，所以才衍伸出 Spring Boot 快速整合管理 Spring 底下的各類模組 (Spring Data, Spring Security, Spring AOP、Spring MVC… ) 來達到快速開發。</p><p>主要框架核心概念就是<strong>控制反轉 (Inversion Of Control)</strong> 及 <strong>依賴注入 (Dependency Injection)</strong> 來達到解耦，減少程式碼之間的依賴性，增加開發彈性，詳細的說明請見 <a href="https://oseanchen.github.io/2024/02/21/SpringBoot/Spring-Boot-IOC-and-DI/">Spring Boot IOC and DI</a>。</p><p>Spring Boot 在啟動時，會執行元件掃描（component scan），找出具有元件標記的類別（如 @RestController、@Service、@Component），建立成元件（bean），並且將這些 bean 放入 Spring 的容器中統一管理。由於元件的物件實體不需要自己寫程式創建 (new) 出來，而是交給框架的容器機制來建立，所以 Spring 融入了 IOC 的精神。</p><h2 id="特色"><a href="#特色" class="headerlink" title="特色"></a>特色</h2><ul><li><strong>約定優於配置</strong>: 簡化開發採用許多預設值來配置應用程式，這些預設值可節省開發人員的時間和精力，改善 Java 傳統 Spring 框架通常需要在配置文件 (xml) 中進行大量的手動配置。</li><li><strong>簡單的開發</strong>：提供快速開發工具，如 Spring Initializr，可快速構建一個基本的 Spring Boot 應用程式，減少模組套件引用及專案建立時的配置，也整合 Maven 或 Grandle 等專案管理套件更加提升開發效率。</li><li><strong>嵌入式伺服器</strong>：提供嵌入式的 Tomcat、Jetty、Undertow、Netty，使開發者可以打包一個 JAR 檔案，直接運行，而不需要外部的應用伺服器。</li><li><strong>開箱即用</strong>：內建許多功能及配置，如資料庫連接、安全性、日誌紀錄和許多第三方庫的支持等。這些功能使得開發人員可以更快速地構建應用程式，而不必花費太多時間來處理底層細節。</li><li><strong>微服務整合</strong>：可輕鬆整合 Spring Cloud 框架來實現服務發現、負載均衡和數據處理等功能。</li></ul><hr><p>Ref:</p><ul><li><a href="https://spring.io/projects/spring-boot">Spring.io</a></li><li><a href="https://kucw.io/doc/springboot/1/">古古的後端筆記 - SpringBoot 簡介</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Security FilterChain 如何進行登入認證</title>
      <link href="/2024/09/14/SpringBoot/Spring-Security-FilterChain-%E5%A6%82%E4%BD%95%E9%80%B2%E8%A1%8C%E7%99%BB%E5%85%A5%E8%AA%8D%E8%AD%89/"/>
      <url>/2024/09/14/SpringBoot/Spring-Security-FilterChain-%E5%A6%82%E4%BD%95%E9%80%B2%E8%A1%8C%E7%99%BB%E5%85%A5%E8%AA%8D%E8%AD%89/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>進行 Spring Security 的實作時碰到很多底層運行架構不是很了解的狀況，上網查找一些資訊拼湊出一個比較容易理解的流程。主要是針對帳號密碼登入時的授權部分，因為牽涉到很多元件的運作，所以需要整理一下。</p></div><h3 id="帳號密碼認證流程"><a href="#帳號密碼認證流程" class="headerlink" title="帳號密碼認證流程"></a>帳號密碼認證流程</h3><p>認證和授權動作都是在請求到達 Spring MVC 的運作之前，Security 就已經透過一套機制進行一系列的驗證，首先會先碰到的就是</p><ul><li>(1) <strong><code>Filter Chain</code></strong> 的系統，這邊會透過一系列的過濾篩選，只要請求的一些 header 或是任何內容有不符合的就會先被過濾掉，算是攔截器的概念，層層篩選其中關於登入的部分會由 <strong><code>UsernamePasswordAuthenticationFilter</code></strong> 進行處理，接著會被導入</li><li>(2) <strong><code>Authentication Manager</code></strong> 統一針對授權去管理，從一堆 Provider 中找到一個可以成功認證的</li><li>(3) <strong><code>Authentication Provider</code></strong> 來判斷帳號密碼是否正確，密碼的加密及認證等等處理 (配置密碼加密的類型 PasswordEncoder 也是從這邊設置)，他會從 <strong><code>UserDetailService</code></strong> 這個介面取出對應的 User 並且結合其他資訊封裝成 <strong><code>UserDetails</code></strong> (使用者相關資訊、權限…) 這個 Security 所使用的使用者資訊界面物件，然後交由</li><li>(4) <strong><code>Authentication Provider</code></strong> 使用進行驗證，</li><li>(5) (6) 如果驗證成功就會產生一個 已驗證的 <strong><code>Authentication</code></strong> 物件存於 <strong><code>Security Context</code></strong> ，這位置預設保存在 Session ，所以 Authentication 會和 Session 綁訂，後續請求也都可以重複取出使用，不必重新驗證。如果失敗就拋出例外回前端。</li><li>成功的話 (7) 接著就會將請求導入後續我們熟悉的 MVC 架構流程。</li></ul><p><img src="https://ithelp.ithome.com.tw/upload/images/20240914/201509773bAvCQLiQT.png" alt="https://ithelp.ithome.com.tw/upload/images/20240914/201509773bAvCQLiQT.png"></p><hr><p>參考資料:</p><ul><li><a href="https://backendstory.com/spring-security-authentication-architecture-explained-in-depth/">Spring Security: Authentication Architecture Explained In Depth</a></li><li><a href="https://medium.com/@heather_programming/spring-security-%E5%B8%B3%E8%99%9F%E5%AF%86%E7%A2%BC%E9%A9%97%E8%AD%89-98a4bfd03abe">Spring Security】帳號密碼驗證</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot Scheduled</title>
      <link href="/2024/05/14/SpringBoot/Spring-Boot-Scheduled/"/>
      <url>/2024/05/14/SpringBoot/Spring-Boot-Scheduled/</url>
      
        <content type="html"><![CDATA[<h2 id="排程服務-Cronjob"><a href="#排程服務-Cronjob" class="headerlink" title="排程服務 Cronjob"></a>排程服務 Cronjob</h2><ul><li>排程服務主要應用針對例行的處理，根據設定的時間或是間隔自動啟動 ​</li><li>多應用 cron 的表達式去設定 ​</li><li>常見應用的服務如 Cron, Spring Task Scheduling, windows 任務排程器, Airflow, 各雲端服務商對應的 Cronjob​ 服務</li></ul><h2 id="Spring-Task-Scheduling-用法"><a href="#Spring-Task-Scheduling-用法" class="headerlink" title="Spring Task Scheduling 用法"></a>Spring Task Scheduling 用法</h2><ol><li>要執行排程的 class 加入 <code>@Component</code> 變成 bean</li><li>SpringApplication.run 的啟動類加上 <code>@EnableScheduling</code> 才會啟用 ​</li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Cronjob </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring AOP</title>
      <link href="/2024/04/10/SpringBoot/Spring-AOP/"/>
      <url>/2024/04/10/SpringBoot/Spring-AOP/</url>
      
        <content type="html"><![CDATA[<h2 id="AOP-Aspect-Oriented-Programming-切面導向設計"><a href="#AOP-Aspect-Oriented-Programming-切面導向設計" class="headerlink" title="AOP (Aspect Oriented Programming) 切面導向設計"></a>AOP (Aspect Oriented Programming) 切面導向設計</h2><ul><li><p>是一種程式設計的模式，主要理念是<strong>為了減少重複出現的邏輯</strong>，比方說 log 紀錄，登入驗證、資料驗證等重複性事務，如果多個方法都需要執行到這類方法，就可以抽出來透過定義在切面中，減少程式耦合及方便去進行維護，讓開發者可以專注在更重要的業務邏輯中。</p></li><li><p>如同下圖每個箭頭是不同的方法或流程，如每個方法都要加入同樣的處理，就可以當成一個切面抽出來所以像是 log, security 的部分就被稱為 cross-cutting concerns 但都可以抽出共同需要處理的部分作為切面（藍色及綠色）。</p></li></ul><p><img src="https://i.ibb.co/nwbF551/aop.png"></p><ul><li>SpringBoot 本身也提供好用的註解去實踐這樣的設計模式，可以進行切面的操作，你可以根據切入點的執行前中後等等進行設定，以控制我們的方法執行的順序。</li></ul><h2 id="Spring-AOP-使用"><a href="#Spring-AOP-使用" class="headerlink" title="Spring AOP 使用"></a>Spring AOP 使用</h2><h3 id="定義切面"><a href="#定義切面" class="headerlink" title="定義切面"></a>定義切面</h3><ul><li>通常要使用 Spring Boot AOP 需要先將切面定義出來，會在我們需要標記的切面類別上加上 <code>@Aspect</code>，且注意需要加上<code>＠Component</code> 將類別標記成為 bean 才可以使用</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="comment">// 撰寫切面處理方法及控制發動時間..</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>把需要的東西注入及標註哪些方法需要被 <code>@Pointcut</code> 標記為切入點套用切面</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="built_in">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// com.example.demoaop.TestController class 內所有的方法（不包含子 package）會生效</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.example.demoaop.TestController.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointcut</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Execution-切入點"><a href="#Execution-切入點" class="headerlink" title="Execution 切入點"></a>Execution 切入點</h3><p>關於切入點 execution 表達式:</p><p>切入點為 com.example.demo.Test 底下的 print() 方法</p><p><code>execution(* com.example.demo.Test.print())</code></p><p>切入點為 com.example.demo.Test 底下的所有方法</p><p><code>execution(* com.example.demo.Test.*(..))</code></p><p>切入點為 com.example.demo 這個 package 中的所有 class 的所有方法（不包含子 package）</p><p><code>execution(* com.example.demo.*(..))</code></p><p>切入點為 com.example.demo 這個 package 及其底下所有子 package 中的所有 class 的所有方法</p><p><code>execution(* com.example.demo..*(..))</code></p><h3 id="Advice-切面控制"><a href="#Advice-切面控制" class="headerlink" title="Advice 切面控制"></a>Advice 切面控制</h3><p>控制切面的執行被稱為 Advice ，Spring 有提供 5 種 Advice 可以讓你操作方法需要執行的時間</p><ol><li><code>@Before</code> : 在切入點執行前前執行切面。</li><li><code>@After</code> : 在切入點執行後後執行切面。</li><li><code>@AfterReturning</code> : 在切入點傳回(return)內容後執行，可以對傳回內容進行一些加工處理。</li><li><code>@Around</code> : 在切入點前後執行切面，並配合 proceed 可控制何時執行切入點本身的內容。</li><li><code>@AfterThrowing</code> : 當切入點拋出例外後執行</li></ol><h2 id="範例及應用"><a href="#範例及應用" class="headerlink" title="範例及應用"></a>範例及應用</h2><ul><li>controller</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demoaop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestController</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test/&#123;word&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test</span><span class="params">(<span class="meta">@PathVariable</span> String word)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (word.equals(<span class="string">&quot;yes&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> word;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>AOP 定義類別</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.demoaop;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="built_in">this</span>.getClass());</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.example.demoaop.TestController.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pointcut</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;*****before advice start*****&quot;</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;do before &quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">        Arrays.stream(joinPoint.getArgs()).forEach(System.out::println);</span><br><span class="line">        System.out.println(<span class="string">&quot;*****before advice end*****&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">(JoinPoint joinPoint)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;-----after advice start-----&quot;</span>);</span><br><span class="line">        logger.info(<span class="string">&quot;do after &quot;</span> + joinPoint.getSignature().getName());</span><br><span class="line">        System.out.println(<span class="string">&quot;-----after advice end-----&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;pointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====Around advice starts=====&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 呼叫proceed() 方法開始執行原方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">        <span class="type">long</span> <span class="variable">spentTime</span> <span class="operator">=</span> System.currentTimeMillis() - startTime;</span><br><span class="line">        logger.info(joinPoint.getSignature().getName() + <span class="string">&quot; Time spent: &quot;</span> + spentTime);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;=====Around advice ends=====&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(pointcut = &quot;pointcut()&quot;, returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logReturnResponse</span><span class="params">(Object result)</span> &#123; <span class="comment">// 紀錄 Response</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=====after returning advice starts=====&quot;</span>);</span><br><span class="line">        <span class="keyword">if</span> (result != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(result);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====after returning advice ends=====&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(pointcut = &quot;pointcut()&quot;, throwing = &quot;throwable&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">(JoinPoint joinPoint, Throwable throwable)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;=====after throwing advice starts=====&quot;</span>);</span><br><span class="line">        System.out.println(joinPoint.getSignature().getName());</span><br><span class="line">        System.out.println(throwable);</span><br><span class="line">        System.out.println(<span class="string">&quot;=====after throwing advice ends=====&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>如果當我啟動後並且透過 TestController 的 test 方法進行請求並帶入 “no”，就會看到以下 log 顯示</p><p><img src="https://ithelp.ithome.com.tw/upload/images/20240927/201509778ELfzgftIm.png" alt="https://ithelp.ithome.com.tw/upload/images/20240927/201509778ELfzgftIm.png"></p><blockquote><p>around start -&gt;<br>before start -&gt; before method -&gt; before end -&gt;<br>after returning start -&gt; after returning method -&gt; after returning end -&gt;<br>after start -&gt; after method -&gt; after end -&gt;<br>(proceed 控制執行 around 內容) around method -&gt; around end</p></blockquote><p>如果是請求帶 yes 導致中途拋出異常就會變成</p><p><img src="https://ithelp.ithome.com.tw/upload/images/20240927/20150977XJUuxogSCl.png" alt="https://ithelp.ithome.com.tw/upload/images/20240927/20150977XJUuxogSCl.png"></p><blockquote><p>around start -&gt;<br>before start -&gt; before method -&gt; before end -&gt;<br>(拋出錯誤所以沒有 return 不執行 after returning，改執行 after throwing) after throwing start -&gt; after throwing method -&gt; after throwing end -&gt;<br>after start -&gt; after method -&gt; after end -&gt; 拋錯</p></blockquote><p>*after 不管有沒有拋錯都執行</p><p>所以這就是基本 AOP 的用法，大家應該對於相關的切面控制都有一定的了解了，不妨可以嚐試加入自己的專案內，針對一些特定位置重複會進行的方法或是 log 紀錄抽出來作為切面，這樣設計可以讓程式碼更加簡潔。</p><p><strong>參考資料:</strong></p><ol><li><a href="https://chikuwa-tech-study.blogspot.com/2021/06/spring-boot-aop-introduction.html">【Spring Boot】第 20 課－切面導向程式設計（AOP）</a></li><li><a href="https://openhome.cc/Gossip/Spring/SpringAOP.html">使用 Spring AOP</a></li><li><a href="https://ithelp.ithome.com.tw/m/articles/10329009">Spring Boot 零基礎入門 (12) - Spring AOP 的用法</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> Design Pattern </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Boot IOC and DI</title>
      <link href="/2024/02/21/SpringBoot/Spring-Boot-IOC-and-DI/"/>
      <url>/2024/02/21/SpringBoot/Spring-Boot-IOC-and-DI/</url>
      
        <content type="html"><![CDATA[<h1 id="Day-2-控制反轉-IOC-vs-依賴注入-DI"><a href="#Day-2-控制反轉-IOC-vs-依賴注入-DI" class="headerlink" title="Day 2 - 控制反轉 (IOC) vs 依賴注入(DI)"></a>Day 2 - 控制反轉 (IOC) vs 依賴注入(DI)</h1><h2 id="控制反轉-Inversion-of-Control-IOC"><a href="#控制反轉-Inversion-of-Control-IOC" class="headerlink" title="控制反轉 Inversion of Control (IOC)"></a>控制反轉 Inversion of Control (IOC)</h2><p>控制反轉是一種程式設計的方式。它的精神在於程式中所<strong>需要的輔助物件，並不是在自己的類別中建立，而是由外部控制的</strong>。建立好後，將其傳遞給主程式，這個動作稱為依賴注入，是控制反轉的實現方式。</p><ul><li>將 Object 的控制權交給外部的 Spring 容器來管理</li></ul><h2 id="依賴注入-dependency-injection-DI"><a href="#依賴注入-dependency-injection-DI" class="headerlink" title="依賴注入 dependency injection (DI)"></a>依賴注入 dependency injection (DI)</h2><p>實現控制反轉的方式，Spring 的設計目標之一是為了解隅，利用依賴抽象而非依賴實例的方式，因此設計了依賴注入(DI)。</p><ul><li>@Component , @RestController @Service … 等註各類解加在 class 上，將 class 交給 Spring 管理，這些也就是在 Spring Boot 中所謂的 Bean (後面章節會有詳細介紹)</li><li>@Autowired 將被管理的 Bean 注入</li></ul><h2 id="應用範例"><a href="#應用範例" class="headerlink" title="應用範例"></a>應用範例</h2><ul><li>舉例來說有個物件專門來處理寄送訊息叫做 Sender ，我們需要使用到這個物件就必須透過 new 方法來建立出來，假設今天原本的 Sender 有問題更改成別種 Sender ，就必須有建立這個物件的地方都需要修改一遍，這時候改成用 DI 的方式就會比較容易維護及更動。</li></ul><p>沒有使用 DI 方式，使用 New 方法來建立物件並引用</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Notify</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Sender</span> <span class="variable">sender</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sender</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果需要更換方法，每個有用到的地方都要改</span></span><br><span class="line">    <span class="comment">// private NewSender sender = new NewSender();</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Send</span><span class="params">()</span> &#123;</span><br><span class="line">        sender.print(<span class="string">&quot;Hi! I&#x27;m Sean&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Autowired-注入單一實做物件"><a href="#Autowired-注入單一實做物件" class="headerlink" title="@Autowired 注入單一實做物件"></a>@Autowired 注入單一實做物件</h3><p>將 Sender 交給 Spring 容器管理，使用 @Autowired 注入去使用，等於是透過 Spring 去建立物件出來</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Notify</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果要更改方法，往上註冊為 bean 的部分修改就可以，注入部分不需要改變</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Sender sender;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Send</span><span class="params">()</span> &#123;</span><br><span class="line">        sender.print(<span class="string">&quot;Hi! I&#x27;m Sean&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Autowired-注入介面內含多個已實做物件"><a href="#Autowired-注入介面內含多個已實做物件" class="headerlink" title="@Autowired 注入介面內含多個已實做物件"></a>@Autowired 注入介面內含多個已實做物件</h3><p>如果我們可能有多種 Sender 需要去實踐，可以用 interface 來建立一個介面去分成不同方法實踐</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Sender</span> &#123;</span><br><span class="line"><span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String msg)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GoogleMailSender</span> <span class="keyword">implements</span> <span class="title class_">Sender</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;內容: &quot;</span> + msg + <span class="string">&quot; 我用 Google 郵件寄出了!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OutlookMailSender</span> <span class="keyword">implements</span> <span class="title class_">Sender</span> &#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;內容: &quot;</span> + msg + <span class="string">&quot; 我用 Outlook 郵件寄出了!!&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>可以將 @Component 選擇注入其中一種，Spring 容器會自動幫我們選擇我們有注入的那個，但如果兩種都注入，就會出現錯誤，所以要再選擇用 @Qualifier(”bean 名稱”) 註解來指定要入住哪個</p><ul><li><ul><li>注意注入容器的 bean 名稱開頭是小寫</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Notify</span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifer(&quot;GoogleMailSender&quot;)</span> <span class="comment">//  @Qualifer(&quot;outlookMailSender&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Sender sender;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">Send</span><span class="params">()</span> &#123;</span><br><span class="line">        sender.print(<span class="string">&quot;Hi! I&#x27;m Sean&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="總結："><a href="#總結：" class="headerlink" title="總結："></a>總結：</h2><p>利用 IOC 和 DI 可以有以下優點:</p><ul><li>鬆耦合</li></ul><p>class 之間的鬆耦合，降低各個 class 之間的關聯性。</p><p>像是假設我們本來得在 Notify 中去指定要使用的是哪家廠牌的 MailSender（可能是 google, yahoo…） 而這就會讓 Notify 和 MailSender 的耦合變大，但使用了 Spring IoC 之後，不需要了解這個 Sender 是哪種，只要確定有被正確注入某種可以使用的 MailSender。</p><ul><li>統一生命週期管理</li></ul><p>交由 Spring 容器來管理這些物件的生命週期，減少不必要的引用。</p><p>因為我們將 MailSender 這個 object 改成是交由 Spring 容器來管理，因此 Spring 就會負責物件的創建、初始化、以及銷毀，所以就不需要我們親自去處理這件事情。</p><ul><li>方便測試程式</li></ul><p>可以方便注入至所需要測試的程式中</p><p>所有的 object 都是由外部的 Spring 容器來做管理，因此我們就可以輕鬆在測試程式內在測試的過程中，將 Spring 容器中的 object 給替換掉，容易的使用像是 Mock 的技術。</p><hr><p>Ref:</p><ul><li><a href="https://kucw.io/doc/springboot/7/">古古的後端筆記 - Bean 的創建和注入 - @Component、@Autowired</a></li><li><a href="notion://www.notion.so/%5B%3Chttps://zh.wikipedia.org/zh-tw/%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%3E%5D(%3Chttps://zh.wikipedia.org/zh-tw/%E6%8E%A7%E5%88%B6%E5%8F%8D%E8%BD%AC%3E)">控制反轉</a></li><li><a href="https://medium.com/javarevisited/spring-beans-in-depth-a6d8b31db8a1">Spring Beans in Depth</a></li><li>Java 工程師必備！Spring Boot 零基礎入門 （hahow 課程）</li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JPA, JDBC, Hibernate</title>
      <link href="/2024/02/16/SpringBoot/JPA,%20JDBC,%20Hibernate/"/>
      <url>/2024/02/16/SpringBoot/JPA,%20JDBC,%20Hibernate/</url>
      
        <content type="html"><![CDATA[<h2 id="JPA-Java-Persistance-API"><a href="#JPA-Java-Persistance-API" class="headerlink" title="JPA (Java Persistance API)"></a>JPA (Java Persistance API)</h2><ul><li><p>字面意思就是一個 Java 的持久化 API，將資料「儲存」與「讀取」的過程，就稱為「持久化」也可以說是將資料儲存到資料庫的過程。</p></li><li><p>JPA 其實是一個 Java 標準，定義了一組用於 ORM 的 API。它提供了一個標準的方法，使 Java 開發者能夠透過標準的介面來執行 ORM 操作，而不受特定數據庫供應商或是 ORM 框架的限制。</p></li></ul><h2 id="Hibernate"><a href="#Hibernate" class="headerlink" title="Hibernate"></a>Hibernate</h2><ul><li>Hibernate 是一個開源的 ORM 框架，實現了 JPA 標準，是 Java 中最廣泛使用的 ORM 框架之一。</li></ul><h2 id="JDBC-Java-Database-Connectivity"><a href="#JDBC-Java-Database-Connectivity" class="headerlink" title="JDBC (Java Database Connectivity)"></a>JDBC (Java Database Connectivity)</h2><ul><li>JDBC 是透過 Java 來連接資料庫的一種技術。它提供了一組用於執行 SQL 查詢、更新和管理數據庫連接的 Java 介面。透過 JDBC，Java 可以與各種不同的數據庫系統進行通信。</li></ul><h2 id="Spring-JDBC"><a href="#Spring-JDBC" class="headerlink" title="Spring JDBC"></a>Spring JDBC</h2><ul><li>由 Spring 提供基於 JDBC 的模組，它提供了一個抽象層，用於簡化 JDBC 操作並處理資源管理。允許開發者使用簡單的 API 來執行 SQL 查詢、更新、刪除等操作，<strong>仍需使用原始的 SQL 語法進行資料庫操作</strong>。</li></ul><h2 id="Spring-Data-JPA"><a href="#Spring-Data-JPA" class="headerlink" title="Spring Data JPA"></a>Spring Data JPA</h2><ul><li>Spring Data 項目中的一部分，它是對 Java Persistence API (JPA) 的實現，<strong>應用了 ORM 的概念，並操作 JAVA object 的方式來進行資料庫的操作</strong>，並且可以用於多種數據庫，而不僅僅是關聯式數據庫。</li></ul><hr><p><strong>參考資料:</strong></p><ol><li><p><a href="https://medium.com/learning-from-jhipster/13-%E7%94%9A%E9%BA%BC%E6%98%AF-jdbc-orm-jpa-orm%E6%A1%86%E6%9E%B6-hibernate-c762a8c5e112">甚麼是 JDBC、ORM、 JPA、ORM 框架、Hibernate</a></p></li><li><p><a href="https://www.baeldung.com/learn-jpa-hibernate">Learn JPA &amp; Hibernate</a></p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>編碼(encoding) vs 加解密 vs 雜湊(Hash)</title>
      <link href="/2023/08/23/%E7%B7%A8%E7%A2%BC-encoding-vs-%E5%8A%A0%E8%A7%A3%E5%AF%86-vs-%E9%9B%9C%E6%B9%8A-Hash/"/>
      <url>/2023/08/23/%E7%B7%A8%E7%A2%BC-encoding-vs-%E5%8A%A0%E8%A7%A3%E5%AF%86-vs-%E9%9B%9C%E6%B9%8A-Hash/</url>
      
        <content type="html"><![CDATA[<h2 id="編碼-Encoding"><a href="#編碼-Encoding" class="headerlink" title="編碼(Encoding)"></a>編碼(Encoding)</h2><p>將原本的資料經過運算轉換成另一組資料,如果要還原可透過反向解碼(decoding)<br><strong>ex: Base64, URl, UTF-8</strong></p><h2 id="加解密-Encrypt-and-Decrypt"><a href="#加解密-Encrypt-and-Decrypt" class="headerlink" title="加解密(Encrypt and Decrypt)"></a>加解密(Encrypt and Decrypt)</h2><p>將資料透過一個 <strong>Key</strong> 來做加密或解密轉換(和編碼最大的差別)<br>可以根據鑰匙是否相同分成<strong>對稱式</strong>與<strong>非對稱</strong></p><h4 id="對稱式加密-Symmetric-Encryption-DES-x2F-Triple-DES、AES"><a href="#對稱式加密-Symmetric-Encryption-DES-x2F-Triple-DES、AES" class="headerlink" title="對稱式加密 (Symmetric Encryption) (DES&#x2F;Triple DES、AES)"></a>對稱式加密 (Symmetric Encryption) (DES&#x2F;Triple DES、AES)</h4><p>鑰匙相同，加密及解密都共用</p><p><strong>- AES（Advanced Encryption Standard）</strong><br><strong>- DES（Data Encryption Standard）</strong><br><strong>- DES&#x2F;Triple</strong></p><p>AES 是目前被廣泛接受和使用的加密方式，因提供了更高的安全性和更快的加密速度。DES 和 DES&#x2F;Triple DES 由於安全性弱和性能較慢，通常不是首選。</p><h4 id="非對稱式加密-Asymmetric-Encryption-RSA-演算法"><a href="#非對稱式加密-Asymmetric-Encryption-RSA-演算法" class="headerlink" title="非對稱式加密 (Asymmetric Encryption) (RSA 演算法)"></a>非對稱式加密 (Asymmetric Encryption) (RSA 演算法)</h4><p>加密與解密方式為：<strong>公鑰加密，私鑰解密</strong></p><p><strong>ex: RSA、ECC</strong></p><h2 id="雜湊-Hash"><a href="#雜湊-Hash" class="headerlink" title="雜湊(Hash)"></a>雜湊(Hash)</h2><p>SHA256 Hash 幾個特點:</p><ul><li>不管資料量多大經過 SHA256 運算字串長度都是一樣的</li><li>運算完的資料大小一定是 256 bit</li><li>不可逆的算法</li><li>相同的值用 SHA 運算過後值都是一樣的</li><li>資料加密上可以做到防竄改，確認演算前的值要完全一樣，且不可逆</li></ul><p><strong>ex: SHA-256、MD5</strong></p><h2 id="表格總結"><a href="#表格總結" class="headerlink" title="表格總結"></a>表格總結</h2><table><thead><tr><th align="left"></th><th align="center">可逆</th><th align="center">運算後長度</th><th align="center">安全性</th><th>Key</th></tr></thead><tbody><tr><td align="left">雜湊演算</td><td align="center">不可</td><td align="center">一樣</td><td align="center">高</td><td>無</td></tr><tr><td align="left">編碼</td><td align="center">可</td><td align="center">不一樣</td><td align="center">不高</td><td>無</td></tr><tr><td align="left">加解密</td><td align="center">可</td><td align="center">不一樣</td><td align="center">高</td><td>有</td></tr></tbody></table><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ol><li><a href="https://medium.com/@RiverChan/%E5%9F%BA%E7%A4%8E%E5%AF%86%E7%A2%BC%E5%AD%B8-%E5%B0%8D%E7%A8%B1%E5%BC%8F%E8%88%87%E9%9D%9E%E5%B0%8D%E7%A8%B1%E5%BC%8F%E5%8A%A0%E5%AF%86%E6%8A%80%E8%A1%93-de25fd5fa537">基礎密碼學(對稱式與非對稱式加密技術)</a></li><li><a href="https://hackmd.io/@HuangPX/B1boJwRht?utm_source=preview-mode&utm_medium=rec">密碼學</a></li><li><a href="https://blog.darkthread.net/blog/store-pwd-safely/">密碼要怎麼儲存才安全？該加多少鹽？-科普角度</a></li><li><a href="https://hitcon.org/2018/CMT/slide-files/d1_s2_r4.pdf">應用密碼學入門</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 密碼學 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 編碼 </tag>
            
            <tag> 加密 </tag>
            
            <tag> 雜湊演算 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>.equals() 和 == 差別</title>
      <link href="/2023/05/22/Java/equals-%E5%92%8C-%E5%B7%AE%E5%88%A5/"/>
      <url>/2023/05/22/Java/equals-%E5%92%8C-%E5%B7%AE%E5%88%A5/</url>
      
        <content type="html"><![CDATA[<h2 id="“-x3D-x3D-”"><a href="#“-x3D-x3D-”" class="headerlink" title="“&#x3D;&#x3D;”"></a>“&#x3D;&#x3D;”</h2><ul><li>是用來判斷兩個比較物件是不是有相同的 references。</li><li>每一個物件都有獨立的 reference，假如 reference 不同就表示它們是不同的物件。</li></ul><h2 id="equals"><a href="#equals" class="headerlink" title=".equals()"></a>.equals()</h2><ul><li>是用來比較物件的值(儲存在 heap 上的值)。</li><li>可以判斷兩個有不同 references 的物件是否指向相同的值</li></ul><h2 id="總結："><a href="#總結：" class="headerlink" title="總結："></a>總結：</h2><ul><li>&#x3D;&#x3D; 比較的是兩個對象的引用或基本數據類型的值。</li><li>.equals() 比較的是兩個對象的內容，通常需要被覆寫，並根據自定義的邏輯進行比較。</li></ul><p>在使用時，需要注意以下幾點：</p><blockquote><ul><li>對於基本數據類型，應該使用 &#x3D;&#x3D; 來進行相等性比較。</li><li>對於引用類型，如果只是想比較兩個對象是否引用同一個 reference，可以使用 &#x3D;&#x3D;。如果需要比較兩個對象的內容的值是否相等，應該使用 .equals() 方法。</li><li>在使用 .equals() 方法時，需要注意處理 null 值的情況，以避免 NullPointerException。可以使用 Objects.equals() 方法（Java 7+）或自定義的邏輯來處理 null 值。</li></ul></blockquote>]]></content>
      
      
      <categories>
          
          <category> Java 基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>StringUtils 常用判斷字串方法與 Java 內建方法比較</title>
      <link href="/2023/05/22/Java/StringUtils-%E5%B8%B8%E7%94%A8%E5%88%A4%E6%96%B7%E5%AD%97%E4%B8%B2%E6%96%B9%E6%B3%95%E8%88%87-Java-%E5%85%A7%E5%BB%BA%E6%96%B9%E6%B3%95%E6%AF%94%E8%BC%83/"/>
      <url>/2023/05/22/Java/StringUtils-%E5%B8%B8%E7%94%A8%E5%88%A4%E6%96%B7%E5%AD%97%E4%B8%B2%E6%96%B9%E6%B3%95%E8%88%87-Java-%E5%85%A7%E5%BB%BA%E6%96%B9%E6%B3%95%E6%AF%94%E8%BC%83/</url>
      
        <content type="html"><![CDATA[<h2 id="Java-內建方法"><a href="#Java-內建方法" class="headerlink" title="Java 內建方法"></a>Java 內建方法</h2><p>Java 本身提供幾個關於字串的判斷，會因為 null 產生 exception</p><h4 id="isEmpty"><a href="#isEmpty" class="headerlink" title="isEmpty()"></a><code>isEmpty()</code></h4><p>字串有長度(空白也算)就是 false</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>.isEmpty();     <span class="comment">//true</span></span><br><span class="line"><span class="string">&quot; &quot;</span>.isEmpty();    <span class="comment">//false</span></span><br><span class="line"><span class="string">&quot;blank&quot;</span>.isEmpty();  <span class="comment">//false</span></span><br><span class="line"><span class="literal">null</span>.isEmpty(); <span class="comment">// NullPointerException</span></span><br></pre></td></tr></table></figure><h4 id="isBlank"><a href="#isBlank" class="headerlink" title="isBlank()"></a><code>isBlank()</code></h4><p>字串有長度沒文字還是 true</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;123&quot;</span>.isBlank();  <span class="comment">//false</span></span><br><span class="line"><span class="string">&quot;&quot;</span>.isBlank();     <span class="comment">//true</span></span><br><span class="line"><span class="string">&quot; &quot;</span>.isBlank();    <span class="comment">//true</span></span><br><span class="line"><span class="literal">null</span>.isBlank(); <span class="comment">// NullPointerException</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="StringUtils"><a href="#StringUtils" class="headerlink" title="StringUtils"></a>StringUtils</h2><p>StringUtils 用於處理 String 的，提供了比 Java String 多更多實用方法，且<strong>不會因為 null 而產生 exception</strong>。<br>屬於 Apache (org.apache.commons.lang.StringUtils) 的操作 String 類型數據常用工具套件</p><h4 id="StringUtils-isBlank"><a href="#StringUtils-isBlank" class="headerlink" title="StringUtils.isBlank()"></a><code>StringUtils.isBlank()</code></h4><ul><li>null [o]</li><li>空字串 [o]</li><li>空格 [o]</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.isBlank(<span class="literal">null</span>)     <span class="comment">// true</span></span><br><span class="line">StringUtils.isBlank(<span class="string">&quot;&quot;</span>)       <span class="comment">// true</span></span><br><span class="line">StringUtils.isBlank(<span class="string">&quot; &quot;</span>)      <span class="comment">// true</span></span><br><span class="line">StringUtils.isBlank(<span class="string">&quot;blank&quot;</span>)     <span class="comment">// false</span></span><br><span class="line">StringUtils.isBlank(<span class="string">&quot;  blank  &quot;</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h4 id="StringUtils-isNotBlank"><a href="#StringUtils-isNotBlank" class="headerlink" title="StringUtils.isNotBlank()"></a><code>StringUtils.isNotBlank()</code></h4><ul><li>null [x]</li><li>空字串 [x]</li><li>空格 [x]</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.isNotBlank(<span class="literal">null</span>);       <span class="comment">// false</span></span><br><span class="line">StringUtils.isNotBlank(<span class="string">&quot;&quot;</span>);         <span class="comment">// false</span></span><br><span class="line">StringUtils.isNotBlank(<span class="string">&quot; &quot;</span>);        <span class="comment">// false</span></span><br><span class="line">StringUtils.isNotBlank(<span class="string">&quot;not blank&quot;</span>); <span class="comment">// true</span></span><br><span class="line">StringUtils.isNotBlank(<span class="string">&quot;  hello  &quot;</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><h4 id="StringUtils-isEmpty"><a href="#StringUtils-isEmpty" class="headerlink" title="StringUtils.isEmpty()"></a><code>StringUtils.isEmpty()</code></h4><p>有 length 就不是 empty</p><ul><li>null [o]</li><li>空字串 [o]</li><li>空格 [x] 有 length</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">StringUtils.isEmpty(<span class="literal">null</span>)      <span class="comment">// true</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">&quot;&quot;</span>)        <span class="comment">// true</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">&quot; &quot;</span>)       <span class="comment">// false</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">&quot;Empty&quot;</span>)     <span class="comment">// false</span></span><br><span class="line">StringUtils.isEmpty(<span class="string">&quot;  Empty  &quot;</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure><h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><blockquote><p>兩者判斷方式相同，但一些資料的流動難免會有可能讀寫上產生 null 所以 StringUtils 可以藉此不會因為 NullPointerException ，比較建議作為資料驗證判斷使用。</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Java 基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring restTemplate 使用方法</title>
      <link href="/2023/05/10/SpringBoot/Spring-restTemplate-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/"/>
      <url>/2023/05/10/SpringBoot/Spring-restTemplate-%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-restTemplate-使用方法"><a href="#Spring-restTemplate-使用方法" class="headerlink" title="Spring restTemplate 使用方法"></a>Spring restTemplate 使用方法</h1><div class="note simple"><p>一般來說很多請求的處理多半是透過前端進行，但也免不了有時候後端需要直接發送請求來處理，像是後端需要去特定 api 拿取資源又或是和其他 server 之間的溝通部分很常需要自己發送請求，Spring Boot 也有提供 RestTemplate 這個物件來輕鬆實踐，早期多半使用 Java 原生的 HttpConnectionUrl 來處理，那這次就介紹一下現在比較常用到的幾個常見  RestTemplate 方法。</p></div><p>這邊提供一個開放的 api 可以進行測試 (<a href="https://jsonplaceholder.typicode.com/">https://jsonplaceholder.typicode.com</a>)，裡面有詳細介紹有哪些路徑可以使用，可以直接用 postman 對特定位置來請求看看。下面介紹就會針對這個 api 進行請求。</p><h2 id="getForObject-x2F-postForObject"><a href="#getForObject-x2F-postForObject" class="headerlink" title="getForObject()&#x2F;postForObject()"></a><strong>getForObject()&#x2F;postForObject()</strong></h2><p>只想取得回覆的 body，對於其他 header 等資訊不在意，所以 response 裡面只會單純回應對方要回傳的 body</p><p>寫一個 Class 來發送請求至 <a href="https://jsonplaceholder.typicode.com/posts/1%EF%BC%8C%E5%8F%96%E5%BE%97%E7%AC%AC%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%85%A7%E5%AE%B9">https://jsonplaceholder.typicode.com/posts/1，取得第一篇文章內容</a></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateDemo</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">urlForGet</span> <span class="operator">=</span> <span class="string">&quot;https://jsonplaceholder.typicode.com/posts/1&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">UrlForPost</span> <span class="operator">=</span> <span class="string">&quot;https://jsonplaceholder.typicode.com/posts&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        getForObject();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * getForObject</span></span><br><span class="line"><span class="comment">     * GET</span></span><br><span class="line"><span class="comment">     * response 只有回傳 api 回應內容，不帶有 header, response code...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getForObject</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--- do getForObject ---&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> restTemplate.getForObject(urlForGet, String.class);</span><br><span class="line">        System.out.println(response);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">postForObject</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--- do postForObject ---&quot;</span>);</span><br><span class="line">        HashMap&lt;String, String&gt; mapPost = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        mapPost.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;新的文章標題&quot;</span>);</span><br><span class="line">        mapPost.put(<span class="string">&quot;body&quot;</span>, <span class="string">&quot;大家好，我是Sean!!&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> restTemplate.postForObject(UrlForPost, mapPost, String.class);</span><br><span class="line">        System.out.println(response);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>執行這個方法可以在 terminal 看到回應<br><img src="https://ithelp.ithome.com.tw/upload/images/20240923/20150977ntQvAh9xoW.png" alt="https://ithelp.ithome.com.tw/upload/images/20240923/20150977ntQvAh9xoW.png"></p><p><img src="https://ithelp.ithome.com.tw/upload/images/20240923/20150977kdaUZU8qON.png" alt="https://ithelp.ithome.com.tw/upload/images/20240923/20150977kdaUZU8qON.png"></p><h2 id="getForEntity-x2F-postForEntity"><a href="#getForEntity-x2F-postForEntity" class="headerlink" title="getForEntity()&#x2F;postForEntity()"></a><strong>getForEntity()&#x2F;postForEntity()</strong></h2><p>同時需要其他資訊如 header, response code 等等，其返回值是 ResponseEntity 物件，ResponseEntity 是 Spring 對 HTTP 請求的回覆封裝，getForObject 請求內部物件方法，getForEntity 都可以使用。</p><p>使用<code>ResponseEntity&lt;T&gt; responseEntity</code>來接收回覆結果。在配合用特定方法取得封裝物件內容:</p><ul><li>getBody()</li><li>getHeaders()</li><li>getStatusCode()</li></ul><p>寫一個方法來發送請求</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * getForEntity</span></span><br><span class="line"><span class="comment">  * GET</span></span><br><span class="line"><span class="comment">  * response 組成 ResponseEntity ，內含 body, header, response code...</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> ResponseEntity&lt;String&gt; <span class="title function_">getForEntity</span><span class="params">()</span>&#123;</span><br><span class="line">     ResponseEntity&lt;String&gt; response = restTemplate.getForEntity(urlForGet, String.class);</span><br><span class="line">     System.out.println(response);</span><br><span class="line">     <span class="keyword">return</span> response;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">  * postForEntity</span></span><br><span class="line"><span class="comment">  * POST</span></span><br><span class="line"><span class="comment">  * 設定 header, body 等至 HttpEntity ， 回傳 response 為 ResponseEntity，內含 body, header, response code...</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">static</span> ResponseEntity&lt;String&gt; <span class="title function_">postForEntity</span><span class="params">()</span>&#123;</span><br><span class="line">     System.out.println(<span class="string">&quot;--- do postForEntity ---&quot;</span>);</span><br><span class="line">     HashMap&lt;String, String&gt; mapPost = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">     mapPost.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;新的文章標題&quot;</span>);</span><br><span class="line">     mapPost.put(<span class="string">&quot;body&quot;</span>, <span class="string">&quot;大家好，我是Sean!!&quot;</span>);</span><br><span class="line">     ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(UrlForPost, mapPost, String.class);</span><br><span class="line">     System.out.println(response);</span><br><span class="line">     <span class="keyword">return</span> response;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><p>main 下加入這方法且執行後可以看到回應不只有原本<br><img src="https://ithelp.ithome.com.tw/upload/images/20240923/20150977AHjTcG84wq.png" alt="https://ithelp.ithome.com.tw/upload/images/20240923/20150977AHjTcG84wq.png"></p><p><img src="https://ithelp.ithome.com.tw/upload/images/20240923/20150977W9G5wQ2fAH.png" alt="https://ithelp.ithome.com.tw/upload/images/20240923/20150977W9G5wQ2fAH.png"></p><h2 id="exchange"><a href="#exchange" class="headerlink" title="exchange"></a><strong>exchange</strong></h2><p>更完整可以配置請求的相關內容，可以配置 header, HTTP method, Url 等等在送出請求之前，並且加入請求內容或是參數，最後和 get&#x2F;postForEntity 一樣得到回應為封裝的 ResponseEntity。所以可以從中獲取你需要的各種資訊。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * exchange</span></span><br><span class="line"><span class="comment"> * (GET) 適用任何 http method。</span></span><br><span class="line"><span class="comment"> * 設定 header, body 等至 HttpEntity ， 回傳 response 為 ResponseEntity，內含 body, header, response code...</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">exchangeWithGet</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="comment">// 設定 header</span></span><br><span class="line">    <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">    headers.setContentType(MediaType.APPLICATION_JSON);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 建立 HttpEntity 物件，包含請求頭及請求內容（可以省略）</span></span><br><span class="line">    HttpEntity&lt;String&gt; request = <span class="keyword">new</span> <span class="title class_">HttpEntity</span>&lt;&gt;(<span class="string">&quot;&quot;</span>, headers);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 執行 GET 請求，並取得回應資料</span></span><br><span class="line">    ResponseEntity&lt;String&gt; response = restTemplate.exchange(urlForGet, HttpMethod.GET, request, String.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 讀取回應內容</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">responseBody</span> <span class="operator">=</span> response.getBody();</span><br><span class="line">    System.out.println(responseBody);</span><br><span class="line">    <span class="keyword">return</span> responseBody;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * exchange</span></span><br><span class="line"><span class="comment"> * (POST) 適用任何 http method。</span></span><br><span class="line"><span class="comment"> * 設定 header, body 等至 HttpEntity ， 回傳 response 為 ResponseEntity，內含 body, header, response code...</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ResponseEntity&lt;String&gt; <span class="title function_">exchangeWithPost</span><span class="params">()</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;--- do exchangeWithPost ---&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 設定 header</span></span><br><span class="line">    <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line"></span><br><span class="line">    headers.setContentType(MediaType.APPLICATION_JSON);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 建立 HttpEntity 物件，包含請求頭及請求內容（可以省略）</span></span><br><span class="line">    <span class="type">Post</span> <span class="variable">post</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Post</span>(<span class="string">&quot;新的文章標題&quot;</span>, <span class="string">&quot;大家好，我是Sean!!&quot;</span>);</span><br><span class="line">    HttpEntity&lt;Post&gt; request = <span class="keyword">new</span> <span class="title class_">HttpEntity</span>&lt;&gt;(post, headers);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 執行 GET 請求，並取得回應資料</span></span><br><span class="line">    ResponseEntity&lt;String&gt; response = restTemplate.exchange(UrlForPost, HttpMethod.POST, request, String.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 讀取回應內容</span></span><br><span class="line">    System.out.println(response);</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>回應部分就先省略，因為就如同上面的 getForEntity 和 postForEntity 範例一樣，</p><h2 id="put"><a href="#put" class="headerlink" title="put()"></a>put()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * put</span></span><br><span class="line"><span class="comment"> * PUT</span></span><br><span class="line"><span class="comment"> * 沒有回傳值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://jsonplaceholder.typicode.com/posts/2&quot;</span>;</span><br><span class="line">    <span class="type">Post</span> <span class="variable">post</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Post</span>(<span class="string">&quot;修改文章標題&quot;</span>, <span class="string">&quot;修改文章內容&quot;</span>);</span><br><span class="line">    restTemplate.put(url, post);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>沒有回傳</p><h2 id="delete"><a href="#delete" class="headerlink" title="delete()"></a>delete()</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * delete</span></span><br><span class="line"><span class="comment"> * DELETE</span></span><br><span class="line"><span class="comment"> * 沒有回傳值</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span>&#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://jsonplaceholder.typicode.com/posts/3&quot;</span>;</span><br><span class="line">    restTemplate.delete(url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>沒有回傳</p><h2 id="完整範例"><a href="#完整範例" class="headerlink" title="完整範例"></a>完整範例</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.oseanchen.demotest.restTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.http.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.client.RestTemplate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RestTemplateDemo</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">RestTemplate</span> <span class="variable">restTemplate</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RestTemplate</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">urlForGet</span> <span class="operator">=</span> <span class="string">&quot;https://jsonplaceholder.typicode.com/posts/1&quot;</span>;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">String</span> <span class="variable">UrlForPost</span> <span class="operator">=</span> <span class="string">&quot;https://jsonplaceholder.typicode.com/posts&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"><span class="comment">//        getForObject();</span></span><br><span class="line"><span class="comment">//        getForEntity();</span></span><br><span class="line"><span class="comment">//        postForObject();</span></span><br><span class="line">        postForEntity();</span><br><span class="line"><span class="comment">//        exchangeWithGet();</span></span><br><span class="line"><span class="comment">//        exchangeWithPost();</span></span><br><span class="line"><span class="comment">//        put();</span></span><br><span class="line"><span class="comment">//        delete();</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * getForObject</span></span><br><span class="line"><span class="comment">     * GET</span></span><br><span class="line"><span class="comment">     * response 只有回傳 api 回應內容，不帶有 header, response code...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getForObject</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--- do getForObject ---&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> restTemplate.getForObject(urlForGet, String.class);</span><br><span class="line">        System.out.println(response);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">postForObject</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--- do postForObject ---&quot;</span>);</span><br><span class="line">        HashMap&lt;String, String&gt; mapPost = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        mapPost.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;新的文章標題&quot;</span>);</span><br><span class="line">        mapPost.put(<span class="string">&quot;body&quot;</span>, <span class="string">&quot;大家好，我是Sean!!&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">response</span> <span class="operator">=</span> restTemplate.postForObject(UrlForPost, mapPost, String.class);</span><br><span class="line">        System.out.println(response);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * getForEntity</span></span><br><span class="line"><span class="comment">     * GET</span></span><br><span class="line"><span class="comment">     * response 組成 ResponseEntity ，內含 body, header, response code...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseEntity&lt;String&gt; <span class="title function_">getForEntity</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--- do getForEntity ---&quot;</span>);</span><br><span class="line">        ResponseEntity&lt;String&gt; response = restTemplate.getForEntity(urlForGet, String.class);</span><br><span class="line">        System.out.println(response);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * postForEntity</span></span><br><span class="line"><span class="comment">     * POST</span></span><br><span class="line"><span class="comment">     * 設定 header, body 等至 HttpEntity ， 回傳 response 為 ResponseEntity，內含 body, header, response code...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseEntity&lt;String&gt; <span class="title function_">postForEntity</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--- do postForEntity ---&quot;</span>);</span><br><span class="line">        HashMap&lt;String, String&gt; mapPost = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        mapPost.put(<span class="string">&quot;title&quot;</span>, <span class="string">&quot;新的文章標題&quot;</span>);</span><br><span class="line">        mapPost.put(<span class="string">&quot;body&quot;</span>, <span class="string">&quot;大家好，我是Sean!!&quot;</span>);</span><br><span class="line">        ResponseEntity&lt;String&gt; response = restTemplate.postForEntity(UrlForPost, mapPost, String.class);</span><br><span class="line">        System.out.println(response);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * exchange</span></span><br><span class="line"><span class="comment">     * (GET) 適用任何 http method。</span></span><br><span class="line"><span class="comment">     * 設定 header, body 等至 HttpEntity ， 回傳 response 為 ResponseEntity，內含 body, header, response code...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">exchangeWithGet</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 設定 header</span></span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line">        headers.setContentType(MediaType.APPLICATION_JSON);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 建立 HttpEntity 物件，包含請求頭及請求內容（可以省略）</span></span><br><span class="line">        HttpEntity&lt;String&gt; request = <span class="keyword">new</span> <span class="title class_">HttpEntity</span>&lt;&gt;(<span class="string">&quot;&quot;</span>, headers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 執行 GET 請求，並取得回應資料</span></span><br><span class="line">        ResponseEntity&lt;String&gt; response = restTemplate.exchange(urlForGet, HttpMethod.GET, request, String.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 讀取回應內容</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">responseBody</span> <span class="operator">=</span> response.getBody();</span><br><span class="line">        System.out.println(responseBody);</span><br><span class="line">        <span class="keyword">return</span> responseBody;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * exchange</span></span><br><span class="line"><span class="comment">     * (POST) 適用任何 http method。</span></span><br><span class="line"><span class="comment">     * 設定 header, body 等至 HttpEntity ， 回傳 response 為 ResponseEntity，內含 body, header, response code...</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ResponseEntity&lt;String&gt; <span class="title function_">exchangeWithPost</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;--- do exchangeWithPost ---&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 設定 header</span></span><br><span class="line">        <span class="type">HttpHeaders</span> <span class="variable">headers</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HttpHeaders</span>();</span><br><span class="line"></span><br><span class="line">        headers.setContentType(MediaType.APPLICATION_JSON);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 建立 HttpEntity 物件，包含請求頭及請求內容（可以省略）</span></span><br><span class="line">        <span class="type">Post</span> <span class="variable">post</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Post</span>(<span class="string">&quot;新的文章標題&quot;</span>, <span class="string">&quot;大家好，我是Sean!!&quot;</span>);</span><br><span class="line">        HttpEntity&lt;Post&gt; request = <span class="keyword">new</span> <span class="title class_">HttpEntity</span>&lt;&gt;(post, headers);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 執行 GET 請求，並取得回應資料</span></span><br><span class="line">        ResponseEntity&lt;String&gt; response = restTemplate.exchange(UrlForPost, HttpMethod.POST, request, String.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 讀取回應內容</span></span><br><span class="line">        System.out.println(response);</span><br><span class="line">        <span class="keyword">return</span> response;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * put</span></span><br><span class="line"><span class="comment">     * PUT</span></span><br><span class="line"><span class="comment">     * 沒有回傳值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://jsonplaceholder.typicode.com/posts/2&quot;</span>;</span><br><span class="line">        <span class="type">Post</span> <span class="variable">post</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Post</span>(<span class="string">&quot;修改文章標題&quot;</span>, <span class="string">&quot;修改文章內容&quot;</span>);</span><br><span class="line">        restTemplate.put(url, post);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * delete</span></span><br><span class="line"><span class="comment">     * DELETE</span></span><br><span class="line"><span class="comment">     * 沒有回傳值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;https://jsonplaceholder.typicode.com/posts/3&quot;</span>;</span><br><span class="line">        restTemplate.delete(url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h2><p>上述各類型的用法其實都很雷同，主要先看是否需要有進一步關於回應的各種資訊。</p><ul><li>如果不需要就可以考慮使用 get&#x2F;postForObject 純粹獲取回應 body 就好。</li><li>如果需要那些完整回應的資訊就可以考慮用 get&#x2F;postForEntity 或 Exchange 來進行請求，這樣就可以從中獲取像是 status code, header 等的資訊。</li><li>如果要細部指定 header 或是各類型的方法可以使用 exchange 來進行請求可以根據需求調整，詳細可以參考下表。</li><li>delete, put, patch 等如果不需要回應可以直接使用。</li></ul><table><thead><tr><th></th><th>return type</th><th>set header</th><th>getStatusCode()</th><th>getHeaders()</th><th>getBody()</th></tr></thead><tbody><tr><td>getForObject&#x2F;postForObject</td><td>String (response body)</td><td>x</td><td>x</td><td>x</td><td>x</td></tr><tr><td>getForEntity&#x2F;postForEntity</td><td>ResponseEntity<T></td><td>x</td><td>o</td><td>o</td><td>o</td></tr><tr><td>exchange</td><td>ResponseEntity<T></td><td>o</td><td>o</td><td>o</td><td>o</td></tr><tr><td>put&#x2F;delete</td><td>void</td><td>x</td><td>x</td><td>x</td><td>x</td></tr></tbody></table><hr><p>Ref:</p><ul><li><a href="https://liuyueyi.github.io/hexblog/2018/08/13/180813-Spring%E4%B9%8BRestTemplate%E4%BD%BF%E7%94%A8%E5%B0%8F%E7%BB%93%E4%B8%80/">Spring 之  <strong>Rest</strong>Template 使用小结</a></li><li><a href="https://blog.csdn.net/YCJ_xiyang/article/details/90481832"><strong>rest</strong>Template 常用方法介绍</a></li><li><a href="https://zendei.com/article/96878.html">—上手就會  <strong>Rest</strong>Template 使用指南</a></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> http request </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA main()</title>
      <link href="/2023/05/03/Java/JAVA-main/"/>
      <url>/2023/05/03/Java/JAVA-main/</url>
      
        <content type="html"><![CDATA[<h1 id="Java-main"><a href="#Java-main" class="headerlink" title="Java main()"></a>Java main()</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">HelloWorld</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;Hello World!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>一個類別只有一個 main 方法並且是整個程式的執行進入點（Entry point）。</li><li>封裝等級必須宣告為 public，且只有主類別可以宣告為 public。（預設為 public，所以 public 可省略）</li><li>主類別名稱必須與主檔名相同（不含副檔名）。</li><li>修飾字的宣告只能宣告為 abstract、final 或省略不寫。</li><li>public static void 是固定不可以改變的</li></ul><h2 id="名詞解釋"><a href="#名詞解釋" class="headerlink" title="名詞解釋"></a>名詞解釋</h2><h4 id="public"><a href="#public" class="headerlink" title="public"></a>public</h4><p>表示方法是公開，可以在這個 class 以外的地方使用</p><h4 id="static"><a href="#static" class="headerlink" title="static"></a>static</h4><p>表示靜態，是描述這個方法的狀態，程式剛開始執行前，就要把這些東西載入到記憶體，main() 方法不需要產生物件（Object）就能被執行，所以它必須是個 “static” 成員</p><h4 id="void"><a href="#void" class="headerlink" title="void"></a>void</h4><p>表示這個方法沒有回傳值，一但 main()方法終止，java 程序也將終止。因此，從 main()方法返回沒有任何意義。</p><h4 id="main-String-args"><a href="#main-String-args" class="headerlink" title="main (String[] args)"></a>main (String[] args)</h4><p>為 java jvm 找尋程式執行的進入點辨識的方法，參數可以接受字串陣列當做參數，這是 JVM 定義好的，String[] 表示字串陣列，args 是為這些字串陣列取的變數名稱，當然也可以寫 main（String[] abc）。<br>args：arguments</p><hr><p><strong>參考資料:</strong></p><ol><li><a href="https://www.geeksforgeeks.org/java-main-method-public-static-void-main-string-args/">https://www.geeksforgeeks.org/java-main-method-public-static-void-main-string-args/</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Java 基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JAVA Static</title>
      <link href="/2023/04/29/Java/JAVA-Static/"/>
      <url>/2023/04/29/Java/JAVA-Static/</url>
      
        <content type="html"><![CDATA[<h1 id="JAVA-Static"><a href="#JAVA-Static" class="headerlink" title="JAVA Static"></a>JAVA Static</h1><h2 id="static-靜態"><a href="#static-靜態" class="headerlink" title="static 靜態"></a>static 靜態</h2><h4 id="作用對象"><a href="#作用對象" class="headerlink" title="作用對象"></a>作用對象</h4><p>可用來修飾 (類別的屬性、方法或子類別)，不能用 static 修飾最上層 Class</p><h4 id="定義"><a href="#定義" class="headerlink" title="定義"></a>定義</h4><p>靜態的意思是，在程式載入記憶體的時候，跟著程式一起在記憶體中佔有空間，而不是主程式開始執行後才跟記憶體要空間。</p><p>static 可以想像成<code>程式執行時已經載入到記憶體中</code>，有點類似於全域的概念，Java 中沒有全域性變數的概念。但可以透過 static 實現此目的，可以將變數宣告為靜態並將其用作全域性變數。</p><h4 id="範例-1"><a href="#範例-1" class="headerlink" title="範例 1"></a>範例 1</h4><p>如果物件內定義 static 屬性，就可以使用類名稱訪問靜態變數，不需要建立一個物件來呼叫靜態變數。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">static</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticTesting</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Student.id = <span class="number">1</span>;</span><br><span class="line">        Student.name = <span class="string">&quot;Sean&quot;</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">StudentId</span> <span class="operator">=</span> Student.id;</span><br><span class="line">        <span class="type">String</span> <span class="variable">StudentName</span> <span class="operator">=</span> Student.name;</span><br><span class="line">        System.out.println(<span class="string">&quot;Id: &quot;</span>+StudentId);</span><br><span class="line">        System.out.println(<span class="string">&quot;Name: &quot;</span>+StudentName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Id: 1</span><br><span class="line">Name: Sean</span><br></pre></td></tr></table></figure><h4 id="範例-2"><a href="#範例-2" class="headerlink" title="範例 2"></a>範例 2</h4><p>static 也可以同時用在類別方法中，可以讓有被注入這個類別的程式內都可以使用，類似於使得類別內的變數擁有全域的特性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalVarTest</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> String Global;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">setGlobal</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        Global = s;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getGlobal</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Global;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">pubic <span class="keyword">class</span> <span class="title class_">TestGlobal1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">print</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">a</span> <span class="operator">=</span> <span class="string">&quot;hi&quot;</span>;</span><br><span class="line">        Global.setGlobal(a)</span><br><span class="line">        System.out.println(<span class="string">&quot;TestGlobal1 set Global: &quot;</span> + GlobalVarTest.getGlobal());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pubic <span class="keyword">class</span> <span class="title class_">TestGlobal2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">print</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">b</span> <span class="operator">=</span> <span class="string">&quot;123&quot;</span>;</span><br><span class="line">        Global.setGlobal(b)</span><br><span class="line">        System.out.println(<span class="string">&quot;TestGlobal2 set Global: &quot;</span> + GlobalVarTest.getGlobal());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Output:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TestGlobal1 set Global: hi</span><br><span class="line">TestGlobal2 set Global: 123</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Java 基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RabbitMQ 介紹</title>
      <link href="/2023/04/21/Message_Queue/RabbitMQ-%E4%BB%8B%E7%B4%B9/"/>
      <url>/2023/04/21/Message_Queue/RabbitMQ-%E4%BB%8B%E7%B4%B9/</url>
      
        <content type="html"><![CDATA[<h2 id="軟體簡介"><a href="#軟體簡介" class="headerlink" title="軟體簡介"></a>軟體簡介</h2><ul><li>著名應用 message Queue (message brokers) 的開源軟體</li><li>支持 AMQP 0-9-1 等多種訊息傳遞協定</li><li>支援多種語言及插件工具</li><li>圖形化介面管理及監控訊息狀態</li><li>其他類似軟體 EX: Kafka、AWS SQS…</li></ul><h2 id="AMQP-基本架構及名詞解釋"><a href="#AMQP-基本架構及名詞解釋" class="headerlink" title="AMQP 基本架構及名詞解釋"></a>AMQP 基本架構及名詞解釋</h2><p><img src="https://i.imgur.com/vJlh8T5.png"><br>AMQP 0-9-1: AMQP (Advanced Message Queuing Protocol)是一種訊息傳遞的協定，具有各個角色實踐訊息傳遞的中間代理。</p><p>由 Producer 發佈訊息到 exchange，可以想像成郵局或郵箱。然後依照綁定的規則將訊息發到 Queue（Broker） 。然後 consumer 依照期間監聽（訂閱）的 Queue 將其中訊息取出。</p><ul><li><code>Producer</code> ： 發送訊息的程式</li><li><code>Queue</code>：儲存訊息等待接收的緩衝區域，具有 FIFO 特性（先進先出）</li><li><code>Consumer</code>：訊息接收的程式</li><li><code>Exchange</code>：決定將訊息推送至指定位置<ul><li>Direct：直接丟給指定的 Queue</li><li>Topic：設定 binding 規則，丟給符合的 Queue</li><li>Fanout：一次丟給全部負責的 Queue</li></ul></li></ul><h2 id="5-種-RabbitMQ-設計模式"><a href="#5-種-RabbitMQ-設計模式" class="headerlink" title="5 種 RabbitMQ 設計模式"></a>5 種 RabbitMQ 設計模式</h2><h3 id="1-Simple"><a href="#1-Simple" class="headerlink" title="1. Simple"></a>1. Simple</h3><p>最基本的模式，只有一個 Producer 負責送 message 給 Queue、只有一個 Consumer 去 Ｑ ueue 裡將 message 接收</p><p><img src="https://i.imgur.com/kphjY7p.png"></p><h3 id="2-Worker"><a href="#2-Worker" class="headerlink" title="2. Worker"></a>2. Worker</h3><p>這模式像是多個工人會共同去完成工作</p><p>同時有多個 Consumer 會去收 Queue 裡的 message，可以增加 message 消化的速率。常用的一種模式，通常是用在大量非同步的作業上，只要連接同一個 Queue，就可以在多台機器上 Consumer 平行處理。</p><p><img src="https://i.imgur.com/IsOedmp.png"></p><h3 id="3-Publish-x2F-Subscibe"><a href="#3-Publish-x2F-Subscibe" class="headerlink" title="3. Publish&#x2F;Subscibe"></a>3. Publish&#x2F;Subscibe</h3><p>可以想像成訂閱頻道或是服務一樣，有新的發表或是訊息就會廣播給訂閱者。</p><p>所以需在 Producer、Queue、Consumer 之間多一個 Exchange，Producer 會先把 message 丟給 Exchange （Type &#x3D; Fanout），Fanout 模式的 Exchange 去決定要把這個 message 丟給綁定（訂閱）的 Queue 上</p><p><img src="https://i.imgur.com/kWcOt87.png"></p><h3 id="4-Routing"><a href="#4-Routing" class="headerlink" title="4. Routing"></a>4. Routing</h3><p>想成貼上標籤（Routing key）並依照標籤指定類型來傳送</p><p>當 Producer 把 message 丟給 Exchange（Type &#x3D; Direct） 時，同時要在這個 message 上面帶上一個 routing key，而 Exchange 就會根據這個 routing key，將 message 丟到指定的 Queue 上</p><p>就像下圖的例子，Q1 只會收到關於 orange 相關 routing key 的 message、Q2 則是 black 及 green 的 message</p><p><img src="https://i.imgur.com/lPALPn7.png"></p><h3 id="5-Topics"><a href="#5-Topics" class="headerlink" title="5. Topics"></a>5. Topics</h3><p>也是標上特定標籤，可以想成能區分更仔細的多重標籤。</p><p>類似 Routing 模式，同樣有 Exchange (Type &#x3D; Topic)，也透過 routing key 來分流訊息，差別在 topic 的特性能夠模糊綁定非固定的 routing key。 設定模糊 routing key 的格式需以 .(dot) 分隔的字串，*(star) 只能代替一個單詞、#(bash) 可以代替零個或多個單詞。</p><p>根據下圖的狀況，訊息將使用由三個標籤組成的 routing key 發送，第一個標籤是 “速度”，第二個標籤是 “顏色”，第三個標籤是 “動物”：&lt;速度&gt;.&lt;顏色&gt;.&lt;動物&gt;。</p><p>Q1 以 .orange. 綁定，與 Q2 以 <em>.</em>.rabbit 和 lazy.# 綁定，也就是：</p><ul><li>Q1 會收到所有關於 “橘色動物” 的訊息</li><li>Q2 會收到所有關於 “兔子” 的訊息，以及所有關於 “任何顏色且懶惰動物” 的訊息</li></ul><p><img src="https://i.imgur.com/VkBc4i4.png"></p><hr><p>參考資料:</p><ol><li><a href="https://www.rabbitmq.com/tutorials/amqp-concepts.html">AMQP 0-9-1 Model Explained</a></li><li><a href="https://enzochang.com/rabbitmq-introduction/">RabbitMQ 簡介與 5 種設計模式</a></li><li><a href="https://kucw.github.io/blog/2020/11/rabbitmq/">RabbitMQ 基本介紹、安裝教學</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> RabbitMQ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RabbitMQ </tag>
            
            <tag> Message Queue </tag>
            
            <tag> Asynchronous </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring MVC Http method 取得請求參數方法</title>
      <link href="/2023/03/25/SpringBoot/Spring-MVC-Http-method-%E5%8F%96%E5%BE%97%E8%AB%8B%E6%B1%82%E5%8F%83%E6%95%B8%E6%96%B9%E6%B3%95/"/>
      <url>/2023/03/25/SpringBoot/Spring-MVC-Http-method-%E5%8F%96%E5%BE%97%E8%AB%8B%E6%B1%82%E5%8F%83%E6%95%B8%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>Spring Boot 常使用取得請求的方式：</p><ul><li>@RequestParam</li><li>@RequestBody</li><li>@RequestHeader</li><li>@PathVariable</li></ul></div><h2 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a>@RequestParam</h2><p>用法：</p><ul><li>GET</li><li>required &#x3D; true&#x2F;false (預設 true)，如果是 false 就不用代入但可能會因此有 null 報 exception</li><li>defaultValue &#x3D; xxx，設置預設值，設置後 required 就會被忽略</li></ul><p>用途：取得放在 URL 的參數</p><p><code>http:localhost:8080/test1?id=123</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestController</span> &#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/test1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test1</span><span class="params">(<span class="meta">@RequestParam</span> Integer id,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(defaultValue = &quot;Sean&quot;)</span> String name,</span></span><br><span class="line"><span class="params">                        <span class="meta">@RequestParam(value = &quot;nickname&quot;, required = false)</span> String nickname</span></span><br><span class="line"><span class="params">    )</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;id:&quot;</span> + id);</span><br><span class="line">        System.out.println(<span class="string">&quot;name:&quot;</span> + name);</span><br><span class="line">        System.out.println(<span class="string">&quot;name:&quot;</span> + nickname);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;your request id is &quot;</span> + id + <span class="string">&quot; and name is &quot;</span> + name + <span class="string">&quot;, or you can called me &quot;</span> + nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>發送 request，帶入 id &#x3D;1, name &#x3D; Sean，故意不帶入第 3 個參數 nickname，可以看到最後會回傳 null 但也不會出錯誤，但如果把 required &#x3D; true 就會出現 400 Bad Request 錯誤。<br><img src="https://i.imgur.com/nEWhpMX.png"></p><p>console 上面顯示<br><img src="https://i.imgur.com/U0AvxlZ.png"></p><h2 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a>@RequestBody</h2><p>用法：</p><ul><li>POST, PUT</li><li>required &#x3D; true&#x2F;false (預設 true)</li><li>需要先定義對應參數的 java class</li><li>RequestBody 裡面多傳參數也不會報錯，有定義的才會被使用，少傳就會有 null</li></ul><p>用途：取得 Request body 裡面的參數（將 Json 轉為自定義 Java Object）</p><p><code>http:localhost:8080/test2</code></p><p>controller</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test2&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">test2</span><span class="params">(<span class="meta">@RequestBody</span> Student student)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;student id: &quot;</span> + student.getId() );</span><br><span class="line">    System.out.println(<span class="string">&quot;student name: &quot;</span> + student.getName() );</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello test2&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Student class</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    Integer id;</span><br><span class="line">    String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(Integer id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>發送 request，帶入{ “id” &#x3D;1, “name” &#x3D; “Sean” }的 JSON 物件，如果請求內所帶的物件屬性不是 Student 物件設定的，不管多或少其實都不會有問題，但如果希望參數設定可以驗證避免使用者傳錯參數的話，就必須要透過驗證註解像是<code>@Valid</code>, <code>@NotNull</code>, <code>@NotBlank</code> 等等的部分才可以做到了，這部分後續文章會有進一步說明。<br><img src="https://i.imgur.com/LB9SHzv.png"></p><p><img src="https://i.imgur.com/5otFdmB.png"></p><p>console 上面顯示<br><img src="https://i.imgur.com/avU1pAf.png"></p><h2 id="RequestHeader"><a href="#RequestHeader" class="headerlink" title="@RequestHeader"></a>@RequestHeader</h2><p>用法：</p><ul><li>GET&#x2F;POST</li><li>只能加在方法參數上</li><li>name(或用 value): 指定 request header 的 header 名字（比 requestparam 的 name 常用）</li><li>required &#x3D; true&#x2F;false 同 @RequestParam</li><li>defaultValue: 預設值 同 @RequestParam</li></ul><p>用途：取得放在 requestHeader 的參數，可以用 GET 請求中設定 header; 如果用 POST 一般都會帶入 Content-Type &#x3D; application&#x2F;json</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">test3</span><span class="params">(<span class="meta">@RequestHeader</span> String info,</span></span><br><span class="line"><span class="params">                    <span class="meta">@RequestHeader</span> (name = <span class="string">&quot;gogo&quot;</span>, required = <span class="literal">false</span>)</span> String gogo)&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;header info: &quot;</span> + info);</span><br><span class="line">    System.out.println(<span class="string">&quot;header gogo: &quot;</span> + gogo);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;hello test3&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>發送 request，header 上面帶入指定的 header 名稱，如果是參數定義的就可以抓到<br><img src="https://i.imgur.com/gqsy8e0.png"></p><p>console 上面顯示<br><img src="https://i.imgur.com/v2NLbfl.png"></p><h2 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a>@PathVariable</h2><p>用法：</p><ul><li>路徑上寫的參數要和 @PathVariable 定義的一樣用途：取得放在 URL 路徑裡面的值</li><li>required &#x3D; true&#x2F;false (預設 true)，如果是 false 就不用代入但可能會因此有 null 報 exception</li></ul><p><code>http://localhost:8080/test4/123/Sean</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/test4/&#123;id&#125;/&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">test4</span><span class="params">(<span class="meta">@PathVariable</span> Integer id,</span></span><br><span class="line"><span class="params">                        <span class="meta">@PathVariable</span> String name</span></span><br><span class="line"><span class="params">    )</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;path id: &quot;</span> + id);</span><br><span class="line">        System.out.println(<span class="string">&quot;path name: &quot;</span> + name);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello test4&quot;</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>發送 request，URL 上針對 {id}, {name} 部分帶入參數，後端就可以取得，注意定義的參數類型如果不匹配也會出現 400 bad request，像是如果你把 id 部分用文字帶入請求。<br><img src="https://i.imgur.com/mrKFW5z.png"></p><p>console 上面顯示<br><img src="https://i.imgur.com/5AIeMxn.png"></p><h2 id="小總結"><a href="#小總結" class="headerlink" title="小總結:"></a>小總結:</h2><p>針對一些用法上大家可以注意一下</p><table><thead><tr><th></th><th>Http method</th><th>required</th><th>defaultValue</th><th>常用情境</th></tr></thead><tbody><tr><td>@RequestParam</td><td><code>GET</code></td><td>O (預設 true)</td><td>O</td><td>查詢參數或表單數據</td></tr><tr><td>@RequestBody</td><td><code>POST</code>, <code>PUT</code></td><td>O (預設 true)</td><td>X</td><td>處理 JSON 或 XML 請求</td></tr><tr><td>@PathVariable</td><td><code>GET</code>, <code>PUT</code>, <code>DELETE</code></td><td>O (預設 true)</td><td>X</td><td>URL 路徑中的變數</td></tr><tr><td>@RequestHeader</td><td><code>GET</code>、<code>POST</code></td><td>O (預設 true)</td><td>O</td><td>獲取 HTTP 請求 header</td></tr></tbody></table><hr><p>參考資料：</p><ol><li>Java 工程師必備！Spring Boot 零基礎入門 （hahow 課程）</li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring Boot </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
            <tag> Spring Boot </tag>
            
            <tag> http request </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rails 套件操作，Devise（google 第三方登入（下）)</title>
      <link href="/2022/11/02/Rails/Rails-%E5%A5%97%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%8CDevise%EF%BC%88google-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5%EF%BC%88%E4%B8%8B%EF%BC%89/"/>
      <url>/2022/11/02/Rails/Rails-%E5%A5%97%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%8CDevise%EF%BC%88google-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5%EF%BC%88%E4%B8%8B%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>今天接著安裝完成 <code>&#39;omniauth-google-oauth2&#39;</code>、<code>&#39;omniauth-rails_csrf_protection&#39;</code>這兩個套件之後，我們接續後面的步驟吧。</p><h3 id="設定-routes"><a href="#設定-routes" class="headerlink" title="設定 routes"></a>設定 routes</h3><p>記得之前用 devise 產生的 controller 中有一個 omniauth_callbacks_controller.rb 這個檔案嗎？<br>現在可以拿來用了喔，但我們要告訴 devise 要去使用這個 controller 必須要設定好 routes</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g <span class="symbol">devise:</span>controllers users</span><br></pre></td></tr></table></figure><p>如同前面章節有提到，這些產生的 controller 必須要設定好路徑才可以使用喔。如果沒有產生的話可以自己建立 app&#x2F;controller&#x2F;users&#x2F;omniauth_callbacks_controller.rb 到這個路徑。</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devise_for <span class="symbol">:users</span>, <span class="symbol">controllers:</span> &#123; <span class="symbol">omniauth_callbacks:</span> <span class="string">&#x27;users/omniauth_callbacks&#x27;</span> &#125;</span><br></pre></td></tr></table></figure><h3 id="設定-callback-controller"><a href="#設定-callback-controller" class="headerlink" title="設定 callback controller"></a>設定 callback controller</h3><p>這邊是當 google 授權後會帶著得到那邊相關的資料來到我們的網域，就會用 callbacks controller 接下來這些資料，也就是前面填寫給 google 的 已授權的重新導向 url 位置。接下來之後我們要把這些資料拿來比對是否資料庫內已經有對應存在的帳號。</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Users::OmniauthCallbacksController</span> &lt; <span class="title class_ inherited__">Devise::OmniauthCallbacksController</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">google_oauth2</span></span><br><span class="line">      <span class="comment"># 需要在model中實作定義下面 `from_omniauth` 的方法 (app/models/user.rb)</span></span><br><span class="line">      <span class="variable">@user</span> = User.from_omniauth(request.env[<span class="string">&#x27;omniauth.auth&#x27;</span>])</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> <span class="variable">@user</span>.persisted?</span><br><span class="line">        flash[<span class="symbol">:notice</span>] = I18n.t <span class="string">&#x27;devise.omniauth_callbacks.success&#x27;</span>, <span class="symbol">kind:</span> <span class="string">&#x27;Google&#x27;</span></span><br><span class="line">        sign_in_and_redirect <span class="variable">@user</span>, <span class="symbol">event:</span> <span class="symbol">:authentication</span></span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        session[<span class="string">&#x27;devise.google_data&#x27;</span>] = request.env[<span class="string">&#x27;omniauth.auth&#x27;</span>].except(<span class="string">&#x27;extra&#x27;</span>)</span><br><span class="line">        redirect_to new_user_registration_url, <span class="symbol">alert:</span>   <span class="variable">@user</span>.errors.full_messages.join(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">      <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="設定-model"><a href="#設定-model" class="headerlink" title="設定 model"></a>設定 model</h3><p>先加入 devise 提供的 :omniauthable 的方法到 model 上面</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devise <span class="symbol">:database_authenticatable</span>, <span class="symbol">:registerable</span>,</span><br><span class="line">       <span class="symbol">:recoverable</span>, <span class="symbol">:rememberable</span>, <span class="symbol">:validatable</span>,</span><br><span class="line">       <span class="symbol">:omniauthable</span>, <span class="symbol">omniauth_providers:</span> [<span class="symbol">:google_oauth2</span>]</span><br></pre></td></tr></table></figure><p>前面在 callback controller 可以看到我們需要對 User 這個 model 定義類別方法 <code>from_omniauth</code> 在 user.rb 中，解析授權回來的資料，並且會從資料庫中比對跟授權回來的 email 資料相同的 user 來建立一個，注意註解下面的部分是處理當沒有對應的 email 或相關註冊填寫的資料時就建立給一個出來進行登入。</p><p>如果你定義 user 寫入資料庫的部分有要填入其他欄位或是只要特定的可以自己調整，預設只有 email 跟 password，像我當初專案是多加入 username，所以就改成下面這樣。</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">self</span>.from_omniauth(access_token)</span><br><span class="line">    data = access_token.info</span><br><span class="line">    user = User.where(<span class="symbol">email:</span> data[<span class="string">&#x27;email&#x27;</span>]).first</span><br><span class="line">    <span class="comment"># 下面處理是當資料庫內部沒有對應的帳號密碼時，建立給我們專案資料庫去對應每次授權的 token。</span></span><br><span class="line">    user |<span class="params"></span>|= User.create(</span><br><span class="line">      (<span class="symbol">username:</span> data[<span class="string">&#x27;username&#x27;</span>] |<span class="params"></span>| data[<span class="string">&#x27;email&#x27;</span>].split(<span class="string">&#x27;@&#x27;</span>).first,</span><br><span class="line">       <span class="symbol">email:</span> data[<span class="string">&#x27;email&#x27;</span>],</span><br><span class="line">       <span class="symbol">password:</span> Devise.friendly_token[<span class="number">0</span>,<span class="number">20</span>]</span><br><span class="line">         )</span><br><span class="line">    user</span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="最後可以回去看到-view-的部分"><a href="#最後可以回去看到-view-的部分" class="headerlink" title="最後可以回去看到 view 的部分"></a>最後可以回去看到 view 的部分</h3><p>如果你有用他產生預設的 view 應該會直接看到相關連結自動產生在頁面上，你也可以自己找出路徑客製自己藥的東西，可以透過下面找到相關路徑</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails routes -c omniauth</span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/OBARANG.png"></p><p>填入對應的 link_to 位置應該就可以看到。就可以測試看看是否可以正常使用。</p><p>－－－<br>參考資料：</p><ol><li><a href="https://www.youtube.com/watch?v=XuXC8BvJM4Y&ab_channel=SupeRailsbyYaroslavShmarov">YarpslavShmarov 教學影片</a></li><li><a href="https://github.com/zquestz/omniauth-google-oauth2">omniauth-google-oauth2</a></li><li><a href="https://medium.com/tingyiiii/rails%E5%AF%A6%E4%BD%9C%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5-google-2a0851b74193">Rails 實作第三方登入-Google</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails套件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
            <tag> Rails </tag>
            
            <tag> Devise </tag>
            
            <tag> 套件 </tag>
            
            <tag> 會員系統 </tag>
            
            <tag> google </tag>
            
            <tag> github </tag>
            
            <tag> Omniauth </tag>
            
            <tag> Oauth </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rails 套件操作，Devise（google 第三方登入（上）)</title>
      <link href="/2022/10/31/Rails/Rails-%E5%A5%97%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%8CDevise%EF%BC%88google-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5%EF%BC%88%E4%B8%8A%EF%BC%89/"/>
      <url>/2022/10/31/Rails/Rails-%E5%A5%97%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%8CDevise%EF%BC%88google-%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5%EF%BC%88%E4%B8%8A%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<p>相信很多人主要是希望可以透過 devise 來幫忙串接第三方登入，這部分剛好在我們製作專案的時候有順利完成 google 的部分就拿出來分享給大家。</p><h2 id="主要步驟"><a href="#主要步驟" class="headerlink" title="主要步驟"></a>主要步驟</h2><ol><li>申請 google api 金鑰</li><li>專案中 devise 設定檔設定金鑰</li><li>裝上 omniauth 套件配合串接 devise</li><li>設定 routes</li><li>設定 callback controller</li><li>設定 model</li></ol><p>這篇先針對前面三點進行說明。</p><h3 id="申請-google-oauth-金鑰"><a href="#申請-google-oauth-金鑰" class="headerlink" title="申請 google oauth 金鑰"></a>申請 google oauth 金鑰</h3><p>先到 google cloud 去申請 oauth 金鑰<br><a href="https://console.cloud.google.com/">https://console.cloud.google.com/</a></p><p>點選 oauth 用戶端 id 進入申請頁面<br><img src="https://i.imgur.com/jXKWzgx.png"></p><p>填寫的部分：</p><ul><li>應用程式類型選“網頁應用程式”</li><li>名稱就自己決定</li><li>已授權的 javascript 來源<br>先填上 localhost 的位置 (<a href="http://127.0.0.1:3000/">http://127.0.0.1:3000</a>) or (<a href="http://localhost:3000)，方便你本機可以進行測試，建議上面兩種都填寫，防止你開">http://localhost:3000)，方便你本機可以進行測試，建議上面兩種都填寫，防止你開</a> server 連到沒加入金鑰的那個位置，之後上線後記得也補上正式上線的網域。</li><li>已授權的重新導向 url<br>這邊需要填上 <code>網域/users/auth/google_oauth2/callback</code>，是當使用者從 google 授權完成後回到的地方。</li></ul><p><img src="https://i.imgur.com/aN1BVRn.png"><br>送出後會拿到金鑰 id 跟 secret<br>相關填寫可以參考下面這張圖，是申請完成後點入項目看到的畫面，紅色及藍色得匡線部分，紫色匡線內是金鑰，要拿去專案內設定使用。<br><img src="https://i.imgur.com/Cx4s1gm.png"></p><h3 id="devise-設定金鑰"><a href="#devise-設定金鑰" class="headerlink" title="devise 設定金鑰"></a>devise 設定金鑰</h3><p>devise.rb 檔案進行金鑰設定</p><p>建議配合套件 <a href="https://github.com/bkeepers/dotenv">dotenv</a>，把上面這些重要金鑰轉成環境變數存起來，並且記得 <code>.gitignore</code> 要把 <code>.env</code> 檔案加入避免上版本控制</p><p>加入下面的設定，後面 ENV[“OAUTH_GOOGLE_ID”], ENV[“OAUTH_GOOGLE_SECRET”] 是我的金鑰用戶端編號跟密碼</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.omniauth <span class="symbol">:google_oauth2</span>, <span class="variable constant_">ENV</span>[<span class="string">&quot;OAUTH_GOOGLE_ID&quot;</span>], <span class="variable constant_">ENV</span>[<span class="string">&quot;OAUTH_GOOGLE_SECRET&quot;</span>]</span><br></pre></td></tr></table></figure><h3 id="裝上-omniauth-相關套件"><a href="#裝上-omniauth-相關套件" class="headerlink" title="裝上 omniauth 相關套件"></a>裝上 omniauth 相關套件</h3><p><a href="https://github.com/zquestz/omniauth-google-oauth2">https://github.com/zquestz/omniauth-google-oauth2</a></p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gem <span class="string">&#x27;omniauth-google-oauth2&#x27;</span></span><br><span class="line">gem <span class="string">&#x27;omniauth-rails_csrf_protection&#x27;</span></span><br></pre></td></tr></table></figure><p>下一篇再繼續補上後面步驟的說明。</p><hr><p>參考資料：</p><ol><li><a href="https://www.youtube.com/watch?v=XuXC8BvJM4Y&ab_channel=SupeRailsbyYaroslavShmarov">YarpslavShmarov 教學影片</a></li><li><a href="https://github.com/zquestz/omniauth-google-oauth2">omniauth-google-oauth2</a></li><li><a href="https://medium.com/tingyiiii/rails%E5%AF%A6%E4%BD%9C%E7%AC%AC%E4%B8%89%E6%96%B9%E7%99%BB%E5%85%A5-google-2a0851b74193">Rails 實作第三方登入-Google</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails套件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
            <tag> Rails </tag>
            
            <tag> Devise </tag>
            
            <tag> 套件 </tag>
            
            <tag> 會員系統 </tag>
            
            <tag> google </tag>
            
            <tag> github </tag>
            
            <tag> Omniauth </tag>
            
            <tag> Oauth </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>進入Rails世界必須懂：Model 關聯性 (N:N）</title>
      <link href="/2022/10/28/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AModel-%E9%97%9C%E8%81%AF%E6%80%A7-N-N%EF%BC%89/"/>
      <url>/2022/10/28/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AModel-%E9%97%9C%E8%81%AF%E6%80%A7-N-N%EF%BC%89/</url>
      
        <content type="html"><![CDATA[<h2 id="多對多-N-N"><a href="#多對多-N-N" class="headerlink" title="多對多 N:N"></a>多對多 N:N</h2><p>關於多對多繼續用飲料店的例子舉例說明，可以想像我們很多間飲料店品牌，有很多飲料品項是相同的或不同，就會有需要有一張第三方表單來記錄：</p><ul><li>一間飲料店可以有很多種飲料<ul><li>store has many drinks</li></ul></li><li>同一種飲料可以被很多間不同的飲料店販賣<ul><li>drink has many stores</li></ul></li></ul><p>我們可以透過這張表單來知道，哪間店有賣哪些飲料，哪些飲料有被哪些店家販售。<br>他們之間的關係可以透過下面這張圖片看到，虛線的 has many 表示他們並不是真的直接有一對多的關聯，而是需要透過第三方表格來建立多對多關聯。</p><p><img src="https://i.imgur.com/F08kpbv.png"></p><p>我們可以建立第三方的表格 drink_invest 來記錄飲料和店家之間的關係<br><code>rails g model drink_invest store:references drink:references</code></p><p>加上 <code>reference</code> 或是 <code>belongs_to</code> 都可以讓這個表格自動建立出對應的 store_id 及 drink_id 欄位，並且可以：</p><ul><li>自動加上索引（index），加快查詢</li><li>自動幫 Model 加上 belongs_to</li></ul><p>需要建立這樣的第三方表格來建立關聯，是屬於多對多的關聯<br>drink 和 store 之間沒有直接 has_many 的關聯， 但可以使用 has_many through 去透過 drink_invest 建立多對多的關聯。</p><p>接著可以把相關的 model 建立好關聯</p><p>store.rb</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &lt; <span class="title class_ inherited__">ApplicationRecord</span></span><br><span class="line">  has_many <span class="symbol">:drink_invests</span></span><br><span class="line">  has_many <span class="symbol">:drinks</span>, <span class="symbol">through:</span> <span class="symbol">:drink_invests</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>drink.rb</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Drink</span> &lt; <span class="title class_ inherited__">ApplicationRecord</span></span><br><span class="line">  has_many <span class="symbol">:drink_invests</span></span><br><span class="line">  has_many <span class="symbol">:stores</span>, <span class="symbol">through:</span> <span class="symbol">:drink_invests</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="進入-rails-console-試試看"><a href="#進入-rails-console-試試看" class="headerlink" title="進入 rails console 試試看"></a>進入 rails console 試試看</h2><p>先建立好我們需要的資料，店家、飲料、還有店家販售的飲料有哪些。</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s1 = Store.create(<span class="symbol">name:</span><span class="string">&quot;五石蘭&quot;</span>, <span class="symbol">tel:</span><span class="string">&quot;031234567&quot;</span>, <span class="symbol">address:</span><span class="string">&quot;新竹縣&quot;</span>, <span class="symbol">owner_id:</span><span class="number">1</span>)</span><br><span class="line">s2 = Store.create(<span class="symbol">name:</span><span class="string">&quot;渴不渴&quot;</span>, <span class="symbol">tel:</span><span class="string">&quot;03323232&quot;</span>, <span class="symbol">address:</span><span class="string">&quot;台北市&quot;</span>, <span class="symbol">owner_id:</span><span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d1 = Drink.create(<span class="symbol">name:</span> <span class="string">&quot;紅茶&quot;</span>, <span class="symbol">price:</span> <span class="number">30</span>)</span><br><span class="line">d2 = Drink.create(<span class="symbol">name:</span> <span class="string">&quot;綠茶&quot;</span>, <span class="symbol">price:</span> <span class="number">30</span>)</span><br><span class="line">d3 = Drink.create(<span class="symbol">name:</span> <span class="string">&quot;珍珠奶茶&quot;</span>, <span class="symbol">price:</span> <span class="number">60</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 五石蘭 有賣 紅茶跟綠茶</span></span><br><span class="line">s1.drinks = [d1, d2]</span><br><span class="line"><span class="comment"># 渴不渴 有賣 綠茶跟珍珠奶茶</span></span><br><span class="line">s2.drinks = [d2, d3]</span><br></pre></td></tr></table></figure><p>查詢相關的資訊之後會注意到 sql 語法的變化，開始透過第三方表格進行查詢。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 有販售 d1 綠茶有幾家</span><br><span class="line">d1.stores.<span class="built_in">count</span></span><br><span class="line">   (<span class="number">0.6</span>ms)  <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> &quot;stores&quot; <span class="keyword">INNER</span> <span class="keyword">JOIN</span> &quot;drink_invests&quot; <span class="keyword">ON</span> &quot;stores&quot;.&quot;id&quot; <span class="operator">=</span> &quot;drink_invests&quot;.&quot;store_id&quot; <span class="keyword">WHERE</span> &quot;drink_invests&quot;.&quot;drink_id&quot; <span class="operator">=</span> ?  [[&quot;drink_id&quot;, <span class="number">1</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"># 有販售 d2 紅茶有幾家</span><br><span class="line">d2.stores.<span class="built_in">count</span></span><br><span class="line">   (<span class="number">0.5</span>ms)  <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> &quot;stores&quot; <span class="keyword">INNER</span> <span class="keyword">JOIN</span> &quot;drink_invests&quot; <span class="keyword">ON</span> &quot;stores&quot;.&quot;id&quot; <span class="operator">=</span> &quot;drink_invests&quot;.&quot;store_id&quot; <span class="keyword">WHERE</span> &quot;drink_invests&quot;.&quot;drink_id&quot; <span class="operator">=</span> ?  [[&quot;drink_id&quot;, <span class="number">2</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"> # 有販售 d3 奶茶有幾家</span><br><span class="line"> d3.stores.<span class="built_in">count</span></span><br><span class="line">   (<span class="number">0.4</span>ms)  <span class="keyword">SELECT</span> <span class="built_in">COUNT</span>(<span class="operator">*</span>) <span class="keyword">FROM</span> &quot;stores&quot; <span class="keyword">INNER</span> <span class="keyword">JOIN</span> &quot;drink_invests&quot; <span class="keyword">ON</span> &quot;stores&quot;.&quot;id&quot; <span class="operator">=</span> &quot;drink_invests&quot;.&quot;store_id&quot; <span class="keyword">WHERE</span> &quot;drink_invests&quot;.&quot;drink_id&quot; <span class="operator">=</span> ?  [[&quot;drink_id&quot;, <span class="number">3</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> <span class="number">1</span></span><br></pre></td></tr></table></figure><p>可以發現，這些查詢的 SQL 語法中，都已經不是直接跟 Store 或 Drink 要資料，而是向 drink_invest 進行查詢。例如第二項查詢在 s1 跟 s2 都有 d2 這個商品，所以是 2 家。</p><p>「多對多」關連，在使用上就跟一般的「一對多」很像，但實際上的資訊都是記錄在第三方資料表裡。</p><hr><p>參考資料：</p><ol><li><a href="https://railsbook.tw/chapters/18-model-relationship">為你自己學 Ruby on Rails</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>進入Rails世界必須懂：Model 關聯性 (1:N)</title>
      <link href="/2022/10/27/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AModel-%E9%97%9C%E8%81%AF%E6%80%A7-1-N/"/>
      <url>/2022/10/27/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AModel-%E9%97%9C%E8%81%AF%E6%80%A7-1-N/</url>
      
        <content type="html"><![CDATA[<h2 id="1-N-一對多"><a href="#1-N-一對多" class="headerlink" title="1:N 一對多"></a>1:N 一對多</h2><p>如果我們希望每間商店可以販售許多種飲料，可以使用一對多模式來進行關連。</p><p>先建立 Drink 這個 Model：<br><code>rails g model Drink name price:decimal store_id:integer</code></p><p>目前的資料關聯設計像下圖<br><img src="https://i.imgur.com/24StW2e.png"></p><p>先把 model 之間的關聯建立好</p><p>drink.rb</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Drink</span> &lt; <span class="title class_ inherited__">ApplicationRecord</span></span><br><span class="line">  belongs_to <span class="symbol">:stores</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>store.rb</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &lt; <span class="title class_ inherited__">ApplicationRecord</span></span><br><span class="line">  has_many <span class="symbol">:drinks</span></span><br><span class="line">  belongs_to <span class="symbol">:owner</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="方法建立"><a href="#方法建立" class="headerlink" title="方法建立"></a>方法建立</h3><p>跟 has_one 一樣，設定 has_many :drinks 後會多了以下幾個方法，belongs_to 建立的方法跟 1:1 是一樣，這邊就不多提：</p><blockquote><p>drinks<br>drinks&#x3D;<br>build<br>create</p></blockquote><h3 id="console-測試看看"><a href="#console-測試看看" class="headerlink" title="console 測試看看"></a>console 測試看看</h3><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找回上次建立的飲料店</span></span><br><span class="line">s1 = Store.last</span><br><span class="line"></span><br><span class="line"><span class="symbol">id:</span> <span class="number">1</span>,</span><br><span class="line"><span class="symbol">name:</span> <span class="string">&quot;五石蘭&quot;</span>,</span><br><span class="line"><span class="symbol">tel:</span> <span class="string">&quot;031234567&quot;</span>,</span><br><span class="line"><span class="symbol">address:</span> <span class="string">&quot;新竹縣&quot;</span>,</span><br><span class="line"><span class="symbol">owner_id:</span> <span class="number">1</span>,</span><br><span class="line"><span class="symbol">created_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">22</span><span class="symbol">:</span><span class="number">23.353390000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>,</span><br><span class="line"><span class="symbol">updated_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">22</span><span class="symbol">:</span><span class="number">23.353390000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 直接用 Drink 建立好再丟給 store</span></span><br><span class="line">d1 = <span class="title class_">Drink</span>.new(<span class="symbol">name:</span><span class="string">&quot;紅茶&quot;</span>, <span class="symbol">price:</span><span class="number">30</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">id:</span> <span class="number">1</span>,</span><br><span class="line"><span class="symbol">name:</span> <span class="string">&quot;紅茶&quot;</span>,</span><br><span class="line"><span class="symbol">price:</span> <span class="number">0.6e2</span>,</span><br><span class="line"><span class="symbol">store_id:</span> <span class="number">1</span>,</span><br><span class="line"><span class="symbol">created_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">52</span><span class="symbol">:</span><span class="number">50.417919000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>,</span><br><span class="line"><span class="symbol">updated_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">52</span><span class="symbol">:</span><span class="number">50.417919000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>&gt;,</span><br><span class="line"></span><br><span class="line"><span class="comment">#1 把 d1 放到陣列中指定給 s1.drinks</span></span><br><span class="line">s1.drinks = [d1]</span><br><span class="line"></span><br><span class="line"><span class="comment">#2 把 d1 插入到 s1.drinks 陣列</span></span><br><span class="line">s1.drinks &lt;&lt; d1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 透過 store 去建立 drink</span></span><br><span class="line">s1.drinks.create(<span class="symbol">name:</span><span class="string">&quot;珍珠奶茶&quot;</span>, <span class="symbol">price:</span><span class="number">60</span>)</span><br><span class="line"></span><br><span class="line"><span class="symbol">id:</span> <span class="number">2</span>,</span><br><span class="line"><span class="symbol">name:</span> <span class="string">&quot;珍珠奶茶&quot;</span>,</span><br><span class="line"><span class="symbol">price:</span> <span class="number">0.6e2</span>,</span><br><span class="line"><span class="symbol">store_id:</span> <span class="number">1</span>,</span><br><span class="line"><span class="symbol">created_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">54</span><span class="symbol">:</span><span class="number">55.118310000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>,</span><br><span class="line"><span class="symbol">updated_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">54</span><span class="symbol">:</span><span class="number">55.118310000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>&gt;]</span><br></pre></td></tr></table></figure><p>查出所有 s1 的飲料</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">s1.drinks</span><br><span class="line"></span><br><span class="line"><span class="symbol">id:</span> <span class="number">1</span>,</span><br><span class="line"><span class="symbol">name:</span> <span class="string">&quot;紅茶&quot;</span>,</span><br><span class="line"><span class="symbol">price:</span> <span class="number">0.3e2</span>,</span><br><span class="line"><span class="symbol">store_id:</span> <span class="number">1</span>,</span><br><span class="line"><span class="symbol">created_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">52</span><span class="symbol">:</span><span class="number">50.417919000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>,</span><br><span class="line"><span class="symbol">updated_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">52</span><span class="symbol">:</span><span class="number">50.417919000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>&gt;,</span><br><span class="line"><span class="symbol">id:</span> <span class="number">2</span>,</span><br><span class="line"><span class="symbol">name:</span> <span class="string">&quot;珍珠奶茶&quot;</span>,</span><br><span class="line"><span class="symbol">price:</span> <span class="number">0.6e2</span>,</span><br><span class="line"><span class="symbol">store_id:</span> <span class="number">1</span>,</span><br><span class="line"><span class="symbol">created_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">54</span><span class="symbol">:</span><span class="number">55.118310000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>,</span><br><span class="line"><span class="symbol">updated_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">54</span><span class="symbol">:</span><span class="number">55.118310000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>&gt;]</span><br></pre></td></tr></table></figure><p>也可以反查出某款飲料是哪間店</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找回最後建立的飲料(珍珠奶茶)</span></span><br><span class="line">d2 = Drink.last</span><br><span class="line"></span><br><span class="line"><span class="symbol">id:</span> <span class="number">2</span>,</span><br><span class="line"><span class="symbol">name:</span> <span class="string">&quot;珍珠奶茶&quot;</span>,</span><br><span class="line"><span class="symbol">price:</span> <span class="number">0.6e2</span>,</span><br><span class="line"><span class="symbol">store_id:</span> <span class="number">1</span>,</span><br><span class="line"><span class="symbol">created_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">54</span><span class="symbol">:</span><span class="number">55.118310000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>,</span><br><span class="line"><span class="symbol">updated_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">54</span><span class="symbol">:</span><span class="number">55.118310000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>&gt;]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 因為 belongs_to 可以利用 store 方法反查</span></span><br><span class="line">d2.store</span><br><span class="line"> <span class="symbol">id:</span> <span class="number">1</span>,</span><br><span class="line"> <span class="symbol">name:</span> <span class="string">&quot;五石蘭&quot;</span>,</span><br><span class="line"> <span class="symbol">tel:</span> <span class="string">&quot;031234567&quot;</span>,</span><br><span class="line"> <span class="symbol">address:</span> <span class="string">&quot;新竹縣&quot;</span>,</span><br><span class="line"> <span class="symbol">owner_id:</span> <span class="number">1</span>,</span><br><span class="line"> <span class="symbol">created_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">22</span><span class="symbol">:</span><span class="number">23.353390000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>,</span><br><span class="line"> <span class="symbol">updated_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">22</span><span class="symbol">:</span><span class="number">23.353390000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>&gt;</span><br></pre></td></tr></table></figure><hr><p>參考資料：</p><ol><li><a href="https://railsbook.tw/chapters/18-model-relationship">為你自己學 Ruby on Rails</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>進入Rails世界必須懂：Model 關聯性 (1:1)</title>
      <link href="/2022/10/23/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AModel-%E9%97%9C%E8%81%AF%E6%80%A7-1-1/"/>
      <url>/2022/10/23/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AModel-%E9%97%9C%E8%81%AF%E6%80%A7-1-1/</url>
      
        <content type="html"><![CDATA[<p>想好好學會 rails，不得不好好認識相當重要的關聯性，能夠理解並善用的話，你就能在各個 model 之間進行資料庫的溝通，拿到你想要的資料。</p><h2 id="Model-關聯性"><a href="#Model-關聯性" class="headerlink" title="Model 關聯性"></a>Model 關聯性</h2><p>Rails 的 Model 關聯主要有三種類型</p><ul><li>一對一 (1:1)</li><li>一對多 (1:N)</li><li>多對多 (N:N)</li></ul><p>今天這部分章節，會優先介紹 1 對 1。<br>我們用實際的例子來進行說明會更加清楚。</p><h3 id="1-1-一對一"><a href="#1-1-一對一" class="headerlink" title="1:1 一對一"></a>1:1 一對一</h3><p>假如我們今天想要開一間飲料店<br>我們會有一個店長 Owner<br>一個店長會有一間店 Store</p><p>假設每個店長可以開一間店，這種關係就是一對一的關係。<br>&#x3D;&gt; Owner has one store</p><p>可以先從 rails 中產生 Owner 的 Model 並生成對應的資料表來記錄店長的資訊</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model Owner name phone:integer</span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/59FadP9.png"></p><p>再產生 Store 的 Model 並生成對應的資料表來記錄商店的資訊，由於需要多一個 owner_id 所以透過指令 <code>owner:references</code> 或是 <code>owner:belongs_to</code> 來產生，這一個欄位可以讓我們知道</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rails g model Store name tel address owner:references</span><br><span class="line">rails g model Store name tel address owner:belongs_to (同上一行)</span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/RTjtkNT.png"></p><p><img src="https://i.imgur.com/QrbT5rU.png"><br>兩者的關係可以看到上圖表示，在 onwer 的 model 裡面可以加上對應的關聯，如果需要讓兩者之間有所關聯，belongs to 的那方就要有對應的 id 去紀錄，這邊就是透過 owner_id 。</p><h4 id="has-one-建立及產生的方法"><a href="#has-one-建立及產生的方法" class="headerlink" title="has one 建立及產生的方法"></a>has one 建立及產生的方法</h4><p>到 Owner model 建立 has_one 關聯</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Owner</span> &lt; <span class="title class_ inherited__">ApplicationRecord</span></span><br><span class="line">  has_one <span class="symbol">:store</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>關聯產生後就自動產生以下方法，你可以用來在 controller 傳遞資料時進行關聯的查找，或是 console 中操作資料時使用。</p><blockquote><p>store<br>store&#x3D;<br>build_store<br>create_store</p></blockquote><p>其中 build 和 create 差異，build 還沒存入資料庫，create 直接存入</p><p>用 console 建立一個 Owner 然後用 crate_store 建立一個 Store</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">Owner.create(<span class="symbol">name:</span><span class="string">&quot;Sean&quot;</span>, <span class="symbol">phone:</span><span class="string">&quot;0912345678&quot;</span>)</span><br><span class="line"></span><br><span class="line">o1 = Owner.first</span><br><span class="line"></span><br><span class="line">o1.create_store(<span class="symbol">name:</span><span class="string">&quot;五石蘭&quot;</span>, <span class="symbol">tel:</span><span class="string">&quot;031234567&quot;</span>, <span class="symbol">address:</span><span class="string">&quot;新竹縣&quot;</span>)</span><br><span class="line"></span><br><span class="line">Store.last</span><br><span class="line"> <span class="symbol">id:</span> <span class="number">1</span>,</span><br><span class="line"> <span class="symbol">name:</span> <span class="string">&quot;五石蘭&quot;</span>,</span><br><span class="line"> <span class="symbol">tel:</span> <span class="string">&quot;031234567&quot;</span>,</span><br><span class="line"> <span class="symbol">address:</span> <span class="string">&quot;新竹縣&quot;</span>,</span><br><span class="line"> <span class="symbol">owner_id:</span> <span class="number">1</span>,</span><br><span class="line"> <span class="symbol">created_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">22</span><span class="symbol">:</span><span class="number">23.353390000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>,</span><br><span class="line"> <span class="symbol">updated_at:</span> Fri, <span class="number">07</span> Oct <span class="number">2022</span> <span class="number">07</span><span class="symbol">:</span><span class="number">22</span><span class="symbol">:</span><span class="number">23.353390000</span> <span class="variable constant_">UTC</span> +<span class="number">00</span><span class="symbol">:</span><span class="number">00</span>&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="belongs-to-建立及產生的方法"><a href="#belongs-to-建立及產生的方法" class="headerlink" title="belongs_to 建立及產生的方法"></a>belongs_to 建立及產生的方法</h4><p>在 store 的 model 裡面也看到已經加好的關聯 (owner:references&#x2F;owner:belongs_to 自動產生)，如果沒有透過之前指令也可以自己加上去，或是你沒有要用到產生的方法也可以不寫。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Store</span> &lt; <span class="title class_ inherited__">ApplicationRecord</span></span><br><span class="line">  belongs_to <span class="symbol">:owner</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>加上後也會因關聯產生後就自動產生以下方法</p><blockquote><p>owner<br>owner&#x3D;</p></blockquote><p>用上面建立好的 store 可以反向利用 owner 查到擁有者是誰，你也可以用 onwer&#x3D; 來更改擁有者的資料</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">s1 = Store.last</span><br><span class="line"></span><br><span class="line">s1.owner</span><br><span class="line">  Owner Load (<span class="number">0</span>.5ms)  <span class="variable constant_">SELECT</span> <span class="string">&quot;owners&quot;</span>.* <span class="variable constant_">FROM</span> <span class="string">&quot;owners&quot;</span> <span class="variable constant_">WHERE</span> <span class="string">&quot;owners&quot;</span>.<span class="string">&quot;id&quot;</span> = ? <span class="variable constant_">LIMIT</span> ?  [[<span class="string">&quot;id&quot;</span>, <span class="number">1</span>], [<span class="string">&quot;LIMIT&quot;</span>, <span class="number">1</span>]]</span><br><span class="line"> =&gt;</span><br><span class="line">#&lt;Owner:0x00007f8e292a7308</span><br><span class="line"> id: 1,</span><br><span class="line"> name: &quot;Sean&quot;,</span><br><span class="line"> phone: &quot;0912345678&quot;,</span><br><span class="line"> created_at: Fri, 07 Oct 2022 07:18:45.627220000 UTC +00:00,</span><br><span class="line"> updated_at: Fri, 07 Oct 2022 07:18:45.627220000 UTC +00:00&gt;</span><br></pre></td></tr></table></figure><p>補充：</p><ol><li><p>has_one 跟 belongs_to 方法需要同時設定嗎？<br>不一定。如果不需要「從 Store 反查 Owner」的方法，那 belongs_to 就不需要設定了。或是不需要從 Owner 創建 store 或是查詢，也可以不用寫 has_one。</p></li><li><p>如果只設定 has_one 或 belongs_to 其中一項的話會怎樣？<br>有設定的話就會有方法，沒設定也沒關係，依造自己需要進行設定。</p></li></ol><hr><p>參考資料：</p><ol><li><a href="https://railsbook.tw/chapters/18-model-relationship">為你自己學 Ruby on Rails</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>瀏覽器輸入網址後到出現頁面會發生什麼事情？</title>
      <link href="/2022/10/22/%E7%80%8F%E8%A6%BD%E5%99%A8%E8%BC%B8%E5%85%A5%E7%B6%B2%E5%9D%80%E5%BE%8C%E5%88%B0%E5%87%BA%E7%8F%BE%E9%A0%81%E9%9D%A2%E6%9C%83%E7%99%BC%E7%94%9F%E4%BB%80%E9%BA%BC%E4%BA%8B%E6%83%85%EF%BC%9F/"/>
      <url>/2022/10/22/%E7%80%8F%E8%A6%BD%E5%99%A8%E8%BC%B8%E5%85%A5%E7%B6%B2%E5%9D%80%E5%BE%8C%E5%88%B0%E5%87%BA%E7%8F%BE%E9%A0%81%E9%9D%A2%E6%9C%83%E7%99%BC%E7%94%9F%E4%BB%80%E9%BA%BC%E4%BA%8B%E6%83%85%EF%BC%9F/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>最近面試被問到這個問題，發現裡面觀念牽涉很廣，每個步驟都可以單獨找到很多觀念跟理論，簡單分享以下四個主要的步驟。</p></div><h2 id="1-輸入網址"><a href="#1-輸入網址" class="headerlink" title="1. 輸入網址"></a>1. 輸入網址</h2><p>使用者輸入 (假設 <a href="https://google.com/maps/search/shop">https://google.com/maps/search/shop</a> )<br>因為瀏覽器無法根據 URL (Uniform Resource Locator) 直接定位到對應的資源，而是要根據 ip 才能找到，所以必須進行域名的解析</p><h2 id="2-進行域名解析-DNS-Domain-Name-System-得到-IP"><a href="#2-進行域名解析-DNS-Domain-Name-System-得到-IP" class="headerlink" title="2. 進行域名解析 DNS(Domain Name System) 得到 IP"></a>2. 進行域名解析 DNS(Domain Name System) 得到 IP</h2><p>瀏覽器透過作業系統從中解析出「通訊協定（Protocol）」、「網域（Domain）」、「路徑（Path）」等資訊，經過本地瀏覽器快取及 DNS server 等查找方式來找到跟這些域名對應的 <code>ip 位置</code><br><img src="https://i.imgur.com/SXwQRWv.png"></p><p>查找 ip 的順序 1. 檢查本地的 DNS 快取 2. 檢查電腦中的 .host 檔 3. 向 DNS 伺服器發送詢問</p><p>找到 ip 後丟回給瀏覽器，瀏覽器根據解析出的 IP，開始建立連線</p><h2 id="3-TCP-Transmission-Control-Protocol）開始進行三次握手建立連線"><a href="#3-TCP-Transmission-Control-Protocol）開始進行三次握手建立連線" class="headerlink" title="3. TCP (Transmission Control Protocol）開始進行三次握手建立連線"></a>3. TCP (Transmission Control Protocol）開始進行三次握手建立連線</h2><p>透過 TCP&#x2F;IP 協議 (是一種傳輸方式，browser 無法建立 HTTP、HTTPS、TCP 傳輸、從網址查找 IP，這些是由 TCP&#x2F;IP 傳輸協定做的)，經過三次握手建立連線，</p><p>三次握手指的是像下面的請求與回應。完成後便可以讓 client 與 server 建立連線</p><blockquote><p>client: 1.2.3.4 hello 你在嗎？ 我要準備跟你拿取資料摟<br>server: 我在喔，你可以來拿了。<br>client: 好，我要過去拿了</p></blockquote><p>連線建立後，如果通訊協定是 HTTPS，瀏覽器會與伺服器建立 TLS 加密；隨後，瀏覽器依照 IP 位置及 port（http 預設 80，https 預設 443），準備發送請求並將資訊打包成一個個封包開始進行傳輸。</p><h2 id="4-發送-http-請求（後端資料處理、前端畫面渲染）"><a href="#4-發送-http-請求（後端資料處理、前端畫面渲染）" class="headerlink" title="4. 發送 http 請求（後端資料處理、前端畫面渲染）"></a>4. 發送 http 請求（後端資料處理、前端畫面渲染）</h2><p>建立連線之後，就發送請求 (Request)，server 再根據請求的動作(get, post)決定後續資料的處理，在 server 端主要會是以 MVC 架構的流程進行 （<a href="https://oseanchen.github.io/2022/10/13/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AMVC%20%E6%98%AF%E7%94%9A%E9%BA%BC/">MVC 概念參考這篇介紹</a>）</p><p>假設我們是要呈現出 google 目前的首頁頁面，routes 會帶我們找到對應 controller 的 action 上面，根據 action 寫好的方法，請 model 向資料庫溝通拿取對應的資料，回到 controller 再根據 action 將資料處理成最後 view 要使用的物件，交給對應的 view 去進行呈現。</p><hr><p>參考資料：</p><ol><li><a href="https://ithelp.ithome.com.tw/articles/10228442">(鐵人賽) 從輸入網址列到渲染畫面，過程經歷了什麼事情？</a></li><li><a href="https://roykwokcode.medium.com/%E5%89%8D%E7%AB%AF%E9%9D%A2%E8%A9%A6%E8%80%83%E5%AE%98-%E5%BE%9E%E4%BD%A0%E8%BC%B8%E5%85%A5%E7%B6%B2%E5%9D%80-%E5%88%B0%E7%B6%B2%E9%A0%81%E5%87%BA%E7%8F%BE-%E9%80%99%E9%81%8E%E7%A8%8B%E5%88%B0%E7%99%BC%E7%94%9F%E4%BA%86%E4%BB%80%E9%BA%BC-414dc3404619">前端面試考官：從你輸入網址，到網頁出現，這過程到發生了什麼？</a></li><li><a href="https://www.youtube.com/watch?v=AlkDbnbv7dk&ab_channel=ByteByteGo">What happens when you type a URL into your browser?</a></li><li><a href="https://w3c.hexschool.com/blog/8d691e4f">[熱門面試題] 從輸入網址列到渲染畫面，過程經歷了什麼事？</a></li><li><a href="https://www.cythilya.tw/2018/11/26/what-happens-when-you-type-an-url-in-the-browser-and-press-enter/">在瀏覽器輸入網址並送出後，到底發生了什麼事？</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 網路概念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> REST </tag>
            
            <tag> RESTful </tag>
            
            <tag> 網路 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>進入Rails世界必須懂：Migration</title>
      <link href="/2022/10/22/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AMigration/"/>
      <url>/2022/10/22/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AMigration/</url>
      
        <content type="html"><![CDATA[<h2 id="Migration-是什麼"><a href="#Migration-是什麼" class="headerlink" title="Migration 是什麼"></a>Migration 是什麼</h2><p>就是一個紀錄「資料庫的架構」的檔案，我們可以知道目前資料庫的欄位有什麼？、型態是什麼？，也可以知道目前修改的紀錄與過程。可以跟著 git 一起把資料庫架構變更的進行版本控制。</p><h2 id="建立-Migration"><a href="#建立-Migration" class="headerlink" title="建立 Migration"></a>建立 Migration</h2><p>利用之前 article 的例子來看，先產生一個 article 的 model<br><code>rails g model Article title content:text</code></p><p>會長出下面的 migration 紀錄</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CreateArticles</span> &lt; <span class="title class_ inherited__">ActiveRecord::Migration</span>[<span class="number">6.1</span>]</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">change</span></span><br><span class="line">    create_table <span class="symbol">:articles</span> <span class="keyword">do</span> |<span class="params">t</span>|</span><br><span class="line">      t.string <span class="symbol">:title</span></span><br><span class="line">      t.text <span class="symbol">:content</span></span><br><span class="line"></span><br><span class="line">      t.timestamps</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>看到有 title 及 content 資訊，還有<a href="https://ithelp.ithome.com.tw/articles/10303421">先前文章</a>提到 id (不會顯示) 及 timestamps。</p><p>這邊只是先將資料表的內容描述好，需要進行 <code>rails db:migrate</code> 這個指令之後才可以把相關的資料表<strong>具象化</strong>，你可以想像成 rails 幫我們依照 migration 去做出對應的資料表。</p><h2 id="修改-Migration"><a href="#修改-Migration" class="headerlink" title="修改 Migration"></a>修改 Migration</h2><p>前面提到具象化後我們的資料表就會依照 migration 去產生，但如果我們發現有些欄位需要調整應該怎麼辦？<br>像是我們如果要把上面再加入一個欄位叫做 tag 並且為 string 的類型。</p><p>我們可以先進行 <code>rails db:rollback</code> 將具現化的資料表退回還沒具現化的狀態，就可以進行修改</p><p>修改的方式：</p><ol><li>直接修改原本 migration</li><li>再新增一個新的 migration</li></ol><p>建議使用第 2 種，因為如果多人協作，這樣在進行 git 版控的時候就會把新增的 migration 一起同步，其他人也不用 rollback 再 migrate，也可以避免原本檔案修改的時候動到其他資料。</p><h3 id="新增-column"><a href="#新增-column" class="headerlink" title="新增 column"></a>新增 column</h3><p>新增一個 migration，通常命名會是 add_column_to_model 這樣的格式，你可以自己命名。<br><code>rails g migration add_tag_to_article</code></p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AddTagToArticle</span> &lt; <span class="title class_ inherited__">ActiveRecord::Migration</span>[<span class="number">6.1</span>]</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">change</span></span><br><span class="line">    add_column <span class="symbol">:articles</span>, <span class="symbol">:tag</span>, <span class="symbol">:string</span></span><br><span class="line">    <span class="comment">#           table 名, 欄位, 格式</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>如果要全部自動產生也可以，可以像這樣輸入，會產生跟上面一樣的效果，但有時候比較細部的調整還是會自己手動。<br><code>rails g migration add_tag_to_articles tag:string</code></p><h3 id="移除-column"><a href="#移除-column" class="headerlink" title="移除 column"></a>移除 column</h3><p>也可以進行移除，類似上面的格式，但前面改成，remove_column</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AddTagToArticle</span> &lt; <span class="title class_ inherited__">ActiveRecord::Migration</span>[<span class="number">6.1</span>]</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">change</span></span><br><span class="line">    remove_column <span class="symbol">:articles</span>, <span class="symbol">:content</span>, <span class="symbol">:text</span></span><br><span class="line">    <span class="comment">#              table 名, 欄位, 格式</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>之後記得再進行一次 migration。</p><h3 id="如果沒寫好就進行-migration"><a href="#如果沒寫好就進行-migration" class="headerlink" title="如果沒寫好就進行 migration?"></a>如果沒寫好就進行 migration?</h3><p>不會怎麼樣，就執行了一個空的 Migration，可能就會看到 Migration 檔案裡就有寫這些欄位，但 schema.rb 檔案裡卻沒有的情況。可以在 rollback 回去重新調整在進行一次 migrate。</p><h2 id="一些常用的相關指令"><a href="#一些常用的相關指令" class="headerlink" title="一些常用的相關指令"></a>一些常用的相關指令</h2><ul><li><p>新增<br><code>rails g migration ...</code></p></li><li><p>刪除<br><code>rails d migration ...</code></p></li><li><p>把整個資料庫內容移除 (所有建立好的資料都會移除)<br><code>rails db:drop</code></p></li><li><p>重新建立資料庫<br><code>rails db:create</code></p></li><li><p>檢查所有 migration 狀況<br><code>rails db:migrate:status</code></p></li></ul><p>可以看到下面這樣得狀態顯示，<code>up</code> 表示已經 migrate 過的檔案，<code>down</code> 還沒具象化。<br>可以用這邊檢視目前哪些檔案還沒具象化</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">rails <span class="symbol">db:</span><span class="symbol">migrate:</span>status</span><br><span class="line"></span><br><span class="line">Running via Spring preloader <span class="keyword">in</span> process <span class="number">30265</span></span><br><span class="line"></span><br><span class="line"><span class="symbol">database:</span> db/development.sqlite3</span><br><span class="line"></span><br><span class="line"> Status   Migration <span class="variable constant_">ID</span>    Migration Name</span><br><span class="line">--------------------------------------------------</span><br><span class="line">   up     <span class="number">20221002055926</span>  Create stores</span><br><span class="line">   up     <span class="number">20221002153623</span>  Create articles</span><br><span class="line">  down    <span class="number">20221005091102</span>  Add tag to article</span><br></pre></td></tr></table></figure><hr><p>參考資料：</p><ol><li><a href="https://guides.rubyonrails.org/active_record_migrations.html">Rails Guide</a></li><li><a href="https://railsbook.tw/chapters/17-model-migration#what-is-migration">為你自己學 Ruby on Rails</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>進入Rails世界必須懂：Model 相關介紹 及 CRUD (下)</title>
      <link href="/2022/10/22/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AModel-%E7%9B%B8%E9%97%9C%E4%BB%8B%E7%B4%B9-%E5%8F%8A-CRUD-%E4%B8%8B/"/>
      <url>/2022/10/22/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AModel-%E7%9B%B8%E9%97%9C%E4%BB%8B%E7%B4%B9-%E5%8F%8A-CRUD-%E4%B8%8B/</url>
      
        <content type="html"><![CDATA[<p>接著上一篇我們繼續說明用 ORM 來操作 CRUD 的部分 關於讀取的部分還可以怎麼去找到，還有後面的 update 及 delete 的說明。</p><h2 id="更精準的讀取-find-amp-find-by-amp-Where"><a href="#更精準的讀取-find-amp-find-by-amp-Where" class="headerlink" title="更精準的讀取 find &amp; find_by &amp; Where"></a>更精準的讀取 find &amp; find_by &amp; Where</h2><h3 id="find-amp-find-by"><a href="#find-amp-find-by" class="headerlink" title="find &amp; find_by"></a>find &amp; find_by</h3><blockquote><p>用 find 來找 id<br><code>Model.find(:id)</code><br>find_by 可以找特定欄位的資訊是否有對應的資料<br><code>Model.find_by(欄位名: 值)</code></p></blockquote><p>兩者的差異：</p><ul><li>find 只能找 id，find_by 可以找任何資料表內的東西</li><li>find 找不到會出錯， find_by 只會回傳 nil</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.0</span><span class="number">.0</span> :<span class="number">001</span> <span class="operator">&gt;</span> a1 <span class="operator">=</span> Article.find(<span class="number">1</span>)</span><br><span class="line">  Article Load (<span class="number">0.2</span>ms)  <span class="keyword">SELECT</span> &quot;articles&quot;.<span class="operator">*</span> <span class="keyword">FROM</span> &quot;articles&quot; <span class="keyword">WHERE</span> &quot;articles&quot;.&quot;id&quot; <span class="operator">=</span> ? LIMIT ?  [[&quot;id&quot;, <span class="number">1</span>], [&quot;LIMIT&quot;, <span class="number">1</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> #<span class="operator">&lt;</span>Article id: <span class="number">1</span>, title: &quot;文章1&quot;, content: &quot;進入ruby世界說hello world&quot;, created_at: &quot;2022-10-03 12:41:21.8330...</span><br><span class="line"></span><br><span class="line">3.0.0 :002 &gt; a2 = Article.find_by(id: 2)</span><br><span class="line">  Article Load (0.3ms)  SELECT &quot;articles&quot;.* FROM &quot;articles&quot; WHERE &quot;articles&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 2], [&quot;LIMIT&quot;, 1]]</span><br><span class="line"> =&gt; #&lt;Article id: 2, title: &quot;文章<span class="number">2</span>&quot;, content: &quot;CRUD是什麼？&quot;, created_at: &quot;<span class="number">2022</span><span class="number">-10</span><span class="number">-04</span> <span class="number">09</span>:<span class="number">31</span>:<span class="number">49.206583000</span> <span class="operator">+</span><span class="number">0000</span>&quot;,...</span><br><span class="line"></span><br><span class="line">3.0.0 :003 &gt; a2 = Article.find_by(title: &quot;文章<span class="number">2</span>&quot;)</span><br><span class="line">  Article Load (0.3ms)  SELECT &quot;articles&quot;.* FROM &quot;articles&quot; WHERE &quot;articles&quot;.&quot;title&quot; = ? LIMIT ?  [[&quot;title&quot;, &quot;文章<span class="number">2</span>&quot;], [&quot;LIMIT&quot;, 1]]</span><br><span class="line"> =&gt; #&lt;Article id: 2, title: &quot;文章<span class="number">2</span>&quot;, content: &quot;CRUD是什麼？&quot;, created_at: &quot;<span class="number">2022</span><span class="number">-10</span><span class="number">-04</span> <span class="number">09</span>:<span class="number">31</span>:<span class="number">49.206583000</span> <span class="operator">+</span><span class="number">0000</span>&quot;,...</span><br></pre></td></tr></table></figure><p>找不到資料時的差別</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4.3</span><span class="number">.0</span><span class="number">.0</span> :<span class="number">001</span> <span class="operator">&gt;</span> a3 <span class="operator">=</span> Article.find_by(id: <span class="number">3</span>)</span><br><span class="line">  Article Load (<span class="number">0.3</span>ms)  <span class="keyword">SELECT</span> &quot;articles&quot;.<span class="operator">*</span> <span class="keyword">FROM</span> &quot;articles&quot; <span class="keyword">WHERE</span> &quot;articles&quot;.&quot;id&quot; <span class="operator">=</span> ? LIMIT ?  [[&quot;id&quot;, <span class="number">3</span>], [&quot;LIMIT&quot;, <span class="number">1</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> nil</span><br><span class="line"></span><br><span class="line"><span class="number">4.3</span><span class="number">.0</span><span class="number">.0</span> :<span class="number">002</span> <span class="operator">&gt;</span> a3 <span class="operator">=</span> Article.find(<span class="number">3</span>)</span><br><span class="line">  Article Load (<span class="number">0.3</span>ms)  <span class="keyword">SELECT</span> &quot;articles&quot;.<span class="operator">*</span> <span class="keyword">FROM</span> &quot;articles&quot; <span class="keyword">WHERE</span> &quot;articles&quot;.&quot;id&quot; <span class="operator">=</span> ? LIMIT ?  [[&quot;id&quot;, <span class="number">3</span>], [&quot;LIMIT&quot;, <span class="number">1</span>]]</span><br><span class="line">Traceback (most recent <span class="keyword">call</span> <span class="keyword">last</span>):</span><br><span class="line">        <span class="number">1</span>: <span class="keyword">from</span> (irb):<span class="number">13</span>:<span class="keyword">in</span> `<span class="operator">&lt;</span>main<span class="operator">&gt;</span><span class="string">&#x27;</span></span><br><span class="line"><span class="string">ActiveRecord::RecordNotFound (Couldn&#x27;</span>t find Article <span class="keyword">with</span> <span class="string">&#x27;id&#x27;</span><span class="operator">=</span><span class="number">3</span>)</span><br><span class="line"><span class="number">3.0</span><span class="number">.0</span> :<span class="number">014</span> <span class="operator">&gt;</span></span><br></pre></td></tr></table></figure><h3 id="where"><a href="#where" class="headerlink" title="where"></a>where</h3><p>where 可以搭配一些篩選條件，比如過 id &gt; 1，內容包含某些資料之類的條件等等，</p><p>我們再建立第 3 筆文章資料，然後透過 where 篩選 id &gt; 1 看看吧。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.0</span><span class="number">.0</span> :<span class="number">001</span> <span class="operator">&gt;</span> Article.all</span><br><span class="line">  Article Load (<span class="number">0.3</span>ms)  <span class="keyword">SELECT</span> &quot;articles&quot;.<span class="operator">*</span> <span class="keyword">FROM</span> &quot;articles&quot; <span class="comment">/* loading for inspect */</span> LIMIT ?  [[&quot;LIMIT&quot;, <span class="number">11</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> #<span class="operator">&lt;</span>ActiveRecord::Relation [#<span class="operator">&lt;</span>Article id: <span class="number">1</span>, title: &quot;文章1&quot;, content: &quot;進入ruby世界說hello world&quot;, created_at: &quot;2022-10-03 12:41:21.833091000 +0000&quot;, updated_at: &quot;2022-10-03 12:41:21.833091000 +0000&quot;<span class="operator">&gt;</span>, #<span class="operator">&lt;</span>Article id: <span class="number">2</span>, title: &quot;文章2&quot;, content: &quot;CRUD是什麼？&quot;, created_at: &quot;2022-10-04 09:31:49.206583000 +0000&quot;, updated_at: &quot;2022-10-04 09:31:49.206583000 +0000&quot;<span class="operator">&gt;</span>, #<span class="operator">&lt;</span>Article id: <span class="number">3</span>, title: &quot;文章3&quot;, content: &quot;MVC是什麼？&quot;, created_at: &quot;2022-10-04 10:10:05.905998000 +0000&quot;, updated_at: &quot;2022-10-04 10:10:05.905998000 +0000&quot;<span class="operator">&gt;</span>]<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">4.3</span><span class="number">.0</span><span class="number">.0</span> :<span class="number">002</span> <span class="operator">&gt;</span> Article.where(&quot;id &gt; 1&quot;)</span><br><span class="line">  Article Load (<span class="number">0.4</span>ms)  <span class="keyword">SELECT</span> &quot;articles&quot;.<span class="operator">*</span> <span class="keyword">FROM</span> &quot;articles&quot; <span class="keyword">WHERE</span> (id <span class="operator">&gt;</span> <span class="number">1</span>) <span class="comment">/* loading for inspect */</span> LIMIT ?  [[&quot;LIMIT&quot;, <span class="number">11</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> #<span class="operator">&lt;</span>ActiveRecord::Relation [#<span class="operator">&lt;</span>Article id: <span class="number">2</span>, title: &quot;文章2&quot;, content: &quot;CRUD是什麼？&quot;, created_at: &quot;2022-10-04 09:31:49.206583000 +0000&quot;, updated_at: &quot;2022-10-04 09:31:49.206583000 +0000&quot;<span class="operator">&gt;</span>, #<span class="operator">&lt;</span>Article id: <span class="number">3</span>, title: &quot;文章3&quot;, content: &quot;MVC是什麼？&quot;, created_at: &quot;2022-10-04 10:10:05.905998000 +0000&quot;, updated_at: &quot;2022-10-04 10:10:05.905998000 +0000&quot;<span class="operator">&gt;</span>]<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure><p>可以看到根據條件就撈出 id&#x3D;2、id&#x3D;3 兩篇文章的資料。</p><h2 id="Update-更新"><a href="#Update-更新" class="headerlink" title="Update 更新"></a>Update 更新</h2><h3 id="用-save-更新"><a href="#用-save-更新" class="headerlink" title="用 save 更新"></a>用 save 更新</h3><p>先找到要的資料，然後修改欄位數值，再用 save 更新</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a1 = Article.find_by(<span class="symbol">id:</span> <span class="number">1</span>)</span><br><span class="line">a1.title = <span class="string">&quot;第一篇文章&quot;</span></span><br><span class="line">a1.save</span><br></pre></td></tr></table></figure><h3 id="使用-update-attribute"><a href="#使用-update-attribute" class="headerlink" title="使用 update_attribute"></a>使用 update_attribute</h3><p>只更新單一欄位的值 (attribute 是單數)，注意會跳過驗證</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a1.update_attribute(<span class="symbol">:title</span>, <span class="string">&quot;第一篇文章&quot;</span>)</span><br></pre></td></tr></table></figure><h3 id="使用-update-amp-update-attributes"><a href="#使用-update-amp-update-attributes" class="headerlink" title="使用 update &amp; update_attributes"></a>使用 update &amp; update_attributes</h3><p>兩個方法只是名稱不同，都可一次更新多個欄位，且不需要再呼叫 save 方法</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a1.update(<span class="symbol">title:</span> <span class="string">&quot;第一篇文章&quot;</span>, <span class="symbol">content:</span> <span class="string">&quot;你知道要怎麼印出&#x27;hello world&#x27;嗎？&quot;</span>)</span><br><span class="line">a1.update_attributes(<span class="symbol">title:</span> <span class="string">&quot;第一篇文章&quot;</span>, <span class="symbol">content:</span> <span class="string">&quot;你知道要怎麼印出&#x27;hello world&#x27;嗎？&quot;</span>)</span><br></pre></td></tr></table></figure><p>實際在 console 裡面操作的情形</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.0</span><span class="number">.0</span> :<span class="number">001</span> <span class="operator">&gt;</span> a1 <span class="operator">=</span> Article.find(<span class="number">1</span>)</span><br><span class="line">   (<span class="number">0.4</span>ms)  <span class="keyword">SELECT</span> sqlite_version(<span class="operator">*</span>)</span><br><span class="line">  Article Load (<span class="number">0.1</span>ms)  <span class="keyword">SELECT</span> &quot;articles&quot;.<span class="operator">*</span> <span class="keyword">FROM</span> &quot;articles&quot; <span class="keyword">WHERE</span> &quot;articles&quot;.&quot;id&quot; <span class="operator">=</span> ? LIMIT ?  [[&quot;id&quot;, <span class="number">1</span>], [&quot;LIMIT&quot;, <span class="number">1</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> #<span class="operator">&lt;</span>Article id: <span class="number">1</span>, title: &quot;文章1&quot;, content: &quot;進入ruby世界說hello world&quot;, created_at: &quot;2022-10-03 12:41:21.8330...</span><br><span class="line"></span><br><span class="line">3.0.0 :002 &gt; a1.update_attribute(:title, &quot;第一篇文章&quot;)</span><br><span class="line">  TRANSACTION (0.1ms)  begin transaction</span><br><span class="line">  Article Update (0.7ms)  UPDATE &quot;articles&quot; SET &quot;title&quot; = ?, &quot;updated_at&quot; = ? WHERE &quot;articles&quot;.&quot;id&quot; = ?  [[&quot;title&quot;, &quot;第一篇文章&quot;], [&quot;updated_at&quot;, &quot;<span class="number">2022</span><span class="number">-10</span><span class="number">-04</span> <span class="number">10</span>:<span class="number">20</span>:<span class="number">44.717780</span>&quot;], [&quot;id&quot;, 1]]</span><br><span class="line">  TRANSACTION (0.9ms)  commit transaction</span><br><span class="line"> =&gt; true</span><br><span class="line"></span><br><span class="line">3.0.0 :003 &gt; a1.title = &quot;改回文章<span class="number">1</span>&quot;</span><br><span class="line"> =&gt; &quot;改回文章<span class="number">1</span>&quot;</span><br><span class="line"></span><br><span class="line">3.0.0 :004 &gt; a1.save</span><br><span class="line">  TRANSACTION (0.1ms)  begin transaction</span><br><span class="line">  Article Update (0.7ms)  UPDATE &quot;articles&quot; SET &quot;title&quot; = ?, &quot;updated_at&quot; = ? WHERE &quot;articles&quot;.&quot;id&quot; = ?  [[&quot;title&quot;, &quot;改回文章<span class="number">1</span>&quot;], [&quot;updated_at&quot;, &quot;<span class="number">2022</span><span class="number">-10</span><span class="number">-04</span> <span class="number">10</span>:<span class="number">21</span>:<span class="number">31.485894</span>&quot;], [&quot;id&quot;, 1]]</span><br><span class="line">  TRANSACTION (1.0ms)  commit transaction</span><br><span class="line"> =&gt; true</span><br></pre></td></tr></table></figure><h2 id="Delete-刪除"><a href="#Delete-刪除" class="headerlink" title="Delete 刪除"></a>Delete 刪除</h2><p>刪除有 <code>delete</code> 及 <code>destroy</code> 兩種方法，可以將資料刪除。</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a1 = Article.find_by(<span class="symbol">id:</span> <span class="number">1</span>)</span><br><span class="line">a1.destroy</span><br><span class="line">a1.delete</span><br><span class="line"></span><br><span class="line"><span class="comment">## 等同於從 model 直接找id進行刪除</span></span><br><span class="line">Article.destroy(<span class="number">1</span>)</span><br><span class="line">Article.delete(<span class="number">1</span>)</span><br></pre></td></tr></table></figure><p>終端機操作的顯示</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.0</span><span class="number">.0</span> :<span class="number">001</span> <span class="operator">&gt;</span> a1 <span class="operator">=</span> Article.find(<span class="number">1</span>)</span><br><span class="line">  Article Load (<span class="number">0.3</span>ms)  <span class="keyword">SELECT</span> &quot;articles&quot;.<span class="operator">*</span> <span class="keyword">FROM</span> &quot;articles&quot; <span class="keyword">WHERE</span> &quot;articles&quot;.&quot;id&quot; <span class="operator">=</span> ? LIMIT ?  [[&quot;id&quot;, <span class="number">1</span>], [&quot;LIMIT&quot;, <span class="number">1</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> #<span class="operator">&lt;</span>Article id: <span class="number">1</span>, title: &quot;改回文章1&quot;, content: &quot;進入ruby世界說hello world&quot;, created_at: &quot;2022-10-03 12:41:21....</span><br><span class="line"></span><br><span class="line">3.0.0 :002 &gt; a1.destroy</span><br><span class="line">  TRANSACTION (0.1ms)  begin transaction</span><br><span class="line">  Article Destroy (0.7ms)  DELETE FROM &quot;articles&quot; WHERE &quot;articles&quot;.&quot;id&quot; = ?  [[&quot;id&quot;, 1]]</span><br><span class="line">  TRANSACTION (0.9ms)  commit transaction</span><br><span class="line"> =&gt; #&lt;Article id: 1, title: &quot;改回文章<span class="number">1</span>&quot;, content: &quot;進入ruby世界說hello world&quot;, created_at: &quot;<span class="number">2022</span><span class="number">-10</span><span class="number">-03</span> <span class="number">12</span>:<span class="number">41</span>:<span class="number">21.833091000</span> <span class="operator">+</span><span class="number">0000</span>&quot;, updated_at: &quot;<span class="number">2022</span><span class="number">-10</span><span class="number">-04</span> <span class="number">10</span>:<span class="number">21</span>:<span class="number">31.485894000</span> <span class="operator">+</span><span class="number">0000</span>&quot;&gt;</span><br><span class="line"></span><br><span class="line">3.0.0 :003 &gt; Article.delete(2)</span><br><span class="line">  Article Destroy (1.9ms)  DELETE FROM &quot;articles&quot; WHERE &quot;articles&quot;.&quot;id&quot; = ?  [[&quot;id&quot;, 2]]</span><br><span class="line"> =&gt; 1</span><br><span class="line"></span><br><span class="line">3.0.0 :009 &gt; a2 = Article.find(2)</span><br><span class="line">  Article Load (0.3ms)  SELECT &quot;articles&quot;.* FROM &quot;articles&quot; WHERE &quot;articles&quot;.&quot;id&quot; = ? LIMIT ?  [[&quot;id&quot;, 2], [&quot;LIMIT&quot;, 1]]</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">        1: from (irb):9:in `&lt;main&gt;&#x27;</span><br><span class="line">ActiveRecord::RecordNotFound (Couldn&#x27;t find Article with &#x27;id&#x27;=2)</span><br></pre></td></tr></table></figure><blockquote><p>destroy 跟 delete 的差別：</p><ul><li>destroy 方法執行的時候，會執行完整的回呼（Callback)</li><li>delete 方法直接執行 SQL 的 delete from 語法，不會進行任何回呼。</li></ul></blockquote><hr><p>參考資料：</p><ol><li><a href="https://guides.rubyonrails.org/active_record_basics.html">Rails Guide</a></li><li><a href="https://railsbook.tw/chapters/16-model-basic">為你自己學 Ruby on Rails</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>進入Rails世界必須懂：Model 相關介紹 及 CRUD (上)</title>
      <link href="/2022/10/19/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AModel-%E7%9B%B8%E9%97%9C%E4%BB%8B%E7%B4%B9-%E5%8F%8A-CRUD-%E4%B8%8A/"/>
      <url>/2022/10/19/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AModel-%E7%9B%B8%E9%97%9C%E4%BB%8B%E7%B4%B9-%E5%8F%8A-CRUD-%E4%B8%8A/</url>
      
        <content type="html"><![CDATA[<h2 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h2><p>前面的章節有提到過 Model 其實就是一個幫忙與資料庫溝通的地方，他既不是資料庫（Database）也不是資料表（Table），Model 可以當成一個抽象類別，負責跟實體的資料表溝通。</p><h2 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h2><p>先來簡單說文解字一下這四個基本的字，”CRUD”的意義吧！主要是描述下面這四個字。</p><ul><li>Create (C) 新增，建立資料，將定義好的欄位寫入對應的值</li><li>Read (R) 讀取，讀取資料，查詢資料的相關內容</li><li>Update (U) 更新，更新特定欄位的資料</li><li>Delete (D) 刪除，刪除資料</li></ul><p>我們可以透過基本的 ORM 操作來感受一下 rails 如何用到上面的這些操作資料的動作吧，操作前先簡單解釋一下相關的專有名詞，也是許多面試常常會問到的觀念。</p><h3 id="ORM？"><a href="#ORM？" class="headerlink" title="ORM？"></a>ORM？</h3><p>ORM 是 Object Relational Mapping 的縮寫，翻譯成「物件關聯對映」。如果想要存取資料庫裡的內容，在以前必須自己撰寫資料庫查詢語言（SQL）對資料庫進行查詢，但透過 ORM 的技術包裝之後，可以讓我們用操作「物件」的方式來操作資料庫。</p><h3 id="Active-Record"><a href="#Active-Record" class="headerlink" title="Active Record?"></a>Active Record?</h3><p>Active Record 是一種設計模式，MVC 中的 Model 就是根據 Active Record 的 模式設計出來的，另外一種常見的說法是 Active Record 是 ORM 的實作方式。</p><h4 id="Active-Record-的好處"><a href="#Active-Record-的好處" class="headerlink" title="Active Record 的好處"></a>Active Record 的好處</h4><ul><li>使用物件導向的方式來操作資料表</li><li>展現 Model 之間的關係</li><li>表示出相關 Model 之間的繼承關係</li><li>在存取到資料庫之前驗證資料</li></ul><h2 id="用-ORM-方式來操作-CRUD"><a href="#用-ORM-方式來操作-CRUD" class="headerlink" title="用 ORM 方式來操作 CRUD"></a>用 ORM 方式來操作 CRUD</h2><h3 id="建立-model"><a href="#建立-model" class="headerlink" title="建立 model"></a>建立 model</h3><p>我們先建立一個文章 Article 的 Model，在終端機輸入下面指令就可以建立，同時也定義 2 個欄位給他，分別是</p><ul><li>string 型態的 <code>title</code></li><li>text 型態的 <code>content</code></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g model Article title:string content:text</span><br></pre></td></tr></table></figure><p>會產生對應的資料表，我們可以在 app&#x2F;db 下面看到 migration 檔案，migration 會記錄建立 table 的經過，具備哪些欄位，我們在輸入 db:migrate 將 table 具現化，才能對裡面的內容進行操作</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">CreateArticles</span> &lt; <span class="title class_ inherited__">ActiveRecord::Migration</span>[<span class="number">6.1</span>]</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">change</span></span><br><span class="line">    create_table <span class="symbol">:articles</span> <span class="keyword">do</span> |<span class="params">t</span>|</span><br><span class="line">      t.string <span class="symbol">:title</span></span><br><span class="line">      t.text <span class="symbol">:content</span></span><br><span class="line"></span><br><span class="line">      t.timestamps</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>從上面看似乎還會有 timestamps 這個資料欄位，但其實總共還會多出 <code>id</code>、<code>timestamps</code> ，timestamps 在經過轉換之後，會產生兩個名為 created_at 跟 updated_at 的時間欄位，分別會在資料「新增」及「更新」的時候，把當下的時間寫入，可以作為一個紀錄，讓你知道某筆資料的變動。<br>id 欄位則是在 Migration 沒辦法看到任何資訊，因為這是 Rails 自動幫每個資料表加的流水編號欄位，也稱為資料表的主鍵（Primary Key）。方便讓你知道目前這個 table 建立過幾筆資料，查找上也會比較方便。</p><p>可以從下面預設的 app&#x2F;db&#x2F;development.sqlite3 的檔案看到實際所有的欄位<br><img src="https://i.imgur.com/NE0fTG8.png"></p><h3 id="Create-建立"><a href="#Create-建立" class="headerlink" title="Create 建立"></a>Create 建立</h3><p>可以從 rails console 裡面來操作實際建立一筆資料，終端機輸入 <code>rails console</code> or <code>rails c</code> 之後<br>我們可以使用 active record 提供給我們的方法</p><ol><li>create</li><li>new<br>兩者的差別是，new 完需要 save 才會存入資料庫，create 則會直接寫入。<br>我們用 create 的方式來看一下。</li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.0</span><span class="number">.0</span> :<span class="number">001</span> <span class="operator">&gt;</span> Article.create(title:&quot;文章1&quot;,content:&quot;進入ruby世界說hello world&quot;)</span><br><span class="line">   (<span class="number">0.3</span>ms)  <span class="keyword">SELECT</span> sqlite_version(<span class="operator">*</span>)</span><br><span class="line">  TRANSACTION (<span class="number">0.0</span>ms)  <span class="keyword">begin</span> transaction</span><br><span class="line">  Article <span class="keyword">Create</span> (<span class="number">0.4</span>ms)  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;articles&quot; (&quot;title&quot;, &quot;content&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) <span class="keyword">VALUES</span> (?, ?, ?, ?)  [[&quot;title&quot;, &quot;文章1&quot;], [&quot;content&quot;, &quot;進入ruby世界說hello world&quot;], [&quot;created_at&quot;, &quot;2022-10-03 12:41:21.833091&quot;], [&quot;updated_at&quot;, &quot;2022-10-03 12:41:21.833091&quot;]]</span><br><span class="line">  TRANSACTION (<span class="number">0.4</span>ms)  <span class="keyword">commit</span> transaction</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> #<span class="operator">&lt;</span>Article id: <span class="number">1</span>, title: &quot;文章1&quot;, content: &quot;進入ruby世界說hello world&quot;, created_at: &quot;2022-10-03 12:41:21.833091000 +0000&quot;, updated_at: &quot;2022-10-03 12:41:21.833091000 +0000&quot;<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure><p>可以看到上面 有出現 INSERT INTO “articles” 這個 SQL 語法，表示已經將檔案寫入資料庫</p><h3 id="Read-讀取"><a href="#Read-讀取" class="headerlink" title="Read 讀取"></a>Read 讀取</h3><p>想要取得資料表中的第一筆或最後一筆資料，可使用 <code>first</code> 或 <code>last</code> 方法，我們用 last 來讀看看</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4.3</span><span class="number">.0</span><span class="number">.0</span> :<span class="number">002</span> <span class="operator">&gt;</span> a1 <span class="operator">=</span> Article.last</span><br><span class="line">  Article Load (<span class="number">0.5</span>ms)  <span class="keyword">SELECT</span> &quot;articles&quot;.<span class="operator">*</span> <span class="keyword">FROM</span> &quot;articles&quot; <span class="keyword">ORDER</span> <span class="keyword">BY</span> &quot;articles&quot;.&quot;id&quot; <span class="keyword">DESC</span> LIMIT ?  [[&quot;LIMIT&quot;, <span class="number">1</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> #<span class="operator">&lt;</span>Article id: <span class="number">1</span>, title: &quot;文章1&quot;, content: &quot;進入ruby世界說hello world&quot;, created_at: &quot;2022-10...</span><br><span class="line"></span><br><span class="line">4.3.0.0 :003 &gt; a1</span><br><span class="line"> =&gt; #&lt;Article id: 1, title: &quot;文章<span class="number">1</span>&quot;, content: &quot;進入ruby世界說hello world&quot;, created_at: &quot;<span class="number">2022</span><span class="number">-10</span><span class="number">-03</span> <span class="number">12</span>:<span class="number">41</span>:<span class="number">21.833091000</span> <span class="operator">+</span><span class="number">0000</span>&quot;, updated_at: &quot;<span class="number">2022</span><span class="number">-10</span><span class="number">-03</span> <span class="number">12</span>:<span class="number">41</span>:<span class="number">21.833091000</span> <span class="operator">+</span><span class="number">0000</span>&quot;&gt;</span><br></pre></td></tr></table></figure><p>讀取最後一筆 (目前也只有一筆) 資料並且放入變數 a1 中，可以看到顯示出所有這筆資料的欄位及值，除了我們說的定義的欄位之外還有多出那 3 個前面提到的欄位。</p><p>我們也用一下 new 方法讓大家看一下，需要再用 save 進行資料的寫入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.0</span><span class="number">.0</span> :<span class="number">001</span> <span class="operator">&gt;</span> a2 <span class="operator">=</span> Article.new(title:&quot;文章2&quot;, content:&quot;CRUD是什麼？&quot;)</span><br><span class="line">   (<span class="number">0.6</span>ms)  <span class="keyword">SELECT</span> sqlite_version(<span class="operator">*</span>)</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> #<span class="operator">&lt;</span>Article id: nil, title: &quot;文章2&quot;, content: &quot;CRUD是什麼？&quot;, created_at: nil, updated_at: nil<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">4.3</span><span class="number">.0</span><span class="number">.0</span> :<span class="number">002</span> <span class="operator">&gt;</span> a2.save</span><br><span class="line">  TRANSACTION (<span class="number">0.2</span>ms)  <span class="keyword">begin</span> transaction</span><br><span class="line">  Article <span class="keyword">Create</span> (<span class="number">1.1</span>ms)  <span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;articles&quot; (&quot;title&quot;, &quot;content&quot;, &quot;created_at&quot;, &quot;updated_at&quot;) <span class="keyword">VALUES</span> (?, ?, ?, ?)  [[&quot;title&quot;, &quot;文章2&quot;], [&quot;content&quot;, &quot;CRUD是什麼？&quot;], [&quot;created_at&quot;, &quot;2022-10-04 09:31:49.206583&quot;], [&quot;updated_at&quot;, &quot;2022-10-04 09:31:49.206583&quot;]]</span><br><span class="line">  TRANSACTION (<span class="number">0.8</span>ms)  <span class="keyword">commit</span> transaction</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>看到 save 之後有回傳一個 true 表示有成功寫入。</p><p>也可以來用 first 抓看看我們的資料，先用 Article.all 看一下全部是有兩筆資料，然後可以用 first，也可以用 first(number)，括號內可以指定要從第一筆開始抓幾筆。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.0</span><span class="number">.0</span> :<span class="number">004</span> <span class="operator">&gt;</span> Article.all</span><br><span class="line">Article Load (<span class="number">0.5</span>ms)  <span class="keyword">SELECT</span> &quot;articles&quot;.<span class="operator">*</span> <span class="keyword">FROM</span> &quot;articles&quot; <span class="comment">/* loading for inspect */</span> LIMIT ?  [[&quot;LIMIT&quot;, <span class="number">11</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> #<span class="operator">&lt;</span>ActiveRecord::Relation [#<span class="operator">&lt;</span>Article id: <span class="number">1</span>, title: &quot;文章1&quot;, content: &quot;進入ruby世界說hello world&quot;, created_at: &quot;2022-10-03 12:41:21.833091000 +0000&quot;, updated_at: &quot;2022-10-03 12:41:21.833091000 +0000&quot;<span class="operator">&gt;</span>, #<span class="operator">&lt;</span>Article id: <span class="number">2</span>, title: &quot;文章2&quot;, content: &quot;CRUD是什麼？&quot;, created_at: &quot;2022-10-04 09:31:49.206583000 +0000&quot;, updated_at: &quot;2022-10-04 09:31:49.206583000 +0000&quot;<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">3.0</span><span class="number">.0</span> :<span class="number">004</span> <span class="operator">&gt;</span> Article.first</span><br><span class="line">  Article Load (<span class="number">0.3</span>ms)  <span class="keyword">SELECT</span> &quot;articles&quot;.<span class="operator">*</span> <span class="keyword">FROM</span> &quot;articles&quot; <span class="keyword">ORDER</span> <span class="keyword">BY</span> &quot;articles&quot;.&quot;id&quot; <span class="keyword">ASC</span> LIMIT ?  [[&quot;LIMIT&quot;, <span class="number">1</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> #<span class="operator">&lt;</span>Article id: <span class="number">1</span>, title: &quot;文章1&quot;, content: &quot;進入ruby世界說hello world&quot;, created_at: &quot;2022-10-03 12:41:21.833091000 +0000&quot;, updated_at: &quot;2022-10-03 12:41:21.833091000 +0000&quot;<span class="operator">&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="number">4.3</span><span class="number">.0</span><span class="number">.0</span> :<span class="number">005</span> <span class="operator">&gt;</span> Article.first(<span class="number">2</span>)</span><br><span class="line">  Article Load (<span class="number">0.3</span>ms)  <span class="keyword">SELECT</span> &quot;articles&quot;.<span class="operator">*</span> <span class="keyword">FROM</span> &quot;articles&quot; <span class="keyword">ORDER</span> <span class="keyword">BY</span> &quot;articles&quot;.&quot;id&quot; <span class="keyword">ASC</span> LIMIT ?  [[&quot;LIMIT&quot;, <span class="number">2</span>]]</span><br><span class="line"> <span class="operator">=</span><span class="operator">&gt;</span> [#<span class="operator">&lt;</span>Article id: <span class="number">1</span>, title: &quot;文章1&quot;, content: &quot;進入ruby世界說hello world&quot;, created_at: &quot;2022-10-03 12:41:21.833091000 +0000&quot;, updated_at: &quot;2022-10-03 12:41:21.833091000 +0000&quot;<span class="operator">&gt;</span>, #<span class="operator">&lt;</span>Article id: <span class="number">2</span>, title: &quot;文章2&quot;, content: &quot;CRUD是什麼？&quot;, created_at: &quot;2022-10-04 09:31:49</span><br></pre></td></tr></table></figure><p>下篇再來繼續說明一些讀取的方法、更新及刪除的部分。</p><p>－－－</p><p>參考資料：</p><ol><li><a href="https://guides.rubyonrails.org/active_record_basics.html">Rails Guide</a></li><li><a href="https://railsbook.tw/chapters/16-model-basic">為你自己學 Ruby on Rails</a></li><li><a href="https://en.wikipedia.org/wiki/Object%E2%80%93relational_mapping">wiki ORM</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>進入Rails世界必須懂：Controller 及 View</title>
      <link href="/2022/10/18/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AController-%E5%8F%8A-View/"/>
      <url>/2022/10/18/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AController-%E5%8F%8A-View/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>開頭先來回顧一下前面的圖片，今天來解釋一下我們 MVC 一直提到的 C (Controller) 及 C (View) 部分，前兩篇講完 routes 的部分，接著當解讀完 routes 之後就是將工作轉往 controller 及 action 的部分，將後續資料的呈現及使用者的動作做完。<br><img src="https://i.imgur.com/hf9CtBC.png"></p></div><h2 id="Controller-與-V-iew-是什麼呢？"><a href="#Controller-與-V-iew-是什麼呢？" class="headerlink" title="Controller 與 Ｖ iew 是什麼呢？"></a>Controller 與 Ｖ iew 是什麼呢？</h2><p><code>Controller</code> 是要拿來做什麼用的？ 從意思來看應該可以看到 control 這個單字，表示是要來進行一些控制的部分，主要是控制資料的流程。他可能會進行：</p><ul><li>跟 Model 要資料</li><li>把從 Model 收到的資料丟給 View</li><li>需要存取外部服務（例如金流串接）等</li></ul><p><code>View</code> 的話則是可以將 Controller 的資料呈現出來，就是一種回傳 HTML 的方法。</p><h2 id="和路徑設定的關聯"><a href="#和路徑設定的關聯" class="headerlink" title="和路徑設定的關聯"></a>和路徑設定的關聯</h2><p>前面一篇提到的文章相關路徑設計，其實我們 resources 後面符號，用複數名稱對應到的就是 controller 的名字</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  resources <span class="symbol">:articles</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>還記得路徑中有對應的 controller 及 action 吧</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>rails routes -c articles</span><br><span class="line">   Prefix    Verb   <span class="variable constant_">URI</span> Pattern                  Controller<span class="comment">#Action</span></span><br><span class="line">    articles <span class="variable constant_">GET</span>    /articles(.<span class="symbol">:format</span>)          articles<span class="comment">#index</span></span><br><span class="line">             <span class="variable constant_">POST</span>   /articles(.<span class="symbol">:format</span>)          articles<span class="comment">#create</span></span><br><span class="line"> new_article <span class="variable constant_">GET</span>    /articles/new(.<span class="symbol">:format</span>)      articles<span class="comment">#new</span></span><br><span class="line">edit_article <span class="variable constant_">GET</span>    /articles/<span class="symbol">:id/edit</span>(.<span class="symbol">:format</span>) articles<span class="comment">#edit</span></span><br><span class="line">     article <span class="variable constant_">GET</span>    /articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#show</span></span><br><span class="line">             <span class="variable constant_">PATCH</span>  /articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#update</span></span><br><span class="line">             <span class="variable constant_">PUT</span>    /articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#update</span></span><br><span class="line">             <span class="variable constant_">DELETE</span> /articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#destroy</span></span><br></pre></td></tr></table></figure><h2 id="建立-controller"><a href="#建立-controller" class="headerlink" title="建立 controller"></a>建立 controller</h2><p>可以手動建立或是在終端機請 rails 幫我們建立，可以長出相關的檔案</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate controller articles</span><br></pre></td></tr></table></figure><p>看一下檔案名稱及內部長怎麼樣吧<br><img src="https://i.imgur.com/8DOdnEX.png"></p><p>會在 <code>app/controller</code> 下面產生出相關的檔案，可以注意到 controller 名稱是叫做<code>articles_controller.rb</code>，點開檔案內部看看。</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ArticlesController</span> &lt; <span class="title class_ inherited__">ApplicationController</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>裡面是一個類別叫做 ArticlesController 並且繼承自 ApplicationController<br>可以注意到檔名跟類別名稱不同，檔名是用蛇式、類別名稱則是大駝峰。</p><h2 id="撰寫-action-對應到-view-去吧"><a href="#撰寫-action-對應到-view-去吧" class="headerlink" title="撰寫 action 對應到 view 去吧"></a>撰寫 action 對應到 view 去吧</h2><p>如果我們只有寫好路徑，到那些我們想去的位置例如 index 的位置 (&#x2F;articles) 會看到瀏覽器上面顯示錯誤訊息找不到 action</p><p><img src="https://i.imgur.com/UqPD5vf.png"></p><p>所以現在要寫個 index action 到 controller 裡面<br>同時也需要對應給個 view 的檔案讓這個 action 知道要把相關的資料控制到哪邊</p><h3 id="action-建立"><a href="#action-建立" class="headerlink" title="action 建立"></a>action 建立</h3><p>定義一個 index 的 action</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ArticlesController</span> &lt; <span class="title class_ inherited__">ApplicationController</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">index</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>回到瀏覽器會看到，錯誤訊息變成找不到 template ，這個 template 其實就是我們在 rails 中會使用的 html.erb 檔案，也就是我們說的 view</p><p><img src="https://i.imgur.com/wkIeYE8.png"></p><h3 id="view-建立"><a href="#view-建立" class="headerlink" title="view 建立"></a>view 建立</h3><p>因為需要對應 index ，所以檔名也要跟 action 一樣，就建立一個檔案命名為 <code>index.html.erb</code> ，像這種特殊的 <code>html.erb</code> 檔案 可以同時在內部寫 html 標籤 及 ruby 的語法。</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>這裡是 articles 的 index<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure><p>對應到 &#x2F;articles 頁面就會看到我們建立好的標籤及內容<br><img src="https://i.imgur.com/8GGwcZA.png"></p><h2 id="如何在-view-上面看到-controller-傳遞的參數"><a href="#如何在-view-上面看到-controller-傳遞的參數" class="headerlink" title="如何在 view 上面看到 controller 傳遞的參數"></a>如何在 view 上面看到 controller 傳遞的參數</h2><p>我們可以把 action 裡面寫上 <code>render html: params</code></p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ArticlesController</span> &lt; <span class="title class_ inherited__">ApplicationController</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">index</span></span><br><span class="line">    render <span class="symbol">html:</span> params</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>瀏覽器的 view 就可以接受到 action 的執行內容，要把 params 呈現在畫面上，就會看到這個 view 對應的 controller 還有 action 是什麼</p><p><img src="https://i.imgur.com/x1AH4FW.png"></p><p>如果在網址的後面加上 <code>?</code> 後面跟的那串東西會被當做參數傳進一個特別的變數叫做 <code>params</code>。這是 Rails 預先幫我們定義好的，它可以捕捉到這個頁面的資訊，然後你就會看到頁面顯示成這樣。</p><p><img src="https://i.imgur.com/jgGhFcf.png"></p><p>這會讓你在設計路徑時多帶入一些參數，讓這個頁面可以做使用。</p><hr><p>參考資料：</p><ol><li><a href="https://railsbook.tw/chapters/12-controllers">為你自己學 Ruby on Rails</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>進入Rails世界必須懂：Routes (下)</title>
      <link href="/2022/10/17/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9ARoutes-%E4%B8%8B/"/>
      <url>/2022/10/17/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9ARoutes-%E4%B8%8B/</url>
      
        <content type="html"><![CDATA[<p>延續前面基本的路徑設計，這篇會提到比較多種巢狀設計的方式。</p><h2 id="巢狀設計方式"><a href="#巢狀設計方式" class="headerlink" title="巢狀設計方式"></a>巢狀設計方式</h2><p>resources 方法裡面其實還可以在包 resources，在後面會提到 model 之間關連性，例如一個 User 可能會有很多 Articles，Route 可能會這樣寫：</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  resources <span class="symbol">:users</span> <span class="keyword">do</span></span><br><span class="line">    resource <span class="symbol">:articles</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>終端機輸入 $ rails routes -c articles 查詢路徑可以看到如下</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">            Prefix Verb   <span class="variable constant_">URI</span> Pattern                             Controller<span class="comment">#Action</span></span><br><span class="line"> new_user_articles <span class="variable constant_">GET</span>    /users/<span class="symbol">:user_id/articles/new</span>(.<span class="symbol">:format</span>)  articles<span class="comment">#new</span></span><br><span class="line">edit_user_articles <span class="variable constant_">GET</span>    /users/<span class="symbol">:user_id/articles/edit</span>(.<span class="symbol">:format</span>) articles<span class="comment">#edit</span></span><br><span class="line">     user_articles <span class="variable constant_">GET</span>    /users/<span class="symbol">:user_id/articles</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#show</span></span><br><span class="line">                   <span class="variable constant_">PATCH</span>  /users/<span class="symbol">:user_id/articles</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#update</span></span><br><span class="line">                   <span class="variable constant_">PUT</span>    /users/<span class="symbol">:user_id/articles</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#update</span></span><br><span class="line">                   <span class="variable constant_">DELETE</span> /users/<span class="symbol">:user_id/articles</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#destroy</span></span><br><span class="line">                   <span class="variable constant_">POST</span>   /users/<span class="symbol">:user_id/articles</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#create</span></span><br></pre></td></tr></table></figure><p>路徑內就包含特定”使用者”與”文章”之間的關係，像是：<br>&#x2F;users&#x2F;1&#x2F;articles&#x2F;new &#x3D;&gt; 使用者 1 號的空間新增文章<br>&#x2F;users&#x2F;2&#x2F;articles&#x2F;3&#x2F;edit &#x3D;&gt; 使用者 2 號的空間對 3 號文章做修改</p><p>你也可以繼續往下包 resources，但是建議是 2 層最多，在下去可能變得太冗長，像是這樣：<br>&#x2F;users&#x2F;Sean&#x2F;articles&#x2F;6&#x2F;comments&#x2F;3</p><h3 id="Shallow"><a href="#Shallow" class="headerlink" title="Shallow"></a>Shallow</h3><p>會使用到這個簡化方法主要是在一些 action 不需要用到上一層資源相關的 id 我們可以透過 <code>shallow</code> 去設計<br>像是下面這樣的狀況，要呈現留言板在文章內，index, new, create 這 3 種需要知道是針對哪篇文章進行留言或顯示所有留言，所以會要保留 article id，但是在 show, edit, update, destroy，不需要知道 article id，只要針對 comment id 就可以進行相關動作。</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">resources <span class="symbol">:articles</span> <span class="keyword">do</span></span><br><span class="line">  resources <span class="symbol">:comments</span>, <span class="symbol">only:</span> [<span class="symbol">:index</span>, <span class="symbol">:new</span>, <span class="symbol">:create</span>] <span class="comment"># 這3種 action 需要標出 article id</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">resources <span class="symbol">:comments</span>, <span class="symbol">only:</span> [<span class="symbol">:show</span>, <span class="symbol">:edit</span>, <span class="symbol">:update</span>, <span class="symbol">:destroy</span>] <span class="comment"># 這些不需要標出 article id</span></span><br></pre></td></tr></table></figure><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">             Prefix Verb   <span class="variable constant_">URI</span> Pattern                                  Controller<span class="comment">#Action</span></span><br><span class="line">   article_comments <span class="variable constant_">GET</span>    /articles/<span class="symbol">:article_id/comments</span>(.<span class="symbol">:format</span>)     comments<span class="comment">#index</span></span><br><span class="line">                    <span class="variable constant_">POST</span>   /articles/<span class="symbol">:article_id/comments</span>(.<span class="symbol">:format</span>)     comments<span class="comment">#create</span></span><br><span class="line">new_article_comment <span class="variable constant_">GET</span>    /articles/<span class="symbol">:article_id/comments/new</span>(.<span class="symbol">:format</span>) comments<span class="comment">#new</span></span><br><span class="line">       edit_comment <span class="variable constant_">GET</span>    /comments/<span class="symbol">:id/edit</span>(.<span class="symbol">:format</span>)                 comments<span class="comment">#edit</span></span><br><span class="line">            comment <span class="variable constant_">GET</span>    /comments/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)                      comments<span class="comment">#show</span></span><br><span class="line">                    <span class="variable constant_">PATCH</span>  /comments/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)                      comments<span class="comment">#update</span></span><br><span class="line">                    <span class="variable constant_">PUT</span>    /comments/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)                      comments<span class="comment">#update</span></span><br><span class="line">                    <span class="variable constant_">DELETE</span> /comments/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)                      comments<span class="comment">#destroy</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上面的寫法可以利用 shallow 來簡化如下，產生出來的路徑都是相同。</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">resources <span class="symbol">:articles</span> <span class="keyword">do</span></span><br><span class="line">  resources <span class="symbol">:comments</span>, <span class="symbol">shallow:</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="collection-與-member"><a href="#collection-與-member" class="headerlink" title="collection 與 member"></a>collection 與 member</h3><p>如果預設的路徑不夠使用，且層層包裹之中，又希望設計要或不要帶有前面一層的 id 可以這樣表示<br><code>collection</code> &#x3D;&gt; 沒有 id<br><code>member</code> &#x3D;&gt; 有 id</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  resources <span class="symbol">:friends</span> <span class="keyword">do</span></span><br><span class="line">    collection <span class="keyword">do</span></span><br><span class="line">      <span class="comment"># /friends/confirmed</span></span><br><span class="line">      get <span class="symbol">:confirmed</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    member <span class="keyword">do</span></span><br><span class="line">      <span class="comment"># /friends/:id/status</span></span><br><span class="line">      post <span class="symbol">:status</span></span><br><span class="line">      <span class="comment"># /friends/:id/</span></span><br><span class="line">      delete <span class="symbol">:destroy</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>對應路徑如下：</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">           Prefix Verb   <span class="variable constant_">URI</span> Pattern                   Controller<span class="comment">#Action</span></span><br><span class="line">confirmed_friends <span class="variable constant_">GET</span>    /friends/confirmed(.<span class="symbol">:format</span>)  friends<span class="comment">#confirmed</span></span><br><span class="line">    status_friend <span class="variable constant_">POST</span>   /friends/<span class="symbol">:id/status</span>(.<span class="symbol">:format</span>) friends<span class="comment">#status</span></span><br><span class="line">           friend <span class="variable constant_">DELETE</span> /friends/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)        friends<span class="comment">#destroy</span></span><br><span class="line">          friends <span class="variable constant_">GET</span>    /friends(.<span class="symbol">:format</span>)            friends<span class="comment">#index</span></span><br><span class="line">                  <span class="variable constant_">POST</span>   /friends(.<span class="symbol">:format</span>)            friends<span class="comment">#create</span></span><br><span class="line">       new_friend <span class="variable constant_">GET</span>    /friends/new(.<span class="symbol">:format</span>)        friends<span class="comment">#new</span></span><br><span class="line">      edit_friend <span class="variable constant_">GET</span>    /friends/<span class="symbol">:id/edit</span>(.<span class="symbol">:format</span>)   friends<span class="comment">#edit</span></span><br><span class="line">                  <span class="variable constant_">GET</span>    /friends/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)        friends<span class="comment">#show</span></span><br><span class="line">                  <span class="variable constant_">PATCH</span>  /friends/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)        friends<span class="comment">#update</span></span><br><span class="line">                  <span class="variable constant_">PUT</span>    /friends/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)        friends<span class="comment">#update</span></span><br><span class="line">                  <span class="variable constant_">DELETE</span> /friends/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)        friends<span class="comment">#destroy</span></span><br></pre></td></tr></table></figure><h3 id="namespace-與-scope"><a href="#namespace-與-scope" class="headerlink" title="namespace 與 scope"></a>namespace 與 scope</h3><p>namespace &#x3D;&gt; 會讓後面指定的資源除了加到路徑上之外也多加到 prefix 及 controller 的名稱上<br>scope &#x3D;&gt; 只有將資源加到路徑</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  namespace <span class="symbol">:users</span> <span class="keyword">do</span></span><br><span class="line">    resources <span class="symbol">:articles</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  scope <span class="symbol">:users</span> <span class="keyword">do</span></span><br><span class="line">    resources <span class="symbol">:articles</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>產生路徑如下，可以看到兩種的差異在於用 namespace 的會影響到 prefix 及 controller 的設計，如果有這樣需求的就可以這樣使用，路徑是都一樣的。</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># namespace</span></span><br><span class="line">            Prefix Verb   <span class="variable constant_">URI</span> Pattern                        Controller<span class="comment">#Action</span></span><br><span class="line">    users_articles <span class="variable constant_">GET</span>    /users/articles(.<span class="symbol">:format</span>)          users/articles<span class="comment">#index</span></span><br><span class="line">                   <span class="variable constant_">POST</span>   /users/articles(.<span class="symbol">:format</span>)          users/articles<span class="comment">#create</span></span><br><span class="line"> new_users_article <span class="variable constant_">GET</span>    /users/articles/new(.<span class="symbol">:format</span>)      users/articles<span class="comment">#new</span></span><br><span class="line">edit_users_article <span class="variable constant_">GET</span>    /users/articles/<span class="symbol">:id/edit</span>(.<span class="symbol">:format</span>) users/articles<span class="comment">#edit</span></span><br><span class="line">     users_article <span class="variable constant_">GET</span>    /users/articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      users/articles<span class="comment">#show</span></span><br><span class="line">                   <span class="variable constant_">PATCH</span>  /users/articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      users/articles<span class="comment">#update</span></span><br><span class="line">                   <span class="variable constant_">PUT</span>    /users/articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      users/articles<span class="comment">#update</span></span><br><span class="line">                   <span class="variable constant_">DELETE</span> /users/articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      users/articles<span class="comment">#destroy</span></span><br><span class="line">----------------------------------------------------------------------------------------------</span><br><span class="line"><span class="comment"># scope</span></span><br><span class="line">            Prefix Verb   <span class="variable constant_">URI</span> Pattern                        Controller<span class="comment">#Action</span></span><br><span class="line">          articles <span class="variable constant_">GET</span>    /users/articles(.<span class="symbol">:format</span>)          articles<span class="comment">#index</span></span><br><span class="line">                   <span class="variable constant_">POST</span>   /users/articles(.<span class="symbol">:format</span>)          articles<span class="comment">#create</span></span><br><span class="line">       new_article <span class="variable constant_">GET</span>    /users/articles/new(.<span class="symbol">:format</span>)      articles<span class="comment">#new</span></span><br><span class="line">      edit_article <span class="variable constant_">GET</span>    /users/articles/<span class="symbol">:id/edit</span>(.<span class="symbol">:format</span>) articles<span class="comment">#edit</span></span><br><span class="line">           article <span class="variable constant_">GET</span>    /users/articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#show</span></span><br><span class="line">                   <span class="variable constant_">PATCH</span>  /users/articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#update</span></span><br><span class="line">                   <span class="variable constant_">PUT</span>    /users/articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#update</span></span><br><span class="line">                   <span class="variable constant_">DELETE</span> /users/articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#destroy</span></span><br></pre></td></tr></table></figure><hr><p>參考資料：</p><ol><li><a href="https://railsbook.tw/chapters/11-routes">為你自己學 Ruby on Rails</a></li><li><a href="https://rails.ruby.tw/routing.html">Rails Guide</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>進入Rails世界必須懂：Routes (上)</title>
      <link href="/2022/10/14/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9ARoutes-%E4%B8%8A/"/>
      <url>/2022/10/14/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9ARoutes-%E4%B8%8A/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>前面 MVC 中德概念有提到 Restful Routes 設計很重要，今天就來簡單講一下基本的路徑 Routes 設定吧！</p></div><h2 id="路徑設定位置"><a href="#路徑設定位置" class="headerlink" title="路徑設定位置"></a>路徑設定位置</h2><p>通常我們會在 config&#x2F;routes.rb 的檔案裡面進行路徑的設定：</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  get <span class="string">&quot;/&quot;</span>, <span class="symbol">to:</span> <span class="string">&quot;pages#index&quot;</span> ＃去首頁</span><br><span class="line">  get <span class="string">&quot;/about&quot;</span>, <span class="symbol">to:</span> <span class="string">&quot;pages#about&quot;</span> ＃去關於我們的頁面</span><br><span class="line">  ＃ 動作 “路徑”, <span class="symbol">to:</span> <span class="string">&quot;controller#action&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>一般設定就如上面這樣，會先指定動作，再來是要去的路徑，接著是對應的 controller，”＃”後面是 controller 上面的 action。</p><h2 id="用-resources-產生的-Routes"><a href="#用-resources-產生的-Routes" class="headerlink" title="用 resources 產生的 Routes"></a>用 resources 產生的 Routes</h2><p>這邊可以感受到慣例優於設定的一個小地方，使用 Rails 提供的 resources 方法非常方便，可以自動產生出對應的 8 條路徑、7 種 action，可以應付一般 restful routes 設計</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  resources <span class="symbol">:articles</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>可以開啟終端機輸入 <code>rails routes -c articles</code><br>就會看到對應出來下面的這些路徑</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>rails routes -c articles</span><br><span class="line">   Prefix    Verb   <span class="variable constant_">URI</span> Pattern                  Controller<span class="comment">#Action</span></span><br><span class="line">    articles <span class="variable constant_">GET</span>    /articles(.<span class="symbol">:format</span>)          articles<span class="comment">#index</span></span><br><span class="line">             <span class="variable constant_">POST</span>   /articles(.<span class="symbol">:format</span>)          articles<span class="comment">#create</span></span><br><span class="line"> new_article <span class="variable constant_">GET</span>    /articles/new(.<span class="symbol">:format</span>)      articles<span class="comment">#new</span></span><br><span class="line">edit_article <span class="variable constant_">GET</span>    /articles/<span class="symbol">:id/edit</span>(.<span class="symbol">:format</span>) articles<span class="comment">#edit</span></span><br><span class="line">     article <span class="variable constant_">GET</span>    /articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#show</span></span><br><span class="line">             <span class="variable constant_">PATCH</span>  /articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#update</span></span><br><span class="line">             <span class="variable constant_">PUT</span>    /articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#update</span></span><br><span class="line">             <span class="variable constant_">DELETE</span> /articles/<span class="symbol">:id</span>(.<span class="symbol">:format</span>)      articles<span class="comment">#destroy</span></span><br></pre></td></tr></table></figure><p>可以注意到我們這些路徑預設的 action 都是有意義的，一般來說會如下面的設計：</p><ul><li>index &#x3D;&gt; get，首頁或列表頁，通常會是呈現所有資料的頁面，以文章來說可能就像是部落格的文章列表，或是一些論壇的文章列表頁</li><li>create &#x3D;&gt; post，為新增文章的位置，不會看到畫面，但是用 post 動作更新資料</li><li>new &#x3D;&gt; get，為新增的表單頁面，填入跟文章相關的資料，按下送出就會觸發 create</li><li>edit &#x3D;&gt; get，為編輯的表單頁面</li><li>show &#x3D;&gt; get，為顯示文章內容的頁面</li><li>update &#x3D;&gt; patch and put，為更新的位置，不會看到畫面，用 patch 或 put (對瀏覽器來說同樣為 post)</li><li>destroy ＝&gt; delete，為刪除文章的位置，同樣不看到畫面，用 delete 方法 (同樣為 post 的一種)</li></ul><h3 id="prefix-是？"><a href="#prefix-是？" class="headerlink" title="prefix 是？"></a>prefix 是？</h3><p>後面可以接上 <code>_path</code> 或 <code>_url</code> 後變成「相對應的路徑或網址」的 View Helper（幫忙 view 呈現資料的方法）。如果是站內連結，通常會使用 _path 寫法來產生站內的路徑，例如：</p><p>articles + path &#x3D; articles_path &#x3D;&gt; &#x2F;articles<br>new_article + path &#x3D; new_article_path &#x3D;&gt; &#x2F;articles&#x2F;new<br>edit_article + path &#x3D; edit_article_path(5) &#x3D;&gt; &#x2F;articles&#x2F;5&#x2F;edit</p><p>如果是使用 _url 則會產生完整的路徑，包括主機網域名稱：</p><p>articles + url &#x3D; articles_url &#x3D;&gt; <a href="http://sean_blog.com/articles">http://sean_blog.com/articles</a><br>new_article + url &#x3D; new_article_url &#x3D;&gt; <a href="http://sean_blog.com/articles/new">http://sean_blog.com/articles/new</a><br>edit_article + url &#x3D; edit_article_url(5) &#x3D;&gt; <a href="http://sean_blog.com/articles/5/edit">http://sean_blog.com/articles/5/edit</a></p><h3 id="如果用不到那麼多種方法"><a href="#如果用不到那麼多種方法" class="headerlink" title="如果用不到那麼多種方法"></a>如果用不到那麼多種方法</h3><p>假設我們只需要用到 index 跟 show 呢?<br>可以使用 <code>only</code> 或 <code>except</code> ，only 是正向表示，表示內有的方法都要; except 反向表示除了提到的方法之外都要</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  resources <span class="symbol">:articles</span>, <span class="symbol">only:</span>[<span class="symbol">:index</span>, <span class="symbol">:show</span>]</span><br><span class="line">  resources <span class="symbol">:articles</span>, <span class="symbol">except:</span>[<span class="symbol">:new</span>, <span class="symbol">:create</span>, <span class="symbol">:edit</span>, <span class="symbol">:update</span>, <span class="symbol">:destroy</span>]</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="resource-用單數會"><a href="#resource-用單數會" class="headerlink" title="resource 用單數會?"></a>resource 用單數會?</h3><p>如果用單數<code>resource</code>方法會<strong>產生沒有 id 的路徑</strong>，如果沒有要表示特定文章路徑就可以用這樣去產生，然後可以搭配 only 或 except 去選出那些路徑要用。</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Rails.application.routes.draw <span class="keyword">do</span></span><br><span class="line">  resource <span class="symbol">:articles</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>rails routes -c articles</span><br><span class="line">      Prefix Verb   <span class="variable constant_">URI</span> Pattern              Controller<span class="comment">#Action</span></span><br><span class="line"> new_articles <span class="variable constant_">GET</span>    /articles/new(.<span class="symbol">:format</span>)  articles<span class="comment">#new</span></span><br><span class="line">edit_articles <span class="variable constant_">GET</span>    /articles/edit(.<span class="symbol">:format</span>) articles<span class="comment">#edit</span></span><br><span class="line">     articles <span class="variable constant_">GET</span>    /articles(.<span class="symbol">:format</span>)      articles<span class="comment">#show</span></span><br><span class="line">              <span class="variable constant_">PATCH</span>  /articles(.<span class="symbol">:format</span>)      articles<span class="comment">#update</span></span><br><span class="line">              <span class="variable constant_">PUT</span>    /articles(.<span class="symbol">:format</span>)      articles<span class="comment">#update</span></span><br><span class="line">              <span class="variable constant_">DELETE</span> /articles(.<span class="symbol">:format</span>)      articles<span class="comment">#destroy</span></span><br><span class="line">              <span class="variable constant_">POST</span>   /articles(.<span class="symbol">:format</span>)      articles<span class="comment">#create</span></span><br></pre></td></tr></table></figure><p>下一篇再提供多一些關於路徑的設定部分給大家。</p><hr><p>參考資料：</p><ol><li><a href="https://railsbook.tw/chapters/11-routes">為你自己學 Ruby on Rails</a></li><li><a href="https://rails.ruby.tw/routing.html">Rails Guide</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>進入Rails世界必須懂：MVC 是甚麼?</title>
      <link href="/2022/10/13/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AMVC%20%E6%98%AF%E7%94%9A%E9%BA%BC/"/>
      <url>/2022/10/13/Rails/%E9%80%B2%E5%85%A5Rails%E4%B8%96%E7%95%8C%E5%BF%85%E9%A0%88%E6%87%82%EF%BC%9AMVC%20%E6%98%AF%E7%94%9A%E9%BA%BC/</url>
      
        <content type="html"><![CDATA[<p>最近開始進行一些面試，真的深刻感受到這個問題的重要，算是寫 rails 根本的概念了吧，應該有接觸後端框架或是網業開發必備的設計概念，今天也被面試官問到，如果要跟沒程式經驗的小白解釋的話要怎麼說明，所以就打算用個淺顯易懂的方式來說明觀念吧!!</p><h2 id="白話文來解釋-MVC"><a href="#白話文來解釋-MVC" class="headerlink" title="白話文來解釋 MVC"></a>白話文來解釋 MVC</h2><p>最近大家好像都開始蠢蠢動，因為防疫限制的鬆綁所以紛紛開始出國，就拿我們辦個護照的例子來說明好啦。<br>先想像一下，今天你走進去外交部領事事務局，因為初來乍到所以不熟悉這邊的行政單位在哪，就找了一樓<code>服務台的阿姨</code>問了一下辦理護照需要去哪邊?</p><p>阿姨告訴你說請到 <code>3 樓</code>的<code>申辦櫃台</code>去進行辦理，於是你走到 3 樓，找到櫃檯跟他說你要辦理護照，他請你填寫一些基本資料，並且附上對應的照片等等，然後就幫你把你的資料送到收件的地方並且<code>核對你的資料</code>，後續根據你的相關紀錄，確認都有符合辦理的條件後，就把製作好的<code>護照</code>交給你手上。</p><p>其實剛剛很生活的例子就完全解釋了我們整個 mvc 的運作架構，接下來一一說明一下吧。</p><h2 id="白話之後也對應網頁運作"><a href="#白話之後也對應網頁運作" class="headerlink" title="白話之後也對應網頁運作"></a>白話之後也對應網頁運作</h2><p>上邊特別標註的一些名詞其實都是對應我們 MVC 的一些概念喔，像是服務台阿姨其實扮演著 <code>Route</code> 的角色，就是表示當使用者點下或輸入特定網址，Route 就告訴你的瀏覽器要把你導向甚麼位置，這個位置是 3 樓，也就是 <code>Controller</code> 的部分，Controller 上面會帶有很多 <code>Action</code>，每個都是一種特殊的方法，可以表示不同行政的櫃檯 (有辦護照、申請移民、申請居留等等)，把你的資料透過 Action 送到收件處，就是 <code>Model</code> 去進行比對，幫你跟資料庫進行溝通，透過 SQL 語法和資料庫溝通，資料庫確定你的身分，也比對過後沒問題，就找到對應的資料放到護照上交還給辦理櫃檯，然後再交到你手上，護照就是表示需要呈現的資料，也就是把資料放到瀏覽器上面呈現給你看到，等於就是透過 Controller 的 Action 交給 View 去呈現，View 可以想像就是你看到完整受到核可的護照摟。</p><p>完整的流程應該會是 R + MVC，前面的 R 就是 Route</p><p>Route：負責指引你要瀏覽的位置及進行的動作<br>Model：負責與資料庫溝通、將我們的指令轉換成 SQL 語法，處理資料邏輯。<br>Views：負責畫面呈現。(專業的說法是表示回傳 HTML 的方法)<br>Controller：負責處理傳進來的資料流向、流程控制。</p><h2 id="為什麼使用-MVC"><a href="#為什麼使用-MVC" class="headerlink" title="為什麼使用 MVC?"></a>為什麼使用 MVC?</h2><p>MVC 的目的就是<strong>分工</strong>，使用 MVC 架構的好處，在於這三者彼此獨立、各司其職，方便團隊進行開發，使程式碼更易於維護，「把不同意義的程式碼放在不同的檔案裡」。如果需要前後端分離，後端工程師可以專注於 Controller 及 Model 的部分，View 相關呈現就可以交給前端工程師去處理。</p><p>附上我之前課程上畫的醜醜圖片來幫大家簡單釐清概念<br><img src="https://i.imgur.com/hf9CtBC.png"></p><hr><p>參考資料：</p><ol><li><a href="https://railsbook.tw/chapters/10-mvc">為你自己學 Ruby on Rails</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Rails </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>掌握Ruby世界就要先懂：模組 Module</title>
      <link href="/2022/10/12/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E6%A8%A1%E7%B5%84-Module/"/>
      <url>/2022/10/12/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E6%A8%A1%E7%B5%84-Module/</url>
      
        <content type="html"><![CDATA[<p>這篇就來好好了解一下 Ruby 中的模組吧，先來用個我最愛的超級英雄蜘蛛人當成例子<br>以前面人類類別的例子，我希望他可以有吐絲的能力來當蜘蛛人，可能會想用以下這些做法：</p><ol><li>建立一個蜘蛛類別並且帶有吐絲功能，然後再叫人類類別去繼承</li><li>在人類類別裡面定義一個吐絲功能</li></ol><p>第 1 種的方式感覺在邏輯上比較奇怪，人為了吐絲就要去繼承蜘蛛，感覺就跟原本設定的類別有點衝突；第 2 種是直接寫在內部確實也可以達到同樣效果，但如果其他類別也需要用到這項能力就要另外在寫，沒辦法抽出來共用。</p><p>如果我們能夠把這些超級能力抽出來，需要使用再引入，不是很好嗎?<br>於是就有了模組的概念可以來解決這樣的狀況!</p><h2 id="模組定義與使用"><a href="#模組定義與使用" class="headerlink" title="模組定義與使用"></a>模組定義與使用</h2><p>module 後面接上模組名稱，命名規則與 class 相同，使用駝峰大寫，下面就可以定義內部要有的方法。<br>如果在其他類別內要引用就使用 <code>include</code>。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 定義吐司模組</span></span><br><span class="line"><span class="keyword">module</span> spinning</span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">spin</span></span><br><span class="line">    puts <span class="string">&quot;我會吐絲啦!&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 引入模組到人類類別</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span></span><br><span class="line">  <span class="keyword">include</span> spinning <span class="comment"># 引入吐絲模組</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Sean = Human.new</span><br><span class="line">Sean.spinning <span class="comment"># 我會吐絲啦!</span></span><br></pre></td></tr></table></figure><p>在類別中引入模組就可以讓新建立的實體 Sean 直接可以使用模組內的方法了。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span></span><br><span class="line">  <span class="keyword">include</span> spinning</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>如果建立一個狗類別也想要使用只要引入他也可以有這項能力。</p><h2 id="類別和模組的差別"><a href="#類別和模組的差別" class="headerlink" title="類別和模組的差別?"></a>類別和模組的差別?</h2><p>在 Ruby 裡，<strong>「類別」的上層類別就是「模組」</strong>。<br>可以進入 irb 透過 supercalss 來看到 Class 的上層就是 Module</p><figure class="highlight irb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">3.1.2 :001 &gt;</span> Class.superclass</span><br><span class="line"> =&gt; Module</span><br></pre></td></tr></table></figure><p>比較兩者的差異：<br>在 irb 中類別及模組後面加上.instance_methods，就可以查到所有內部具有的實體方法，將兩者相減可以知道差異</p><figure class="highlight irb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">3.1.2 :002 &gt;</span> Class.instance_methods - Module.instance_methods</span><br><span class="line"> =&gt; [<span class="symbol">:allocate</span>, <span class="symbol">:superclass</span>, <span class="symbol">:subclasses</span>, <span class="symbol">:new</span>]</span><br></pre></td></tr></table></figure><p>下層的 Class 類別，比 Module 類別多了 4 個方法，其中 allocate 及 new 造就以下的差異：</p><ul><li>模組沒辦法 new 一個新的實體出來 (new)。</li><li>模組沒辦法繼承別的模組 (allocate)。</li></ul><h2 id="如何選擇用類別繼承還是模組？"><a href="#如何選擇用類別繼承還是模組？" class="headerlink" title="如何選擇用類別繼承還是模組？"></a>如何選擇用類別繼承還是模組？</h2><p>如果你發現你要使用功能，可能在很多不同體系的類別裡都會用得到，那你可以考慮把功能寫在模組裡，需要的時候再 include 進來。</p><hr><ol><li><a href="https://railsbook.tw/chapters/08-ruby-basic-4">為你自己學 Ruby on Rails</a></li><li><a href="https://pjchender.dev/ruby-on-rails/ruby-object/">[Ruby] 物件（object）、類別（class）和模組（module）</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>掌握Ruby世界就要先懂：類別 Class</title>
      <link href="/2022/10/09/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E9%A1%9E%E5%88%A5-Class/"/>
      <url>/2022/10/09/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E9%A1%9E%E5%88%A5-Class/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>上一篇文章簡單介紹物件導向 (OOP) 的設計模式，也稍微開個頭提到 Ruby 中的物件部分，有提到這句話：<strong>「Ruby 中的物件(Object)是一個類別(Class)所製造出來的實體(Instance)。」</strong>，也舉了例子表示物件由類別所產生出來。可以把類別想像成模具，而物件就是透過模具所刻印出來的實體。今天就來好好說明這個例子要表達的概念是甚麼，而類別又是甚麼吧。</p></div><h2 id="類別-Class"><a href="#類別-Class" class="headerlink" title="類別 Class"></a>類別 Class</h2><p>類別中可以放置很多方法跟屬性，大家應該從前面對於物件導向的介紹中有看到，這些都寫在類別中。開始寫 rails 之後更是會注意到 Model 及 Controller 都是由 class 構築而成，且繼承自更上層的類別，這部分後面進入到 rails 的介紹會再有更多的說明。</p><h3 id="定義類別"><a href="#定義類別" class="headerlink" title="定義類別"></a>定義類別</h3><p>慣例上來說 class 會以大駝峰的方式來命名（CamelCase），例如 SayHello、PostsController、User。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> 類別的名字</span><br><span class="line">  <span class="comment">#...</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">food</span>)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;food&#125;</span> 也太好吃了吧!!&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Human類別中定義一個eat方法，可以代入food作為參數</span></span><br><span class="line"></span><br><span class="line">Sean = <span class="title class_">Human</span>.new <span class="comment"># 建立實體</span></span><br><span class="line">Sean.eat <span class="string">&quot;咖哩&quot;</span>  <span class="comment">#=&gt; 印出「咖哩也太好吃了吧!!」</span></span><br><span class="line"></span><br><span class="line">Rex = Human.new</span><br><span class="line">Rex.eat <span class="string">&quot;麥當勞&quot;</span>  <span class="comment">#=&gt; 印出「麥當勞也太好吃了吧!!」</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用 Human 類別建立出 Sean 和 Rex 的實體，因為這兩個實體都是從 Human 中產生，所以都可以使用 eat 的方法</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="初始化-initialize"><a href="#初始化-initialize" class="headerlink" title="初始化 (initialize)"></a>初始化 (initialize)</h3><p>在使用 new 方法製作實體的時候，也可以順便傳參數進去，讓實體一建立就帶有相關的參數。</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">name, gender</span>)</span><br><span class="line">    <span class="variable">@name</span> = name</span><br><span class="line">    <span class="variable">@gender</span> = gender</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">say_hello</span></span><br><span class="line">    puts <span class="string">&quot;hello, my name is <span class="subst">#&#123;<span class="variable">@name</span>&#125;</span>&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Sean = <span class="title class_">Human</span>.new(<span class="string">&quot;Sean&quot;</span>, <span class="string">&quot;male&quot;</span>)</span><br><span class="line">Sean.say_hello    <span class="comment"># =&gt; hello, my name is Sean</span></span><br></pre></td></tr></table></figure><p>如果要透過 new 方法傳參數進來，在類別裡面必須有個名為 initialize 的方法來接收傳進來的參數。在 initialize 方法裡，常見的手法是會把參數傳進來給內部的實體變數（instance variable）。</p><h3 id="實體變數-instance-variable"><a href="#實體變數-instance-variable" class="headerlink" title="實體變數 instance variable"></a>實體變數 instance variable</h3><p>類別內會建立實體，就會使用到實體變數，用 @ 開頭的變數，<strong>是活在每個實體裡的變數，而且每個實體之間互不相影響。</strong><br>在 Rails 專案中，實體變數應用到的頻率很高，最常用的地方應該是 Controller 與 View 之間，會透過實體變數去進行傳遞資料。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UsersController</span> &lt; <span class="title class_ inherited__">ApplicationController</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">index</span></span><br><span class="line">    <span class="variable">@users</span> = User.all <span class="comment"># 取得所有的user的資料，並放入<span class="doctag">@user</span>這個實體變數</span></span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="實體方法-instance-method"><a href="#實體方法-instance-method" class="headerlink" title="實體方法 (instance method)"></a>實體方法 (instance method)</h3><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">food</span>)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;food&#125;</span> 也太好吃了吧!!&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="類別方法-class-method"><a href="#類別方法-class-method" class="headerlink" title="類別方法 (class method)"></a>類別方法 (class method)</h3><p>以前面使用過的 user controller 的例子來看</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UsersController</span> &lt; <span class="title class_ inherited__">ApplicationController</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">index</span></span><br><span class="line">    <span class="variable">@users</span> = User.all    <span class="comment"># 取得所有的user的資料，並放入<span class="doctag">@user</span>這個實體變數</span></span><br><span class="line">  <span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>這裡的 all 方法是直接作用在 User 這個「類別」上，就稱為類別方法。在 Ruby 要定義類別方法有幾種寫法，其中一種比較簡單的，就是在前面加上 self：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">self</span>.all</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>這樣就可以直接用 Human.all 的方式呼叫方法。下面是另一種寫法：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span></span><br><span class="line">  <span class="keyword">class</span> &lt;&lt; <span class="variable language_">self</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">all</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>這樣的寫法跟前面的一樣，但這樣就不需要特別在方法前面加上 self。當一個類別裡面有很多類別方法的時候，可以選擇這樣的寫法。</p><h3 id="實體方法與類別方法比較"><a href="#實體方法與類別方法比較" class="headerlink" title="實體方法與類別方法比較"></a>實體方法與類別方法比較</h3><p>實體方法與類別方法的差異為作用的對象不同，實體方法是作用在實體上，而類別方法是作用在類別上。在 Ruby 中定義的方式也不同，定義類別方法則需要以 <code>self</code> 開頭或使用 <code>class &lt;&lt; self</code> 裡面再定義方法，而實體方法則不用。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">initialize</span>(<span class="params">name</span>)</span><br><span class="line">    <span class="variable">@name</span> = name</span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">my_name</span></span><br><span class="line">    puts <span class="string">&quot;I&#x27;m <span class="subst">#&#123;<span class="variable">@name</span>&#125;</span>.&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">self</span>.say_hi</span><br><span class="line">    puts <span class="string">&quot;hi 我是類別方法&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">Sean = <span class="title class_">Human</span>.new(<span class="string">&#x27;Sean&#x27;</span>)</span><br><span class="line">麥克 = <span class="title class_">Human</span>.new(<span class="string">&#x27;麥克&#x27;</span>)</span><br><span class="line"></span><br><span class="line">＃實體方法 instance method</span><br><span class="line">Sean.my_name <span class="comment"># =&gt; I&#x27;m Sean.</span></span><br><span class="line">麥克.my_name <span class="comment"># =&gt; I&#x27;m 麥克.</span></span><br><span class="line">Human.my_name <span class="comment"># =&gt; 出錯（NoMethodError）</span></span><br><span class="line"></span><br><span class="line">＃類別方法 <span class="keyword">class</span> method</span><br><span class="line">Human.say_hi <span class="comment"># =&gt; hi 我是類別方法</span></span><br><span class="line">Sean.say_hi <span class="comment"># =&gt; 出錯（NoMethodError），實體沒辦法使用</span></span><br><span class="line">麥克.say_hi <span class="comment"># =&gt; 出錯（NoMethodError），實體沒辦法使用</span></span><br></pre></td></tr></table></figure><h3 id="方法的類型與作用範圍"><a href="#方法的類型與作用範圍" class="headerlink" title="方法的類型與作用範圍"></a>方法的類型與作用範圍</h3><p>OOP 中的概念有提到一項是封裝的概念，主要可以利用一些私有方法來保護所定義的實體方法</p><ul><li>public: 就是所有區域都可以直接存取。</li><li>private: 是只有在類別內部才可以存取。</li><li>protected: 介於上述這兩者之間，比 private 寬鬆一些，但又沒有 public 那麼自由，protected 在同一個類別內，或是繼承它的子類別可以自由取用，且可以有 recevier。</li></ul><p>比較：</p><blockquote><p>三種方法都可以在 class 內部被呼叫。<br>只有 public 方法能在外部被呼叫。<br>在內部呼叫 private 方法的時候不能夠有 receiver，而 protected 方法則沒有這種限制。</p></blockquote><h3 id="繼承（inheritance）"><a href="#繼承（inheritance）" class="headerlink" title="繼承（inheritance）"></a>繼承（inheritance）</h3><p>上面都提到單一類別，如果除了人類類別外還想要再加入一個小狗類別呢?，而且都有相同的方法，我們可以利用繼承的設計，可以把程式碼整理更簡單，且不會寫出一堆重複的程式碼。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">food</span>)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;food&#125;</span> 也太好吃了吧!!&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">food</span>)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;food&#125;</span> 也太好吃了吧!!&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>在這個例子，不管是 Human 或 Dog 類別都有定義了 eat 方法，在物件導向的概念裡，如果這些類別的用途是同一型的（例如 Human 跟 Dog 都算動物），通常會把相同功能的方法移到「上一層」的類別裡，然後再去繼承它。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">eat</span>(<span class="params">food</span>)</span><br><span class="line">    puts <span class="string">&quot;<span class="subst">#&#123;food&#125;</span> 也太好吃了吧!!&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span> &lt; <span class="title class_ inherited__">Animal</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dog</span> &lt; <span class="title class_ inherited__">Animal</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>創造出 Animal 類別，然後讓 Human 跟 Dog 都去繼承它，應用小於符號 &lt; 就是「繼承」。可以代表「Human 是一種 Animal， Dog 也是一種 Animal」。</p><p>類別的部分觀念真的比較複雜，還有許多觀念後續如果有更多時間會再慢慢補充給大家。</p><hr><p>參考資料：</p><ol><li><a href="https://railsbook.tw/chapters/08-ruby-basic-4">為你自己學 Ruby on Rails</a></li><li><a href="https://pjchender.dev/ruby-on-rails/ruby-object/#%E7%B9%BC%E6%89%BFinheritance">[Ruby] 物件（object）、類別（class）和模組（module）</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>掌握Ruby世界就要先懂：物件導向</title>
      <link href="/2022/09/26/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91/"/>
      <url>/2022/09/26/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>相信大家學習程式的道路上應該會多多少少都會碰到物件導向這個專有名詞，Ruby 這個語言也具有這樣的特性，今天就先為大家來簡單說明一下這個概念吧!!</p></div><h2 id="物件導向基本概念、"><a href="#物件導向基本概念、" class="headerlink" title="物件導向基本概念、"></a>物件導向基本概念、</h2><p>物件導向主要裡面包含了 4 大主要概念，<code>抽象化</code>、<code>封裝</code>、<code>繼承</code>、<code>多型</code></p><h3 id="抽象化-Abstraction"><a href="#抽象化-Abstraction" class="headerlink" title="抽象化(Abstraction):"></a>抽象化(Abstraction):</h3><blockquote><p>把真實世界的事物，轉化成物件的概念。把物件相關的資料抽取出來，定義成為物件的屬性(attributes) 以及方法 (methods)。</p></blockquote><p>想像成你要創造一個電腦物件，他具有可以記錄筆記、上網、玩遊戲等等的功能，把這樣的概念轉化成程式碼中，就是所謂的抽象化。可能可以用更具體的軟體功能舉例，你設計使用者，他有帳號密碼，可以建立文章、設定頭貼、加好友….等等，這一串分析你身旁某個東西的特性或外觀時，就是抽象化的動作。</p><h3 id="封裝-Encapsulation"><a href="#封裝-Encapsulation" class="headerlink" title="封裝(Encapsulation):"></a>封裝(Encapsulation):</h3><blockquote><p>封裝就是要讓使用者可以使用這個物件，但不讓使用者知道內部的邏輯。</p></blockquote><p>在 Ruby 可以對變數及方法來進行封裝：</p><ul><li>封裝變數：實體變數(@variable)及類別變數(@@viable)就是封裝在類別內部，類別外部是無法使用。</li><li>封裝方法：像是 private 或是 protected 可以把方法包起來，變成私有方法。</li></ul><h3 id="繼承-Inheritance"><a href="#繼承-Inheritance" class="headerlink" title="繼承(Inheritance):"></a>繼承(Inheritance):</h3><blockquote><p>繼承是子類別(subclass)會繼承父類別(superclass)的屬性和方法。</p></blockquote><p>想像成，像是我會滑滑板，我的小孩繼承我也學會滑滑板。</p><p>在 Ruby 中要使用繼承是用 &lt; 這個符號。<br>如果父層跟子層都有同樣的方法時，想要使用子層的方法可以在子層的方法內加上 super，<br>就可以覆蓋掉父層的方法。</p><h3 id="多型-Polymorphism"><a href="#多型-Polymorphism" class="headerlink" title="多型(Polymorphism):"></a>多型(Polymorphism):</h3><blockquote><p>定義具有不同功能但是名稱完全相同的方法或屬性的類別。<br>想像狗和貓都有「叫」的方法，但是呼叫狗的「叫」方法，狗會”旺旺”叫；呼叫貓的「叫」，貓則會”喵喵”叫。</p></blockquote><h2 id="物件概念"><a href="#物件概念" class="headerlink" title="物件概念"></a>物件概念</h2><p>物件（object） &#x3D; 狀態（state） + 行為（behavior）</p><p>可以把上面的概念套用在現實生活中，看到的動植物、人、工具、物品，都可通稱為之物件（Object）。物件會有狀態跟行為，例如狗是「黑色」、「短毛」、「年紀 3 歲」等狀態，可以進行「吃飯」、「睡覺」、「走路」等行為。</p><h2 id="Ruby-中的物件"><a href="#Ruby-中的物件" class="headerlink" title="Ruby 中的物件?"></a>Ruby 中的物件?</h2><p>Ruby 是一款物件化相當徹底的程式語言，之前的章節有提到過，在 Ruby 的世界，你看得到的所有東西幾乎都是物件，數字、字串、陣列、雜湊 等等都是一種物件。</p><p><code>Ruby中的物件(Object)是一個類別(Class)所製造出來的實體(Instance)。</code><br>物件由類別所產生出來。把類別想像成模具，而物件就是透過模具所刻印出來的實體。<br>舉例來說，可以想像一個雞蛋糕(instance)，是透過模具(class)</p><p>從同一個類別所產生出來的物件，均為各個獨立的物件，有著不同的屬性(state&#x2F;attribute)或行為(behavior&#x2F;method)，也是各個不同的實體(instance)。</p><hr><p>參考資料：</p><ol><li><a href="https://medium.com/change-or-die/ruby-%E7%89%A9%E4%BB%B6%E5%B0%8E%E5%90%91%E7%A8%8B%E5%BC%8F%E8%AA%9E%E8%A8%80-object-oriented-programming-32034e77ac2c">Ruby 物件導向程式語言(Object Oriented Programming)</a></li><li><a href="https://www.spreered.com/ruby-object-model-1/">Ruby 的繼承鍊 (1) - 如何實踐物件導向</a></li><li><a href="https://ithelp.ithome.com.tw/articles/10277001">Ruby 封裝 vs 繼承</a></li><li><a href="https://zh.wikipedia.org/zh-tw/%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1">Wiki - 物件導向程式設計</a></li><li><a href="https://railsbook.tw/chapters/08-ruby-basic-4#class">為你自己學 Ruby on Rails</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
            <tag> 物件導向 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rails 套件操作指南，Devise (helper使用、新增欄位及驗證、i18n)</title>
      <link href="/2022/08/28/Rails/Rails%E5%A5%97%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97%EF%BC%8CDevise%20(helper%E4%BD%BF%E7%94%A8%E3%80%81%E6%96%B0%E5%A2%9E%E6%AC%84%E4%BD%8D%E5%8F%8A%E9%A9%97%E8%AD%89%E3%80%81i18n)/"/>
      <url>/2022/08/28/Rails/Rails%E5%A5%97%E4%BB%B6%E6%93%8D%E4%BD%9C%E6%8C%87%E5%8D%97%EF%BC%8CDevise%20(helper%E4%BD%BF%E7%94%A8%E3%80%81%E6%96%B0%E5%A2%9E%E6%AC%84%E4%BD%8D%E5%8F%8A%E9%A9%97%E8%AD%89%E3%80%81i18n)/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>基本會員註冊登入沒問題後，剛開始大家可能會想先處理的，就是註冊的一些欄位新增與資料要寫入資料庫會碰到問題，以及個別通知訊息及標籤的 i18n 中文化等等，所以本篇會簡單提到關於 i18n 這個套件搭配 Devise 的用法</p></div><h2 id="產生-controller"><a href="#產生-controller" class="headerlink" title="產生 controller"></a>產生 controller</h2><p>套件有指令可以幫忙生出對應的 controller，如果前面建立的 model 是 User 且也是放在 devise 之下，用以下的指令並且 [scope] 改為 users，可以產生對應的 controller，每個 controller 內容有許多註解為提示這些 controller 是對應那些功能相關</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails g devise:controllers [scope]</span><br></pre></td></tr></table></figure><p><img src="https://i.imgur.com/oB3cXYa.png"></p><ul><li>也可以針對特定目標產生相關的 controller</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate devise:controllers [scope] -c=[controller&#x27;s name]</span><br></pre></td></tr></table></figure><p>注意有提示訊息提醒要確認在 routes.rb 中設定正確路徑</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如果同上用 rails g devise:controllers user</span></span><br><span class="line"><span class="comment"># 想要用上其中的 sessions controller</span></span><br><span class="line">devise_for <span class="symbol">:users</span>, <span class="symbol">controllers:</span> &#123; <span class="symbol">sessions:</span> <span class="string">&quot;users/sessions&quot;</span> &#125;</span><br></pre></td></tr></table></figure><h2 id="Controller-filters-和-helper-使用"><a href="#Controller-filters-和-helper-使用" class="headerlink" title="Controller filters 和 helper 使用"></a>Controller filters 和 helper 使用</h2><p>Devise 提供許多好用的 helper 方法，可以讓你套用在專案中。</p><h3 id="controller-filter"><a href="#controller-filter" class="headerlink" title="controller filter"></a>controller filter</h3><p>在 controller 內可以設定 before_action 加入預設認證使用者的方法，會讓該頁面跳轉到登入頁，且需要登入後才可以進入。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">before_action <span class="symbol">:authenticate_user!</span></span><br></pre></td></tr></table></figure><h3 id="helper"><a href="#helper" class="headerlink" title="helper"></a>helper</h3><p>判斷使用者是否已經登入？</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_signed_in?</span><br></pre></td></tr></table></figure><p>當使用者登入後，指出目前使用者，這個指令應該會是大家用這個套件的一個主要亮點，你可以透過關聯來連結到其他的 model，去進行資料的撈取。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">current_user</span><br></pre></td></tr></table></figure><p>可以在登入對應的 scope 中使用的 session</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_session</span><br></pre></td></tr></table></figure><p>當使用者登入時，devise 確認帳戶或更新密碼後，會去找 scope 的路徑。登入之後再把使用者導向設定好的地方。<br>如果自訂路徑使用 :user 的 resources，就會去 user_root_path，如果沒有設定這條路徑，就使用 root_path 為預設值，如同上一篇提到的。</p><h2 id="客製新增資料欄位及驗證-強參數使用"><a href="#客製新增資料欄位及驗證-強參數使用" class="headerlink" title="客製新增資料欄位及驗證(強參數使用)"></a>客製新增資料欄位及驗證(強參數使用)</h2><p>如同我們手刻的時候需要將資料透過強參數清洗，避免使用者在填入資料時，強制將一大包 params 惡意送入資料庫，需要經過 controller 的允許(permit)。</p><p>devise 預設註冊只有 email 和 password 可以通過，但我們通常會客製自己的欄位，例如使用者名稱、匿稱、生日、地址等等。</p><p>Devise 中有三個 action 可以允許設定的欄位通過傳到 model，<br>分別是：</p><ul><li>sign_in ( Devise::SessionsController#create )<br>只允許 authentication keys 通過(ex: email、account)</li><li>sign_up ( Devise::RegistrationsController#create )<br>只允許 authentication keys、password、password_confirmation</li><li>account_update ( Devise::RegistrationsController#update )<br>只允許 authentication keys、password、password_confirmation、 current_password</li></ul><p>使用者註冊表單再額外多加其他欄位 如 username、birthday、address，必須在 ApplicationController 設定 before_action，並定義預設方法<code>configure_permitted_parameters</code>來執行，並且設定 before action 當用到 devise 的 controller 就會觸發。</p><p>以下為懶人的單行寫法：<br>ApplicationController.rb</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">ApplicationController</span> &lt; <span class="title class_ inherited__">ActionController::Base</span></span><br><span class="line">  before_action <span class="symbol">:configure_permitted_parameters</span>, <span class="symbol">if:</span> <span class="symbol">:devise_controller?</span></span><br><span class="line"></span><br><span class="line">  protected</span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">configure_permitted_parameters</span></span><br><span class="line">    devise_parameter_sanitizer.permit(<span class="symbol">:sign_up</span>, <span class="symbol">keys:</span> [<span class="symbol">:username</span>, <span class="symbol">:birthday</span>, <span class="symbol">:address</span>])</span><br><span class="line">      <span class="comment"># ()內依序為 (action, 清洗的欄位1, 清洗的欄位2 ....)</span></span><br><span class="line">      <span class="comment"># 注意欄位要用symbol</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h4 id="可以把這個部分寫到下層負責的-controller-嗎？"><a href="#可以把這個部分寫到下層負責的-controller-嗎？" class="headerlink" title="可以把這個部分寫到下層負責的 controller 嗎？"></a>可以把這個部分寫到下層負責的 controller 嗎？</h4><p>答案是可以，我一開始也覺得很奇怪，通常不該寫到最上層的地方，嘗試改動移到下面 registrations_controller 裡面，一直沒能成功，後來發現要使用到套件產生的 controller，或是其他你自己想用的 controller，需要先在路徑中指出你是用哪個 controller 來管理資料 (同前產生 controller 提示訊息提到)，需要在 <code>devise_for :users</code> 後面加上你要使用的 controller</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devise_for <span class="symbol">:users</span>, <span class="symbol">controllers:</span> &#123; <span class="symbol">registrations:</span> <span class="string">&#x27;users/registrations&#x27;</span>  &#125;</span><br></pre></td></tr></table></figure><p>再把相關的清洗設定移到裡面</p><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">app/controller/users/registrations_controller.rb</span><br><span class="line"><span class="keyword">module</span> Users</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">RegistrationsController</span> &lt; <span class="title class_ inherited__">Devise::RegistrationsController</span></span><br><span class="line">    before_action <span class="symbol">:configure_sign_up_params</span>, <span class="symbol">only:</span> [<span class="symbol">:create</span>]</span><br><span class="line">    before_action <span class="symbol">:configure_account_update_params</span>, <span class="symbol">only:</span> [<span class="symbol">:update</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_sign_up_params</span></span><br><span class="line">      devise_parameter_sanitizer.permit(<span class="symbol">:sign_up</span>, <span class="symbol">keys:</span> [<span class="symbol">:username</span>, <span class="symbol">:birthday</span>, <span class="symbol">:address</span>])</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_account_update_params</span></span><br><span class="line">      devise_parameter_sanitizer.permit(<span class="symbol">:account_update</span>, <span class="symbol">keys:</span> [<span class="symbol">:username</span>, <span class="symbol">:birthday</span>, <span class="symbol">:address</span>])</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h2 id="I18N-套件使用"><a href="#I18N-套件使用" class="headerlink" title="I18N 套件使用"></a>I18N 套件使用</h2><h3 id="i18n-安裝"><a href="#i18n-安裝" class="headerlink" title="i18n 安裝"></a>i18n 安裝</h3><ol><li><p>在 Gemfile 加上 gem “rails-i18n”，然後執行 bundle</p></li><li><p>修改 config&#x2F;application.rb 的預設語系：<br>預設應該是 en，就是英文語系，要使用中文可以改為 zh-TW</p></li></ol><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.i18n.default_locale = <span class="string">&quot;zh-TW&quot;</span></span><br></pre></td></tr></table></figure><h3 id="調整訊息"><a href="#調整訊息" class="headerlink" title="調整訊息"></a>調整訊息</h3><p><a href="https://github.com/heartcombo/devise/wiki/I18n">github 上提供各語系 yml 原始碼</a></p><p><a href="https://github.com/tigrish/devise-i18n/blob/master/rails/locales/zh-TW.yml">i18n 使用檔案 zh-TW.yml</a><br>devise 或 i18n-devise github 上已經有許多善心人士提供對應的翻譯檔案。<br>在 config&#x2F;locale 中找到原本的 en 檔案，如果要中文翻譯，上面設定預設語系後加入<code>zh-TW.yml</code>檔案就可以。</p><h2 id="調整密碼長度驗證"><a href="#調整密碼長度驗證" class="headerlink" title="調整密碼長度驗證"></a>調整密碼長度驗證</h2><ol><li>針對全區的會員密碼設定<br>config&#x2F;initializers&#x2F;devise.rb 裡面有針對密碼寫入長度設定，可以設定為自己想要的，預設是 6~128 碼。</li></ol><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.password_length = <span class="number">6</span>..<span class="number">128</span> <span class="comment"># 可以自己調整</span></span><br></pre></td></tr></table></figure><p>調整後包含前面註冊時預設的顯示都會變更，可以回去看一下 view 的檔案預設產生提示字樣的寫法，自行決定是否也要跟著顯示<br><img src="https://i.imgur.com/BggSAxF.png"></p><ol start="2"><li>針對個別 model 有需要密碼設定的設定驗證<br>可以自行加入下面驗證設定</li></ol><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">devise <span class="symbol">:database_authenticatable</span>, <span class="symbol">:validatable</span>, <span class="symbol">password_length:</span> <span class="number">10</span>..<span class="number">128</span></span><br></pre></td></tr></table></figure><h2 id="關於註冊及忘記密碼頁面重新整理會出錯"><a href="#關於註冊及忘記密碼頁面重新整理會出錯" class="headerlink" title="關於註冊及忘記密碼頁面重新整理會出錯"></a>關於註冊及忘記密碼頁面重新整理會出錯</h2><p>似乎是這個套件存在的問題，主要是沒有&#x2F;users 這個路徑。<br>目前根據找到的一些解法，是針對路徑修正，強制將路徑導回註冊或登入頁面</p><p><a href="https://github.com/heartcombo/devise/issues/4573">參考資料</a></p><p>路徑 config&#x2F;routes.rb</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">devise_scope <span class="symbol">:user</span> <span class="keyword">do</span></span><br><span class="line">  get <span class="string">&#x27;/users&#x27;</span>, <span class="symbol">to:</span> <span class="string">&#x27;devise/registrations#new&#x27;</span></span><br><span class="line">  get <span class="string">&#x27;/users/password&#x27;</span>, <span class="symbol">to:</span> <span class="string">&#x27;devise/passwords#new&#x27;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><hr><p>參考資料：</p><ol><li><a href="https://github.com/heartcombo/devise#configuring-models">devise - github</a></li><li><a href="https://andyyou.github.io/2015/04/04/devise/">Devise 快速上手</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails套件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
            <tag> Rails </tag>
            
            <tag> Devise </tag>
            
            <tag> 套件 </tag>
            
            <tag> 會員系統 </tag>
            
            <tag> i18n </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Rails 套件操作，Devise (安裝及基本設置)</title>
      <link href="/2022/08/27/Rails/Rails-%E5%A5%97%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%8CDevise%20%E5%AE%89%E8%A3%9D%E5%8F%8A%E5%9F%BA%E6%9C%AC%E8%A8%AD%E7%BD%AE/"/>
      <url>/2022/08/27/Rails/Rails-%E5%A5%97%E4%BB%B6%E6%93%8D%E4%BD%9C%EF%BC%8CDevise%20%E5%AE%89%E8%A3%9D%E5%8F%8A%E5%9F%BA%E6%9C%AC%E8%A8%AD%E7%BD%AE/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>進入 ruby 世界之後，無非就是希望可以使用 rails 框架來幫助你達到快速及 RESTful 的開發方式，在 rails 世界其實擁有許多強力的裝備，可以幫你擊退沿路的困難，就是我們所謂的套件 (packages)。</p><p>想當初學習自製登入系統真的有點辛苦呢，但 rails 中其實有厲害套件 Devise 可以幫你完成喔，但要能客製化出自己想要的東西也不是很容易的事情呢! 就先來針對基本的使用及客製方式好好來了解一下吧。</p></div><h2 id="Devise-可以做什麼？"><a href="#Devise-可以做什麼？" class="headerlink" title="Devise 可以做什麼？"></a>Devise 可以做什麼？</h2><p><a href="https://rubygems.org/gems/devise/versions/4.2.0?locale=zh-TW">rubygems 介紹</a><br>這是一個很強大的會員系統建置套件，你可以看到下載次數破億就知道這套間多熱門了吧。<br>大部分會用到的就是基本的會員資料建立，他可以幫你做好資料庫密碼的加密 (salting)，多數會拿來用的就是進行註冊登入的認證，讓一些區域透過認證的方法判斷是否有登入，限制特定功能的使用。其實可以用到的功能非常非常多，可以進到 github 看官方手冊介紹。</p><p>主要會用到的功能：</p><ul><li>註冊&#x2F;登入</li><li>第三方登入註冊串接</li><li>註冊登入驗證</li><li>忘記密碼、修改密碼</li><li>密碼改動及會員認證信</li></ul><h2 id="安裝"><a href="#安裝" class="headerlink" title="安裝"></a>安裝</h2><blockquote><p><a href="https://github.com/heartcombo/devise/">原始 Devise github</a></p></blockquote><ol><li>放到 gemfile 然後 bundle 進行安裝</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gem &#x27;devise&#x27;</span><br></pre></td></tr></table></figure><ol start="2"><li>產生 devise 設定檔<br>這邊將我們的 rails 專案導入 devise 的相關資料</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate devise:install</span><br></pre></td></tr></table></figure><h3 id="基本設置"><a href="#基本設置" class="headerlink" title="基本設置"></a>基本設置</h3><ol><li>設定寄信的 mailer 預設 url 位置</li></ol><ul><li><strong>開發階段 development：</strong><br>設置為 localhose:3000 的位置<br>config&#x2F;environments&#x2F;development.rb</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config.action_mailer.default_url_options = &#123; <span class="symbol">host:</span> <span class="string">&#x27;localhost&#x27;</span>, <span class="symbol">port:</span> <span class="number">3000</span> &#125;</span><br></pre></td></tr></table></figure><ul><li><strong>上線階段 production：</strong><br>上線後可以將位置改為實際部屬位置</li></ul><ol start="2"><li>設置首頁位置 routes<br>加入 root 確定登入或是相關操作跳轉回去的位置<br>config&#x2F;routes.rb</li></ol><figure class="highlight rb"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root <span class="symbol">to:</span> <span class="string">&quot;home#index&quot;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>通知訊息設定，notice 及 alert<br>預設已經寫好很多 notice 及 alert，application.htnl.erb 中有加入就可以看到。<br>app&#x2F;views&#x2F;layouts&#x2F;application.html.erb.</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;notice&quot;</span>&gt;</span>&lt;%= notice %&gt;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">class</span>=<span class="string">&quot;alert&quot;</span>&gt;</span>&lt;%= alert %&gt;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure><p>補充一下這些通知預設的訊息：</p><ul><li><p>notice：</p><ul><li>預設登入登出提醒資訊</li><li>信件寄出相關</li></ul></li><li><p>alert：</p><ul><li>資料填寫驗證有誤相關</li></ul></li></ul><p>預設都是英文，有需要調整成中文可以參考 i18n 套件的使用<br><a href="https://guides.rubyonrails.org/i18n.html">https://guides.rubyonrails.org/i18n.html</a></p><h2 id="建立-model"><a href="#建立-model" class="headerlink" title="建立 model"></a>建立 model</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate devise MODEL</span><br></pre></td></tr></table></figure><p>透過內建指令產生 model 及 migration，上面標示的 MODEL(通常用 user) 可以用別的但會影響預設的 controller 跟 view 位置及名稱，可以到 db&#x2F;migrate 查看產生的 migration 檔案</p><p><img src="https://i.imgur.com/HUXfnnM.png"></p><p>執行後 rails 會自動產生 migration、model、route 等。<br>Devise 有提供多達 10 個模組，可以取消 migration 內的註解開啟這些資料欄位紀錄：</p><ol><li>Database Authenticatable 加密並儲存密碼於資料庫，當使用者登入時比對驗證身份。驗證機制可以透過 POST 請求或者 HTTP 基本的驗證方式。</li><li>Omniauthable 支援 OmniAuth 第三方認證標準 (<a href="https://github.com/intridea/omniauth">https://github.com/intridea/omniauth</a>)</li><li>Confirmable 寄送 Email 來驗證帳號是否啟用、並且確認會員是否已註冊過</li><li>Recoverable 可以重設密碼與發送密碼更改的通知信件</li><li>Registerable 處理註冊流程，且會員可編輯相關資料、刪除個人帳號</li><li>Rememberable 管理 Token 的產生與清除，使用者的部分資訊會被存在客戶端的 cookie，（達成跳轉頁面時，不必一再登入）</li><li>Trackable 追蹤登入的紀錄（像是次數，時間與 IP）</li><li>Timeoutable 超過一定時間使用者未操作網站，sessions 會過期</li><li>Validatable 提供信箱和密碼的驗證。此功能可以視情況客製化，自行定義驗證方式。</li><li>Lockable 當帳號不斷登入失敗時會鎖住。同時發送 Email 來驗證解鎖。</li></ol><p>確定好要開啟的功能之後，記得 <code>db:migrate</code></p><h2 id="產生預設相關-view"><a href="#產生預設相關-view" class="headerlink" title="產生預設相關 view"></a>產生預設相關 view</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rails generate devise:views</span><br></pre></td></tr></table></figure><p>使用這個指令可以建立套件預設的 view，<br>你可以調整需要的頁面連結，註冊、登入、忘記密碼等等，客製自己的版面</p><ul><li>sessions 登入相關</li><li>registrations 註冊相關</li><li>confirmations 帳號認證相關</li><li>passwords 忘記密碼&#x2F;密碼修改</li><li>unlocks 上鎖帳號相關</li><li>mailer 信件寄送內容相關</li><li>shared 共同<ul><li>error_messages 錯誤訊息顯示</li><li>link 所有連結彙整 (登入、登出、第三方登入註冊、忘記密碼…)</li></ul></li></ul><p><img src="https://i.imgur.com/B3ZYJtY.png"></p><p>做到這邊就可以看到登入系統已經有可以使用基本的功能及畫面了<br>根據相關的路徑可以找到對應的畫面<br><img src="https://i.imgur.com/I9tI9nq.png"></p><p>&#x2F;users&#x2F;sign_up 註冊<br><img src="https://i.imgur.com/eSqwfwF.png"></p><p>&#x2F;users&#x2F;sign_in 登入<br><img src="https://i.imgur.com/mJR4qca.png"></p><hr><p>下一篇再來針對 controller 的使用，還有之前使用這個套件進行過的客製化部分做說明~</p><hr><p>參考資料：</p><ol><li><a href="https://github.com/heartcombo/devise#configuring-models">devise - github</a></li><li><a href="https://andyyou.github.io/2015/04/04/devise/">Devise 快速上手</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Rails套件 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
            <tag> Rails </tag>
            
            <tag> Devise </tag>
            
            <tag> 套件 </tag>
            
            <tag> 會員系統 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>掌握Ruby世界就要先懂：區塊</title>
      <link href="/2022/08/27/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E5%8D%80%E5%A1%8A/"/>
      <url>/2022/08/27/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E5%8D%80%E5%A1%8A/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>在 Ruby 世界中有著區塊(本篇將稱 block)的特殊語法，跟語言的執行程序上有大大的關聯，今天就來好好跟大家介紹這些部分吧!</p></div><h2 id="區塊-Block"><a href="#區塊-Block" class="headerlink" title="區塊 Block"></a>區塊 Block</h2><p>前面有跟大家說到 ruby 幾乎甚麼都是物件，但唯獨 block 這個東西他不能算是物件，而<br>block 在 ruby 中有兩種：</p><blockquote><ul><li>{} 之內</li><li>do…end 的範圍內</li></ul></blockquote><h3 id="Block-的特性"><a href="#Block-的特性" class="headerlink" title="Block 的特性"></a>Block 的特性</h3><p>總結有以下的特性：</p><blockquote><ul><li>一段不會被主動執行的程式碼</li><li>不是物件</li><li>像寄生蟲一樣需要依附在某些方法或物件，且不是參數<br>Block 會不會執行，要看宿主臉色，<strong>是否有 yield</strong></li></ul></blockquote><p>可以看下面的例子，我們定義一個吃東西的方法，food 是參數，下面的兩種 block 類型其實都不會被執行，既使看起來有被呼叫到，就像我們上面說的特性，不會被主動執行，也不是參數。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">eat_something</span>(<span class="params">food</span>)</span><br><span class="line">  <span class="comment"># eat something here</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">eat_something(rice) &#123;</span><br><span class="line">  puts <span class="string">&quot;Block在這&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或是 do ... end 寫法</span></span><br><span class="line">eat_something(<span class="string">&quot;noodle&quot;</span>) <span class="keyword">do</span></span><br><span class="line">  puts <span class="string">&quot;這裡也是Block&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="如何執行-yield-控制權轉讓"><a href="#如何執行-yield-控制權轉讓" class="headerlink" title="如何執行? (yield 控制權轉讓)"></a>如何執行? (yield 控制權轉讓)</h3><p>不知道大家有沒有在馬路上看過這樣的標誌?</p><p><img src="https://i.imgur.com/5xb2r4M.png"></p><p>大家應該知道這樣的號誌出現就是行車要禮讓行人的路口，等行人過去之後才能繼續前進。<br>其實 block 的運作就是像是這樣的情境喔!!<br>當出現 yield 的時候，區塊內的程式碼就會馬上被執行，而這樣的狀況其實是<strong>控制權的轉讓</strong>，當執行完成後再交出控制權回去依序執行剩下的程式碼。</p><p>舉個例子來說：<br>下面個別字串後面括號的順序就是執行的順序喔! 可以看到 yield 表示將控制權交給 block { } 內的程式碼</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">drive_car</span></span><br><span class="line">  puts <span class="string">&quot;行駛中!!(1)&quot;</span></span><br><span class="line">  <span class="keyword">yield</span></span><br><span class="line">  puts <span class="string">&quot;我是好公民要等行人過完才能走喔!!(3)&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">drive_car &#123;</span><br><span class="line">  puts <span class="string">&quot;停車!--這裡是block喔--(2)&quot;</span></span><br><span class="line">&#125;</span><br><span class="line">puts <span class="string">&quot;可以走啦!!(4)&quot;</span></span><br></pre></td></tr></table></figure><h3 id="傳遞參數給-Block"><a href="#傳遞參數給-Block" class="headerlink" title="傳遞參數給 Block"></a>傳遞參數給 Block</h3><p>Block 不是參數，但可以做為傳遞參數的角色。<br>轉讓的同時，還可以帶上拌手禮傳遞參數，依照傳遞的多寡可以依序轉讓。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">block_pass_one</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">10</span> <span class="comment"># 傳遞10出去</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">block_pass_one <span class="keyword">do</span> |<span class="params">n</span>| <span class="comment"># do..end 之間接到參數並指定給 n</span></span><br><span class="line">  puts n <span class="comment"># 印出 10</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">block_pass_two</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">10</span>,<span class="number">20</span> <span class="comment"># 傳遞10, 20出去</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">block_pass_two <span class="keyword">do</span> |<span class="params">n, m</span>| <span class="comment"># do..end 之間接到參數並依序指定給 n, m</span></span><br><span class="line">  puts n <span class="comment"># 印出 10</span></span><br><span class="line">  puts m <span class="comment"># 印出 20</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h4 id="如果沒有-Block-但卻-yield-的話"><a href="#如果沒有-Block-但卻-yield-的話" class="headerlink" title="如果沒有 Block 但卻 yield 的話?"></a>如果沒有 Block 但卻 yield 的話?</h4><p>會出錯喔!! 控制權轉讓之後沒有 block 可以接的話就會有 localJumpError。<br>def say_hello # 轉讓控制權，往下找到 test two 的方法<br>yield<br>end<br>say_hello # no block given (yield) (LocalJumpError)</p><h3 id="block-回傳值"><a href="#block-回傳值" class="headerlink" title="block 回傳值"></a>block 回傳值</h3><p>Block，不用寫 return，最後一行的執行結果會自動變成回傳值。像是一些方法的使用可以看出來，如下面這些例子</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># map 與 select 方法 &#123;&#125; 之間的運算就是最後的回傳。</span></span><br><span class="line">p (<span class="number">1</span>..<span class="number">10</span>).map&#123;|<span class="params">x</span>|x*<span class="number">2</span>&#125;</span><br><span class="line"></span><br><span class="line">p (<span class="number">1</span>..<span class="number">10</span>).select&#123;|<span class="params">x</span>|x.odd?&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># test two 方法後面接上block，&#123;&#125;內的判斷就成為最後的回傳</span></span><br><span class="line"><span class="comment"># yield後面帶入的參數會影響下方&#123;&#125;內判斷結果，再回到原本方法去判斷是要印出哪個內容</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">test_two</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">yield</span>(<span class="number">2</span>)</span><br><span class="line">    puts <span class="string">&quot;yes, it is 2&quot;</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts <span class="string">&quot;no, it is not 2&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">test_two &#123;|<span class="params">n</span>| n == <span class="number">2</span> &#125;</span><br></pre></td></tr></table></figure><h4 id="如果使用-return-在-block-中呢"><a href="#如果使用-return-在-block-中呢" class="headerlink" title="如果使用 return 在 block 中呢?"></a>如果使用 return 在 block 中呢?</h4><p>也會出現 localjumperror，因為 Block 不是一個方法，不知道 Return 到哪裡去，所以造成錯誤。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">p (<span class="number">1</span>..<span class="number">100</span>).select&#123; |<span class="params">x</span>| <span class="keyword">return</span> x % <span class="number">2</span> == <span class="number">0</span> &#125;</span><br></pre></td></tr></table></figure><h3 id="do…end-及-大括號-之間差異"><a href="#do…end-及-大括號-之間差異" class="headerlink" title="do…end 及 大括號 {} 之間差異?"></a>do…end 及 大括號 {} 之間差異?</h3><p>一般來說是一樣的，但可能會有優先度的差別，在一些方法的寫法上導致類似先乘除後加減的狀況。</p><ul><li>Block 的內容如果有多行，會建議使用 do .. end 寫法</li><li>如果只有一行，則建議使用大括號寫法</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">p [*<span class="number">1</span>..<span class="number">10</span>].map &#123; |<span class="params">i</span>| i * <span class="number">2</span> &#125;</span><br><span class="line"><span class="comment"># =&gt; 得到 [2, 4, 6, 8, 10, 12, 14, 16, 18, 20] &#123;&#125; 優先度高</span></span><br><span class="line"></span><br><span class="line">p [*<span class="number">1</span>..<span class="number">10</span>].map <span class="keyword">do</span> |<span class="params">i</span>| i * <span class="number">2</span> <span class="keyword">end</span></span><br><span class="line"><span class="comment"># =&gt; 得到 &lt;Enumerator: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]:map&gt; do...end 優先度低，</span></span><br><span class="line"><span class="comment"># 可以還原成 (p [*1..10].map) do |i| i * 2 end，括號內先執行完，所以後面的條件沒有被帶入執行。</span></span><br></pre></td></tr></table></figure><p>以上就是基本對於 block 相關的介紹，後面可以開始進入 ruby 這充滿物件的世界中－物件導向，了解一下關於物件導向的一些概念吧。</p><hr><p><strong>參考資料:</strong></p><ol><li><a href="https://railsbook.tw/chapters/07-ruby-basic-3">為你自己學 Ruby on rails</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>掌握Ruby世界就要先懂：方法</title>
      <link href="/2022/08/25/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E6%96%B9%E6%B3%95/"/>
      <url>/2022/08/25/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E6%96%B9%E6%B3%95/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><p>這部分的觀念相當重要喔，大家使用 ruby 主要為了可以好好操作 rails 這個開發框架，裡面內部組成，除了前面的資料類型及邏輯判斷等，再來務必要認識的就是這些方法(Method)跟區塊(Block)的使用了。有一定的認識後進入 rails 的世界才能看懂其中的奧妙呀!</p></div><h2 id="方法-Method"><a href="#方法-Method" class="headerlink" title="方法 (Method)"></a>方法 (Method)</h2><h3 id="為什麼要使用"><a href="#為什麼要使用" class="headerlink" title="為什麼要使用?"></a>為什麼要使用?</h3><p>有些時候我們會<strong>重複做一些指令</strong>，如果可以簡單幾行字就能呼叫一連串的指令，然後可以重複利用在不同的地方，就是我們為什麼會要使用方法的原因啦。</p><h3 id="如何定義與使用"><a href="#如何定義與使用" class="headerlink" title="如何定義與使用?"></a>如何定義與使用?</h3><p>如同標題我們要定義就是使用 define 這個英文的簡寫 <code>def</code> 來開頭，後面宣告這個方法的名稱，<strong>名稱很重要</strong>最好可以清楚表達執行內容，接著就是放入的參數及要執行的內容，最後再加上 <code>end</code> 結束，後面會介紹到這段<code>def...end</code>的範圍稱為區塊，大概會長成這樣：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">say_hello</span>() <span class="comment"># 方法名為say_hello，後面括號可以不放參數</span></span><br><span class="line">  puts <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">say_hello() <span class="comment"># 印出 hello</span></span><br><span class="line">say_hello <span class="comment"># 同上，可以省略括號</span></span><br></pre></td></tr></table></figure><h3 id="參數-parameter-與引數-argument"><a href="#參數-parameter-與引數-argument" class="headerlink" title="參數(parameter)與引數(argument)"></a>參數(parameter)與引數(argument)</h3><p>很多人都會搞混這部分，認為都是叫做參數。其實是：</p><blockquote><ul><li>參數是在定義方法時後面括號內部物件</li><li>引數是在呼叫使用方法時括號內所帶入的物件</li></ul></blockquote><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">say_hello_to</span>(<span class="params">name</span>) <span class="comment"># 放入參數name</span></span><br><span class="line">  puts <span class="string">&quot;hello, <span class="subst">#&#123;name&#125;</span>&quot;</span> <span class="comment"># name 所放的引數會被帶入</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">say_hello_to(Sean) <span class="comment"># 帶入Sean作為引數，印出 hello, Sean</span></span><br></pre></td></tr></table></figure><h3 id="使用注意參數與引數的數量"><a href="#使用注意參數與引數的數量" class="headerlink" title="使用注意參數與引數的數量"></a>使用注意參數與引數的數量</h3><p>必須<strong>一個蘿蔔一個坑對入</strong>，如果參數有 3 個，只要引數不等於 3 個都是會出錯的!!</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a,b,c</span>)</span><br><span class="line">  a + b + c</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">add (<span class="number">1</span>,<span class="number">2</span>) <span class="comment"># 出錯，少一個</span></span><br><span class="line">add (<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>) <span class="comment"># 出錯，多一個</span></span><br></pre></td></tr></table></figure><h3 id="參數預設值"><a href="#參數預設值" class="headerlink" title="參數預設值"></a>參數預設值</h3><p>方法的參數可以用 “&#x3D;” 先預設好喔</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">say_hello_to</span>(<span class="params">name =<span class="string">&quot;Ken&quot;</span></span>) <span class="comment"># 預設name為&quot;Ken&quot;</span></span><br><span class="line">  puts <span class="string">&quot;hello, <span class="subst">#&#123;name&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">say_hello_to(Sean) <span class="comment"># 印出 hello, Sean</span></span><br><span class="line">say_hello_to() <span class="comment"># 有預設如果沒引數會自動帶入預設&quot;Ken&quot;作為引數，印出 hello, Ken</span></span><br></pre></td></tr></table></figure><h3 id="回傳"><a href="#回傳" class="headerlink" title="回傳"></a>回傳</h3><p>從前面的例子如果有注意到其實方法的最後一行就是所謂的回傳值，注意特別的是 Ruby 中 return 可以適時的省略，自動回傳最後一行。</p><p>比較需要注意很多人以為用 puts 印出就表示回傳了，<strong>其實 puts 是沒有回傳值的</strong>，沒回傳就會回傳 nil。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># puts沒有回傳</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">double_num</span>(<span class="params">num</span>)</span><br><span class="line"> puts num * <span class="number">2</span> <span class="comment"># 印出 2 倍的值，但其實是沒有回傳值的</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">p double_num(<span class="number">5</span>) <span class="comment"># 會印出什麼？答案是 10 跟 nil 喔!!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 回傳值</span></span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">double_num</span>(<span class="params">num</span>)</span><br><span class="line"> <span class="keyword">return</span> num * <span class="number">2</span> <span class="comment"># 回傳 num*2 ，可以省略return</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line">p double_num(<span class="number">5</span>) <span class="comment"># 印出 10</span></span><br></pre></td></tr></table></figure><h3 id="及-究竟在幹嘛"><a href="#及-究竟在幹嘛" class="headerlink" title="? 及 ! 究竟在幹嘛?"></a>? 及 ! 究竟在幹嘛?</h3><ul><li>? 跟 ! 可以是命名的一部份，但只能放在最後面</li><li>問號通常會回傳真假值，而驚嘆號通常表示要注意！</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">is_adult?</span>(<span class="params">age</span>)</span><br><span class="line">  <span class="keyword">if</span> age &gt;= <span class="number">18</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">list = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>]</span><br><span class="line"></span><br><span class="line">p list.sort <span class="comment"># 排序但不改變原本陣列，印出[1,2,3,4]</span></span><br><span class="line">p list <span class="comment"># 原本陣列還是印 [1,4,3,2]</span></span><br><span class="line">p list.sort! <span class="comment"># 排序但改變原本陣列 [1,2,3,4]</span></span><br><span class="line">p list <span class="comment"># 原本陣列改成 [1,2,3,4]</span></span><br></pre></td></tr></table></figure><hr><p>參考資料：</p><ol><li><a href="https://railsbook.tw/chapters/07-ruby-basic-3">為你自己學 ruby on rails</a></li><li><a href="https://ruby-doc.org/core-2.4.1/doc/syntax/methods_rdoc.html">Ruby Docs - Method</a></li><li><a href="https://pjchender.dev/ruby-on-rails/ruby-function-method/">[Ruby] 方法／函式（function &#x2F; method）</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>掌握Ruby世界就要先懂：迴圈與迭代</title>
      <link href="/2022/08/22/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E8%BF%B4%E5%9C%88%E8%88%87%E8%BF%AD%E4%BB%A3/"/>
      <url>/2022/08/22/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E8%BF%B4%E5%9C%88%E8%88%87%E8%BF%AD%E4%BB%A3/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><h2 id="迴圈與迭代-Loop-amd-Iteration"><a href="#迴圈與迭代-Loop-amd-Iteration" class="headerlink" title="迴圈與迭代 Loop amd Iteration"></a>迴圈與迭代 Loop amd Iteration</h2><p>這部分通常都是每個程式新手剛開始碰到的一個小難關，常常自己卡在迴圈裡面轉啊轉轉不出來，究竟我們為什麼會需要迴圈呢? 今天就來好好介紹一下這個好東西吧!</p></div><h3 id="為甚麼會需要迴圈"><a href="#為甚麼會需要迴圈" class="headerlink" title="為甚麼會需要迴圈?"></a>為甚麼會需要迴圈?</h3><p>我想答案其實很簡單，因為<strong>重覆</strong>阿，主要因為在程式設計的資料呈現或是取得上，特別是陣列，會不斷透過相同的指令去重覆進行，所以就有了迴圈這樣的方法產生了。比如說要你依序取出特定的資料或是印出一些字串，你應該很懶得自己一樣樣的取出或印出吧，如果一個指令就能自動全部拿到或是幫你重覆執行相同動作的話，何樂而不為呢?</p><h2 id="迴圈種類"><a href="#迴圈種類" class="headerlink" title="迴圈種類"></a>迴圈種類</h2><p>在 Ruby 裡面的迴圈主要有以下五種：</p><ol><li><code>for</code></li><li><code>while</code></li><li><code>loop</code></li><li><code>method</code> (Ruby 特有)</li><li><code>迭代</code> (常用)</li></ol><h3 id="迴圈和迭代-Loop-vs-Iteration"><a href="#迴圈和迭代-Loop-vs-Iteration" class="headerlink" title="迴圈和迭代 Loop vs Iteration"></a>迴圈和迭代 Loop vs Iteration</h3><p>很多時候這兩個類型定義其實很模糊，主要差別是：</p><blockquote><ul><li>迴圈: 執行完特定圈數就沒了</li><li>迭代: 是要針對每個對象去進行(或遍歷)，也是一種迴圈的方式，會執行到每個對象都完成後才會停止。</li></ul></blockquote><h3 id="For-迴圈-for…in"><a href="#For-迴圈-for…in" class="headerlink" title="For 迴圈 (for…in)"></a>For 迴圈 (for…in)</h3><p>for in 迴圈使用的格式通常是 <code>For 單數名 in 複數名</code><br>通常這兩者之間會用同樣的名字的單複數，比較可以明確表達你要取得一堆東西(複數)裡面的個別資料，你要取不相關的名稱也是可以。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">names = [<span class="string">&quot;Sean&quot;</span>, <span class="string">&quot;Ken&quot;</span>, <span class="string">&quot;John&quot;</span>, <span class="string">&quot;Tom&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> name <span class="keyword">in</span> names</span><br><span class="line">  puts name</span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 印出&quot;Sean&quot;, &quot;Ken&quot;, &quot;John&quot;, &quot;Tom&quot;</span></span><br></pre></td></tr></table></figure><h3 id="While-迴圈"><a href="#While-迴圈" class="headerlink" title="While 迴圈"></a>While 迴圈</h3><p>使用這類的迴圈要小心不要變成無窮迴圈，要設定清楚結束條件，不然形成無權迴圈可是會讓你的程式執行卡住喔! 結束的條件會設定在 while 後面，後面再進行特定動作直到達成結束條件後結束。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> x &lt; <span class="number">10</span> <span class="comment">#結束條件</span></span><br><span class="line">  puts x</span><br><span class="line">  x += <span class="number">1</span> <span class="comment">#改變條件</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#依序印出 1~9</span></span><br></pre></td></tr></table></figure><h4 id="邪惡分身-Evil-Twins"><a href="#邪惡分身-Evil-Twins" class="headerlink" title="邪惡分身 Evil Twins:"></a>邪惡分身 Evil Twins:</h4><p>這邊一樣又出現了 ruby 的邪惡分身，非母語的比較不直觀，可以依照個人喜好選用。</p><ul><li>until &#x3D; while not</li><li>while &#x3D; until not</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">x = <span class="number">0</span></span><br><span class="line"><span class="keyword">until</span> x &gt;= <span class="number">10</span> <span class="comment">#結束條件</span></span><br><span class="line">  puts x</span><br><span class="line">  x += <span class="number">1</span> <span class="comment">#改變條件</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment"># 印出1~9 (大於等於10就停止)</span></span><br></pre></td></tr></table></figure><h3 id="loop-迴圈"><a href="#loop-迴圈" class="headerlink" title="loop 迴圈"></a>loop 迴圈</h3><p>與 while 類似，但是需要使用 break 去設定結束條件終止迴圈進行，可以選則使用 do..end 或是{ }，這區間都稱作 block，兩者是同樣的作用方式可以互相替換，是 ruby 很重要的觀念喔!</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">0</span></span><br><span class="line">loop <span class="keyword">do</span></span><br><span class="line">  puts i</span><br><span class="line">  i += <span class="number">1</span> <span class="comment"># 改變條件</span></span><br><span class="line">  <span class="keyword">break</span> <span class="keyword">if</span> i &gt; <span class="number">10</span> <span class="comment"># 終止條件</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment"># 印出1~9</span></span><br></pre></td></tr></table></figure><h3 id="method-迴圈"><a href="#method-迴圈" class="headerlink" title="method 迴圈"></a>method 迴圈</h3><p>之前有講到在 ruby 中數字也算是物件，所以 number.method 應該可以很直觀的弄懂，”.”後面是接方法吧</p><ul><li><code>.times&#123;&#125;</code></li><li><code>.upto()</code></li><li><code>.downto()</code></li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1 .times&#123;&#125; 執行特定次數 (大括號可換用 do...end)</span></span><br><span class="line"><span class="number">5</span>.times <span class="keyword">do</span></span><br><span class="line">  puts <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment"># 印出 5次&quot;hello&quot;</span></span><br><span class="line"><span class="comment">#2 .upto() 由小到大(想像.upto後面用小括號接參數)</span></span><br><span class="line"><span class="number">1</span>.upto(<span class="number">10</span>) <span class="keyword">do</span> |<span class="params">i</span>|</span><br><span class="line">  puts <span class="string">&quot;hello, ruby <span class="subst">#&#123;i&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3 .downto() 由大到小</span></span><br><span class="line"><span class="number">10</span>.downto(<span class="number">1</span>) <span class="keyword">do</span> |<span class="params">i</span>|</span><br><span class="line">  puts <span class="string">&quot;hello, ruby <span class="subst">#&#123;i&#125;</span>&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="迭代式迴圈-ruby-常用"><a href="#迭代式迴圈-ruby-常用" class="headerlink" title="迭代式迴圈 (ruby 常用)"></a>迭代式迴圈 (ruby 常用)</h2><p>使用 each 的方法針對特定資料內所有元素進行迭代。</p><ul><li><code>each</code> 對每個元素</li><li><code>each_with_index</code> 可以同時處理每個元素跟索引值</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># each</span></span><br><span class="line">names = [<span class="string">&quot;Sean&quot;</span>, <span class="string">&quot;Ken&quot;</span>, <span class="string">&quot;John&quot;</span>, <span class="string">&quot;Tom&quot;</span>]</span><br><span class="line">x = <span class="number">0</span></span><br><span class="line">names.each <span class="keyword">do</span> |<span class="params">name</span>|</span><br><span class="line">  puts <span class="string">&quot;<span class="subst">#&#123;x&#125;</span> <span class="subst">#&#123;name&#125;</span>&quot;</span></span><br><span class="line">  x += <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment"># 印出 0 Sean, 1 Ken, 2 John, 3 Tom</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># each_with_index ，效果同上</span></span><br><span class="line">names = [<span class="string">&quot;Sean&quot;</span>, <span class="string">&quot;Ken&quot;</span>, <span class="string">&quot;John&quot;</span>, <span class="string">&quot;Tom&quot;</span>]</span><br><span class="line">x = <span class="number">0</span></span><br><span class="line">names.each_with_index <span class="keyword">do</span> |<span class="params">name, x</span>|</span><br><span class="line">  puts <span class="string">&quot;<span class="subst">#&#123;x&#125;</span> <span class="subst">#&#123;name&#125;</span>&quot;</span></span><br><span class="line">  x += <span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment"># 印出 0 Sean, 1 Ken, 2 John, 3 Tom</span></span><br></pre></td></tr></table></figure><hr><p><strong>參考資料:</strong></p><ol><li><a href="https://railsbook.tw/chapters/05-ruby-basic-1#flow-control">為你自己學 Ruby on rails</a></li><li><a href="https://pjchender.dev/ruby-on-rails/ruby-loop-and-iterator/">[Ruby] 迴圈及疊代（Loop and Iterator）</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>怎麼大家都一直在說 REST 和 RESTful?</title>
      <link href="/2022/08/20/Ruby/%E6%80%8E%E9%BA%BC%E5%A4%A7%E5%AE%B6%E9%83%BD%E4%B8%80%E7%9B%B4%E5%9C%A8%E8%AA%AA-REST-%E5%92%8C-RESTful/"/>
      <url>/2022/08/20/Ruby/%E6%80%8E%E9%BA%BC%E5%A4%A7%E5%AE%B6%E9%83%BD%E4%B8%80%E7%9B%B4%E5%9C%A8%E8%AA%AA-REST-%E5%92%8C-RESTful/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><h1 id="怎麼大家都一直在說-REST-和-RESTful"><a href="#怎麼大家都一直在說-REST-和-RESTful" class="headerlink" title="怎麼大家都一直在說 REST 和 RESTful?"></a>怎麼大家都一直在說 REST 和 RESTful?</h1><p>關於這兩個名詞的好奇，其實是因為接觸 ruby on rails 的學習歷程中，查詢相關的職缺資訊後，發現許多公司的需求不斷提到這兩個字，因此想要去了解這是在說甚麼，才知道原來 ROR 把這樣的設計風格大大發揚光大呢! 不過都學了 Rails 還不好好把這些名詞弄懂真的太對不起了。</p></div><h2 id="REST"><a href="#REST" class="headerlink" title="REST?"></a>REST?</h2><p>Representational State Transfer，簡稱 REST，直譯為”表徵化狀態轉變”，但一聽到這樣的名詞其實根本搞不懂這到底在說甚麼。</p><div class="note info simple"><p>簡單地說 <strong>REST 是一種軟體架構風格</strong> ，適合應用在複雜的網路服務環境中，而 HTTP 也是符合 REST 的架構的一項實作。<br>目的是針對不同軟體、程式在網際網路中能夠互相傳遞訊息。每一個網頁都可視為一個資源（resource）提供使用者使用，而你可以透過 URL（Uniform Resource Locator），也就是這些資源的地址，對這些資源透過 HTTP 動詞，來讀取這些資源或是修改。</p></div><h3 id="RESTful-Triangle-REST-金三角-概念："><a href="#RESTful-Triangle-REST-金三角-概念：" class="headerlink" title="RESTful-Triangle (REST 金三角) 概念："></a>RESTful-Triangle (REST 金三角) 概念：</h3><p><img src="https://i.imgur.com/S3rGzkC.png"></p><p>EX:以我們平常上網的例子來說明應該比較好了解這些組成之間的關係</p><ul><li>瀏覽器上輸入 url <code>https://oseanchen.github.io/(名詞)</code>，對瀏覽器送出 Request</li><li>瀏覽器告訴網頁伺服器：請給我<code>（GET 動詞）這個網址位置</code>的 <code>HTML 格式文件（表徵）</code></li><li>接著瀏覽器解析並呈現出 HTML (回應 Response)，看到畫面(Render)</li><li>過程中可能讀取網頁中的<code>圖片（表徵）</code>，或者點選連結獲得 <code>XML 文件（XML 表徵）</code>，甚至<code>傳送留言（POST 動詞）</code></li></ul><p>這樣的例子就簡單的說明：</p><div class="note info simple"><p>REST 操作 Web 的基本行為是一種表徵化狀態轉變，主要是<strong>藉由操作 (動詞) 不同的 URL (名詞) 達成不同的資料 (表徵) 呈現方式。</strong></p></div><div class="note modern"><p><strong>*補充解釋 Resource</strong><br>有解釋中提到，名詞內其實包含了資源(Resource)的部分，在原本的全名中被省略，URL 表示三角形中的名詞，會指向資源 (可能是圖片、連結或是一些內容，content type) 的位置，所以我們是透過網址（URL）指向資源並用特定動詞取得資源，每一種資源對應一個特定的 URL。</p><p><strong>*補充解釋 HTTP 動詞</strong><br>GET &#x3D;&gt; 讀取資源<br>POST &#x3D;&gt; 新增資源<br>PUT &#x3D;&gt; 替換資源<br>PATCH &#x3D;&gt; 更換資源部分內容<br>DELETE &#x3D;&gt; 刪除資源</p></div><h2 id="RESTful"><a href="#RESTful" class="headerlink" title="RESTful?"></a>RESTful?</h2><p>一開始看到會直覺想到 beautiful, successful 之類的單字都是用名詞 + “ful” 轉變來，所以 RESTful 可算是形容詞，一般來說就是<strong>朝著 REST 理念所設計出來的系統可稱為 RESTful</strong></p><h4 id="路徑設計比較"><a href="#路徑設計比較" class="headerlink" title="路徑設計比較:"></a>路徑設計比較:</h4><p>RESTful 路徑設計主要會是下面的概念，可以一眼從路由結構就能看出要對什麼資源(名詞)、進行什麼操作(動詞)。</p><p>瀏覽全部資料：GET + 資源名稱<br>瀏覽特定資料：GET + 資源名稱 + :id<br>新增一筆資料：POST + 資源名稱<br>修改特定資料：PUT + 資源名稱 + :id<br>刪除特定資料：DELETE + 資源名稱 + :id</p><h4 id="非-REST"><a href="#非-REST" class="headerlink" title="非 REST"></a>非 REST</h4><p>取得所有文章資料 GET &#x2F;getAllArticles<br>取得某筆文章資料 GET &#x2F;getArticle&#x2F;11<br>新增文章資料 POST &#x2F;createArticle<br>更新某筆文章資料 POST &#x2F;updateArticle&#x2F;<br>刪除某筆文章資料 POST &#x2F;deleteArticle&#x2F;</p><h4 id="RESTful-1"><a href="#RESTful-1" class="headerlink" title="RESTful"></a>RESTful</h4><p>取得所有文章資料 &#x2F;GET &#x2F;Articles<br>取得某筆文章資料 &#x2F;GET &#x2F;Articles&#x2F;1<br>新增文章資料 &#x2F;POST &#x2F;Articles<br>更新某筆文章資料 &#x2F;PATCH &#x2F;Articles&#x2F;1<br>刪除某筆文章資料 &#x2F;DELETE &#x2F;Articles&#x2F;1</p><p>看到這裡也很直覺得想到我在實作 rails 的過程其實一直在歷經這樣操作，也是因為這樣風格規範之下可以呈現簡明的網址設計。</p><hr><p><strong>參考資料:</strong></p><ol><li><a href="https://blog.toright.com/posts/725/representational-state-transfer-%E8%BB%9F%E9%AB%94%E6%9E%B6%E6%A7%8B%E9%A2%A8%E6%A0%BC%E4%BB%8B%E7%B4%B9-part-i-%E5%BE%9E%E4%BA%86%E8%A7%A3-rest-%E5%88%B0%E8%A8%AD%E8%A8%88-restful%EF%BC%81.html">淺談 REST 軟體架構風格 (Part.I) - 從了解 REST 到設計 RESTful！</a></li><li><a href="https://blog.toright.com/posts/5523/restful-api-%E8%A8%AD%E8%A8%88%E6%BA%96%E5%89%87%E8%88%87%E5%AF%A6%E5%8B%99%E7%B6%93%E9%A9%97.html">RESTful API 設計準則與實務經驗</a></li><li><a href="https://ihower.tw/rails/restful.html">Rails 實戰聖經</a></li><li><a href="https://hackmd.io/@monkenWu/Sk9Q5VoV4/https%3A%2F%2Fhackmd.io%2F%40gen6UjQISdy0QDN62cYPYQ%2FHJh9zOE7V?type=book#%E8%A8%AD%E8%A8%88%E4%B8%80%E7%B5%84RESTful-API">簡單理解 REST 設計風格與 RESTful API</a></li><li><a href="https://tw.alphacamp.co/blog/rest-restful-api?gclid=CjwKCAjwh4ObBhAzEiwAHzZYUwg8T0JAp0iu0g9hc5r2YLgbE6s1BOOczVgce4EdcvFbpuK5zOuFABoC0AgQAvD_BwE">什麼是 REST? 認識 RESTful API 路由語義化設計風格</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> 網頁設計概念 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
            <tag> Rails </tag>
            
            <tag> 程式設計 </tag>
            
            <tag> REST </tag>
            
            <tag> RESTful </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>掌握Ruby世界就要先懂：邏輯判斷與流程控制</title>
      <link href="/2022/08/18/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E9%82%8F%E8%BC%AF%E5%88%A4%E6%96%B7%E8%88%87%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/"/>
      <url>/2022/08/18/Ruby/%E6%8E%8C%E6%8F%A1Ruby%E4%B8%96%E7%95%8C%E5%B0%B1%E8%A6%81%E5%85%88%E6%87%82%EF%BC%9A%E9%82%8F%E8%BC%AF%E5%88%A4%E6%96%B7%E8%88%87%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><h2 id="邏輯判斷與流程控制"><a href="#邏輯判斷與流程控制" class="headerlink" title="邏輯判斷與流程控制"></a>邏輯判斷與流程控制</h2><p><img src="https://i.imgur.com/UQvOf8m.png"><br>不知道各位有沒有看過這則笑話，你看完今天的內容應該就可以了解這個笑點在哪裡了!</p><p>這部分是各家程式語言最常使用也是訓練大家邏輯思考的地方了，許多的運算或是流程進行就必須先懂這部分的操作，今天就讓我們來好好認識 Ruby 的寫法吧!</p></div><h3 id="等號的數量跟判斷有甚麼關係"><a href="#等號的數量跟判斷有甚麼關係" class="headerlink" title="等號的數量跟判斷有甚麼關係?"></a>等號的數量跟判斷有甚麼關係?</h3><ul><li>“&#x3D;” 1 個等號是<strong>指定</strong></li><li>“&#x3D;&#x3D;” 2 個表示<strong>比對</strong>，會得到 true or false</li><li>“&gt;&#x3D;” 大於等於</li><li>“&lt;&#x3D;” 小於等於</li><li>“!&#x3D;” 驚嘆號出現就是否定，不等於</li></ul><p>其實 Ruby 的等號很多時候不是等號!!<br><mark><strong>Ruby 裡面只有 nil 跟 false 是假的，其他都是真</strong></mark></p><h3 id="If-條件判斷-如果…不然就"><a href="#If-條件判斷-如果…不然就" class="headerlink" title="If 條件判斷 (如果…不然就)"></a>If 條件判斷 (如果…不然就)</h3><p>if 是我們條件的設定，後面可以透過 elsif 添加額外得條件，或是 else 直接設定前面的條件之外的條件都算</p><ul><li>注意： ruby 比較特別的是 elsif 不用寫”e”(英文應為 else if)。</li><li>注意：if 條件最後面需要加上 end 來表示這個邏輯判斷 block 的結束喔，後續的章節還會特別提到 block，可以先想像成這個區域內，裡面應用到的變數出去後就不能用了喔!</li></ul><h4 id="If"><a href="#If" class="headerlink" title="If"></a>If</h4><p>單一條件，且符合條件才會執行內容</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> weather == <span class="string">&quot;sunny&quot;</span></span><br><span class="line">  puts <span class="string">&quot;好天氣喔!&quot;</span> <span class="comment">#判斷等於&#x27;sunny&quot;就印出</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h4 id="if-…-else"><a href="#if-…-else" class="headerlink" title="if … else"></a>if … else</h4><p>二分法的方式</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> weather == <span class="string">&quot;sunny&quot;</span></span><br><span class="line">  puts <span class="string">&quot;好天氣喔!&quot;</span> <span class="comment">#判斷等於&#x27;sunny&quot;就印出</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  puts <span class="string">&quot;壞天氣啦!&quot;</span> <span class="comment">#其他條件都印這個</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h4 id="if…elsif…else-中間的-elsif-可以無限增加，剩餘的條件用-else"><a href="#if…elsif…else-中間的-elsif-可以無限增加，剩餘的條件用-else" class="headerlink" title="if…elsif…else (中間的 elsif 可以無限增加，剩餘的條件用 else)"></a>if…elsif…else (中間的 elsif 可以無限增加，剩餘的條件用 else)</h4><p>超過三種條件以上可以使用這種類型判斷</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">age = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> age &gt;= <span class="number">0</span> &amp;&amp; age&lt;=<span class="number">3</span></span><br><span class="line">  puts <span class="string">&quot;嬰兒&quot;</span> <span class="comment"># 年齡&gt;=0 且&lt;=3 就印</span></span><br><span class="line"><span class="keyword">elsif</span> age &gt;= <span class="number">4</span> &amp;&amp; age &lt;= <span class="number">10</span></span><br><span class="line">  puts <span class="string">&quot;兒童&quot;</span> <span class="comment"># 年齡&gt;=4 且&lt;=10 就印</span></span><br><span class="line"><span class="keyword">elsif</span> age &gt;= <span class="number">11</span> &amp;&amp; age&lt;=<span class="number">17</span></span><br><span class="line">  puts <span class="string">&quot;青少年&quot;</span> <span class="comment"># 年齡&gt;=11 且&lt;=17 就印</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  puts <span class="string">&quot;成年&quot;</span> <span class="comment">#上述以外的條件都印這個</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h4 id="容易搞混的邪惡分身們-evil-twins"><a href="#容易搞混的邪惡分身們-evil-twins" class="headerlink" title="容易搞混的邪惡分身們 evil twins"></a>容易搞混的邪惡分身們 evil twins</h4><ul><li>unless &#x3D; if not</li><li>If &#x3D; unless not<br>非英文母語的可能會覺得不直觀，所以使用哪種必須考慮程式碼可讀性!!</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unless</span> age &gt;=<span class="number">18</span></span><br><span class="line">  puts <span class="string">&quot;未成年&quot;</span> <span class="comment">#如果年齡沒有大於等於18 才印出</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="三元運算子"><a href="#三元運算子" class="headerlink" title="三元運算子"></a>三元運算子</h3><p>有些時候會這樣去撰寫，看似精簡，但可讀性比較差。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> age &gt;=<span class="number">18</span></span><br><span class="line">  status = <span class="string">&quot;成年&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  status = <span class="string">&quot;未成年&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"><span class="comment">#等同這樣的三元運算，用?前來表示if的條件，:前面則表示if的執行結果，後面表示else的執行結果</span></span><br><span class="line">status = (age&gt;=<span class="number">18</span>)? <span class="string">&quot;成年&quot;</span><span class="symbol">:<span class="string">&quot;未成年&quot;</span></span></span><br></pre></td></tr></table></figure><h3 id="case-when"><a href="#case-when" class="headerlink" title="case when"></a>case when</h3><p>利用這樣可以清楚地列出相關的條件，但其實這些都是 ruby 使用語法糖衣包裝過的 if..else</p><p>Ruby 的 Case when 可以用範圍的魔法喔!!</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">age = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">case</span> age</span><br><span class="line"><span class="keyword">when</span> <span class="number">0</span>..<span class="number">3</span></span><br><span class="line">  puts <span class="string">&quot;嬰兒&quot;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">4</span>..<span class="number">10</span></span><br><span class="line">  puts <span class="string">&quot;兒童&quot;</span></span><br><span class="line"><span class="keyword">when</span> <span class="number">11</span>..<span class="number">17</span></span><br><span class="line">  puts <span class="string">&quot;青少年&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  puts <span class="string">&quot;成年&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="常見錯誤，一個等號不是等於的判斷"><a href="#常見錯誤，一個等號不是等於的判斷" class="headerlink" title="常見錯誤，一個等號不是等於的判斷"></a>常見錯誤，一個等號不是等於的判斷</h3><p>很多新手會以為單個 “&#x3D;” 可以進行條件判斷，但這樣其實是代表<strong>指定</strong>。<br>可以看到下面的範例：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">score = <span class="number">95</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> age = <span class="number">100</span></span><br><span class="line">  puts <span class="string">&quot;滿分&quot;</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  puts <span class="string">&quot;未滿分&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>原本我們預期可以看到 95 分進去條件判斷應該是要印出未滿分，但最後卻印出滿分。是因為 if 那邊應該使用”&#x3D;&#x3D;”，不然會將 score 指定成 100，然後在 ruby 世界中指定這件事情回傳直就是內容本身，所以判斷後得到 true 就回傳”滿分”了。</p><p>以上就是基本的條件判斷在 Ruby 裡面的用法，要好好弄清楚，不管是在任何程式語言中都是相當重要的一環呢!</p><hr><p><strong>參考資料:</strong></p><ol><li><a href="https://railsbook.tw/chapters/05-ruby-basic-1#flow-control">為你自己學 Ruby on rails</a></li><li><a href="https://ihower.tw/rails/ruby.html">Rails 實戰聖經</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>到Ruby世界不可不認識：範圍</title>
      <link href="/2022/08/17/Ruby/%E5%88%B0Ruby%E4%B8%96%E7%95%8C%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AA%8D%E8%AD%98%EF%BC%9A%E7%AF%84%E5%9C%8D/"/>
      <url>/2022/08/17/Ruby/%E5%88%B0Ruby%E4%B8%96%E7%95%8C%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AA%8D%E8%AD%98%EF%BC%9A%E7%AF%84%E5%9C%8D/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><h2 id="範圍-Range"><a href="#範圍-Range" class="headerlink" title="範圍 Range"></a>範圍 Range</h2><p>範圍是最先讓我感受到 Ruby 神奇魔力的特殊用法，相比於其他的程式語言，這些範圍的用法真的讓一些運算上省事很多，今天就讓我們來認識一下這個特別的魔法吧!</p></div><h3 id="表示方法-“-”-“…”"><a href="#表示方法-“-”-“…”" class="headerlink" title="表示方法 “..” “…”"></a>表示方法 “..” “…”</h3><p>範圍顧名思義就是表示一段區間的表示法，在 ruby 可以用 “..” 或 “…” 的方式來表示<br>如 1-10 我們可以用 1..10，但記得要依序印出來不可以直接就用 p 直接印出 1..10，這樣可是會只有印出”1..10”，需要先轉成陣列，所以可以搭配 to_a 方法將範圍表示的東西轉成陣列。</p><p>如果不想用 to_a 轉成陣列，還有特別的 * 可以把範圍展開，配合陣列的[ ]放在內部，也有相同的效果</p><p>注意 .. 和 … 表示的範圍不同喔，..表示頭尾都包含，…不包含尾巴<br><strong>小小口訣：多一點少一點，少一點多一點</strong></p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 少一點多一點 (包含頭尾)</span></span><br><span class="line">puts (<span class="number">1</span>..<span class="number">10</span>).to_a <span class="comment"># 印出 1 ~ 10</span></span><br><span class="line"><span class="comment"># 多一點少一點 (不含尾)</span></span><br><span class="line">puts (<span class="number">1</span>...<span class="number">10</span>).to_a <span class="comment"># 印出 1 ~ 9</span></span><br><span class="line"><span class="comment"># * 可以展開範圍</span></span><br><span class="line">p *<span class="number">1</span>..<span class="number">10</span> <span class="comment"># 依序印出1~10</span></span><br><span class="line">p [*<span class="number">1</span>..<span class="number">10</span>] <span class="comment"># 印出 [1,2,3,4,5,6,7,8,9,10]</span></span><br></pre></td></tr></table></figure><h3 id="哪些東西可以使用"><a href="#哪些東西可以使用" class="headerlink" title="哪些東西可以使用?"></a>哪些東西可以使用?</h3><p>數值可以用感覺不稀奇，最令我覺得神奇的是英文字母 ruby 也可以透過範圍來表示呢!</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">1</span>..<span class="number">10</span>) <span class="comment"># 範圍 1 ~ 10</span></span><br><span class="line">(<span class="string">&quot;a&quot;</span>..<span class="string">&quot;z&quot;</span>) <span class="comment"># 範圍 a ~ z</span></span><br><span class="line">(<span class="string">&quot;A&quot;</span>..<span class="string">&quot;Z&quot;</span>) <span class="comment"># 範圍 A ~ Z</span></span><br></pre></td></tr></table></figure><h3 id="搭配陣列的一些方法讓我們更好做事"><a href="#搭配陣列的一些方法讓我們更好做事" class="headerlink" title="搭配陣列的一些方法讓我們更好做事"></a>搭配陣列的一些方法讓我們更好做事</h3><p>還記得之前提過的 map, select, reduce 之類的方法嗎? 這些都可以搭配範圍將程式碼很精簡的表示喔!</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># map 對範圍內每個數值做x+1處理後回傳陣列</span></span><br><span class="line">p [*<span class="number">1</span>..<span class="number">10</span>].map &#123; |<span class="params">x</span>| x+<span class="number">1</span>&#125; <span class="comment"># [2,3,4,5,6,7,8,9,10,11]</span></span><br><span class="line">p (<span class="number">1</span>..<span class="number">10</span>).to_a.map &#123; |<span class="params">x</span>| x+<span class="number">1</span>&#125; <span class="comment"># 效果同上</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字母也可以用大小來判斷呢，想像每個英文字母依照順序是有大小之分，越後面數值越大。 select可以挑選符合條件的元素形成陣列回傳</span></span><br><span class="line">p (<span class="string">&quot;a&quot;</span>..<span class="string">&quot;g&quot;</span>).to_a.select &#123; |<span class="params">chars</span>| chars &lt; <span class="string">&quot;c&quot;</span>&#125; <span class="comment"># 取出小於&quot;c&quot; 的就會得到 [&quot;a&quot;,&quot;b&quot;]</span></span><br></pre></td></tr></table></figure><p>甚至可以用來取出陣列中的值喔，注意數字所代表的是陣列的索引喔。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pokemon = [<span class="string">&quot;皮卡丘&quot;</span>,<span class="string">&quot;傑尼龜&quot;</span>,<span class="string">&quot;妙蛙種子&quot;</span>,<span class="string">&quot;小火龍&quot;</span>]</span><br><span class="line">p pokemon[<span class="number">1</span>..<span class="number">2</span>] <span class="comment"># [&quot;傑尼龜&quot;,&quot;妙蛙種子&quot;] =&gt;取出索引1~2的元素</span></span><br></pre></td></tr></table></figure><h3 id="小小挑戰：請計算從-1-加到-100-的總和"><a href="#小小挑戰：請計算從-1-加到-100-的總和" class="headerlink" title="小小挑戰：請計算從 1 加到 100 的總和"></a>小小挑戰：請計算從 1 加到 100 的總和</h3><p>如果大家記得之前我們提過可以使用 reduce 的方法處理陣列的加總，你應該知道這樣的問題要怎麼回答吧。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sum = (<span class="number">1</span>..<span class="number">100</span>).to_a.reduce&#123;|<span class="params">sum, x</span>| sum + x&#125;</span><br><span class="line"><span class="comment"># sum = [*1..100].reduce(:+) # 這種特殊的方法更簡短，冒號後面可以套用其他運算符號(+ - x /)</span></span><br><span class="line">puts sum <span class="comment"># 5050</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#黑魔法來了，可以用sum方法，可以直接針對範圍內的數值加總</span></span><br><span class="line">puts (<span class="number">1</span>..<span class="number">100</span>).sum</span><br></pre></td></tr></table></figure><p>了解了範圍用法之後，我們可以實際應用在很多陣列的地方喔，好好的善用 Ruby 賜與我們的神奇魔法吧!!</p><hr><p><strong>參考資料:</strong></p><ol><li><a href="https://railsbook.tw/chapters/06-ruby-basic-2#range_class">為你自己學 Ruby on rails</a></li><li><a href="https://ruby-doc.org/core-3.1.2/Range.html">Ruby Docs - Range</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>到Ruby世界不可不認識：雜湊</title>
      <link href="/2022/08/14/Ruby/%E5%88%B0Ruby%E4%B8%96%E7%95%8C%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AA%8D%E8%AD%98%EF%BC%9A%E9%9B%9C%E6%B9%8A/"/>
      <url>/2022/08/14/Ruby/%E5%88%B0Ruby%E4%B8%96%E7%95%8C%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AA%8D%E8%AD%98%EF%BC%9A%E9%9B%9C%E6%B9%8A/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><h2 id="雜湊-Hash"><a href="#雜湊-Hash" class="headerlink" title="雜湊 Hash"></a>雜湊 Hash</h2><p>這是個類似陣列的容器型資料型態，裡面的資料是一組一組相互對應，我們會稱為 <strong>key</strong> 跟 <strong>value</strong>，與陣列不同的是，這裡面沒有排序，不能透過[索引]方式取出內容，且用大括號包起來。</p></div><p>Hash 有以下的幾個特色：</p><ul><li>keys 和 values 可以由任意 object 組成</li><li>keys 的值不可重複</li><li>values，是對應 keys 的物件，值可以重複</li></ul><p>最容易想像的資料型態就像學生的成績紀錄，如同下面的表示，name 和 score 都是這個 hash 的 key，可以想像成一個而主要的標題，分別對應的內容就是’Sean’, 100 這兩個值。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">student_score = &#123; <span class="symbol">name:</span> <span class="string">&#x27;Sean&#x27;</span>, <span class="symbol">score:</span> <span class="number">100</span> &#125;</span><br><span class="line"></span><br><span class="line">list = &#123;<span class="symbol">:name</span> =&gt; <span class="string">&quot;Sean&quot;</span>, <span class="symbol">:name</span> =&gt; <span class="string">&quot;Tom&quot;</span>&#125; <span class="comment">#出錯，不能重複指定key</span></span><br></pre></td></tr></table></figure><h3 id="表示方法"><a href="#表示方法" class="headerlink" title="表示方法"></a>表示方法</h3><ul><li>舊式 (符號箭頭)</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profile = &#123; <span class="symbol">:name</span> =&gt; <span class="string">&#x27;Sean&#x27;</span>, <span class="symbol">:age</span> =&gt; <span class="number">20</span> &#125;</span><br></pre></td></tr></table></figure><ul><li>新式 (Ruby 1.9 之後的新式寫法)</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">profile = &#123; <span class="symbol">name:</span> <span class="string">&#x27;Sean&#x27;</span>, <span class="symbol">age:</span> <span class="number">20</span> &#125;</span><br></pre></td></tr></table></figure><h3 id="存取資料內容"><a href="#存取資料內容" class="headerlink" title="存取資料內容"></a>存取資料內容</h3><h4 id="拿取資料"><a href="#拿取資料" class="headerlink" title="拿取資料"></a>拿取資料</h4><ul><li>寫過別的程式語言可能會直覺想用字串(“”)的方式拿取，但是沒辦法，<strong>記得要用:符號來拿喔!!</strong></li><li>不過 rails 環境中有特別擴充可以用字串方式去拿</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">profile = &#123; <span class="symbol">name:</span> <span class="string">&#x27;Sean&#x27;</span>, <span class="symbol">age:</span> <span class="number">20</span> &#125;</span><br><span class="line"><span class="comment"># 取得name的value</span></span><br><span class="line">puts profile[<span class="string">&quot;name&quot;</span>] <span class="comment"># nil</span></span><br><span class="line">puts profile[<span class="symbol">:name</span>] <span class="comment"># Sean</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取得age的value</span></span><br><span class="line">puts profile[<span class="string">&quot;age&quot;</span>] <span class="comment"># nil</span></span><br><span class="line">puts profile[<span class="symbol">:age</span>] <span class="comment"># 20</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#拿取全部的keys or values</span></span><br><span class="line">profile.keys <span class="comment">#拿取所有key =&gt; name,age</span></span><br><span class="line">profile.values <span class="comment">#拿取所有value =&gt; &quot;Sean&quot;,20</span></span><br></pre></td></tr></table></figure><h4 id="存入資料"><a href="#存入資料" class="headerlink" title="存入資料"></a>存入資料</h4><ul><li>用符號的方式並且指定 value 給 hash</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">character = &#123; <span class="symbol">name:</span> <span class="string">&#x27;warrier&#x27;</span>, <span class="symbol">age:</span> <span class="number">20</span> &#125;</span><br><span class="line">character[<span class="symbol">:power</span>] = <span class="number">100</span></span><br><span class="line">p character <span class="comment">#&#123;:name=&gt;&quot;warrier&quot;, :age=&gt;20, :power=&gt;100&#125;</span></span><br></pre></td></tr></table></figure><h4 id="長度"><a href="#長度" class="headerlink" title="長度"></a>長度</h4><p>可以用 length 或 size 找到內部有幾組 key 和 value</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">profile = &#123;<span class="symbol">name:</span> <span class="string">&quot;Sean&quot;</span>, <span class="symbol">age:</span> <span class="number">25</span>, <span class="symbol">power:</span><span class="number">100</span>, <span class="symbol">ability:</span> <span class="string">&quot;Ruby&quot;</span>&#125;</span><br><span class="line">p profile.length <span class="comment"># 4</span></span><br><span class="line">p h1.size <span class="comment"># 4</span></span><br></pre></td></tr></table></figure><hr><p><strong>參考資料:</strong></p><ol><li><a href="https://railsbook.tw/chapters/06-ruby-basic-2#hash_class">為你自己學 Ruby on rails</a></li><li><a href="https://ruby-doc.org/core-3.1.2/Hash.html">Ruby Docs - Hash</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>到Ruby世界不可不認識：符號</title>
      <link href="/2022/08/14/Ruby/%E5%88%B0Ruby%E4%B8%96%E7%95%8C%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AA%8D%E8%AD%98%EF%BC%9A%E7%AC%A6%E8%99%9F/"/>
      <url>/2022/08/14/Ruby/%E5%88%B0Ruby%E4%B8%96%E7%95%8C%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AA%8D%E8%AD%98%EF%BC%9A%E7%AC%A6%E8%99%9F/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><h2 id="符號-Symbol"><a href="#符號-Symbol" class="headerlink" title="符號 Symbol"></a>符號 Symbol</h2><p>符號也是一個 Ruby 特有的資料型態，很多剛從別的程式語言進來的朋友，剛開始比較難習慣這樣的東西。連原本寫 ruby 的可能都不見得解釋得清楚，但我會努力整理清楚我對這個資料的認知給大家。</p></div><h2 id="命名及定義"><a href="#命名及定義" class="headerlink" title="命名及定義"></a>命名及定義</h2><ul><li>符號 &#x3D; 有名字的物件</li><li>命名規則類似變數，是以用英文字母或數字的組合</li><li>例如<code>:name</code>, <code>:class</code>, <code>:名字</code>, <code>:類別</code>，要在中間加上空白也沒問題。但大多還是以英文字母的組合為主。</li></ul><blockquote><p><strong>常跟字串搞混：</strong></p><ul><li>字串可以被改變，符號不行</li><li>兩者都是一種物件(值)，都可以被變數指向</li></ul></blockquote><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">:name</span> = <span class="string">&quot;Sean&quot;</span> <span class="comment"># 出錯</span></span><br><span class="line"><span class="string">&quot;name&quot;</span> = <span class="string">&quot;Jack&quot;</span> <span class="comment"># 出錯</span></span><br><span class="line">name1 = <span class="number">123</span> <span class="comment"># 變數指向數字</span></span><br><span class="line">name2 = <span class="string">&quot;Jeff&quot;</span> <span class="comment"># 變數指向字串</span></span><br><span class="line">name3 = <span class="symbol">:Steve</span> <span class="comment"># 變數指向符號</span></span><br></pre></td></tr></table></figure><h2 id="實際使用"><a href="#實際使用" class="headerlink" title="實際使用"></a>實際使用</h2><p>可能你會問，為什麼需要這樣的類型，那不是就用字串就好，但實際上這兩種類型效能有差別，<strong>符號執行的效能上比較好一些，我們會在 rails 開發中大量使用。</strong></p><p>效能的比較可以透過查詢他的記憶體位置(.object_id)來得知，符號都是存在一樣的記憶體位置，第一次已經找到，第二次要用就直接從記憶體拿，而字串卻是每次呼叫都是不同的，所以符號會比較節省。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">puts <span class="string">&quot;hello&quot;</span>.object_id <span class="comment"># 印 720</span></span><br><span class="line">puts <span class="string">&quot;hello&quot;</span>.object_id <span class="comment"># 印 740</span></span><br><span class="line">puts <span class="string">&quot;hello&quot;</span>.object_id <span class="comment"># 印 760</span></span><br><span class="line"></span><br><span class="line">puts <span class="symbol">:hello</span>.object_id <span class="comment"># 印 1920348</span></span><br><span class="line">puts <span class="symbol">:hello</span>.object_id <span class="comment"># 印 1920348</span></span><br><span class="line">puts <span class="symbol">:hello</span>.object_id <span class="comment"># 印 1920348</span></span><br></pre></td></tr></table></figure><h3 id="符號跟字串的轉換"><a href="#符號跟字串的轉換" class="headerlink" title="符號跟字串的轉換"></a>符號跟字串的轉換</h3><ul><li>符號轉字串<ul><li>to_sym</li><li>intern</li><li>%s</li></ul></li><li>字串轉符號<ul><li>to_s</li></ul></li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  to_sym 可把字串轉成 symbol</span></span><br><span class="line"><span class="meta prompt_">&gt;&gt;</span> <span class="string">&quot;Sean&quot;</span>.to_sym</span><br><span class="line">=&gt; <span class="symbol">:Sean</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 和to_sym 是一樣的效果</span></span><br><span class="line"><span class="meta prompt_">&gt;&gt;</span> <span class="string">&quot;Jack&quot;</span>.intern</span><br><span class="line">=&gt; <span class="symbol">:Jack</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可用 %s 來做轉換</span></span><br><span class="line"><span class="meta prompt_">&gt;&gt;</span> %s(name)</span><br><span class="line">=&gt; <span class="symbol">:name</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用 to_s 方法可以把 symbol 轉成字串</span></span><br><span class="line"><span class="meta prompt_">&gt;&gt;</span> <span class="symbol">:name</span>.to_s</span><br><span class="line">=&gt; <span class="string">&quot;name&quot;</span></span><br></pre></td></tr></table></figure><h3 id="該選符號還是字串"><a href="#該選符號還是字串" class="headerlink" title="該選符號還是字串?"></a>該選符號還是字串?</h3><p>像這樣的問題，其實上面已經整理出答案瞜!</p><blockquote><ul><li>不需要改變的 &#x3D;&gt; 符號 (ex: hash 的 key)</li><li>要改變的 &#x3D;&gt; 字串 (ex: 印出一些名稱)</li></ul></blockquote><p>但也會視情況調整，像是符號就沒辦法使用許多好用的方法，字串就可以。</p><p>最普遍看到的符號就是在雜湊 (Hash) 的 key ，因為符號是不會被改變，且查找比較的速度快，會大量用在 hash 中。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># :name, :age都是Hash中的key</span></span><br><span class="line">info = &#123;<span class="symbol">:name=&gt;<span class="string">&quot;Sean&quot;</span></span>, <span class="symbol">:age=&gt;</span><span class="number">20</span>&#125;</span><br></pre></td></tr></table></figure><p>以上就是我目前整理對於符號相關的重點，下一篇節我們就會討論 Hash 是甚麼喔，請大家好好期待一下!</p><hr><p><strong>參考資料:</strong></p><ol><li><a href="https://railsbook.tw/chapters/06-ruby-basic-2#hash_class">為你自己學 Ruby on rails</a></li><li><a href="https://ruby-doc.org/core-3.1.2/Symbol.html">Ruby Docs - Symbol</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>到Ruby世界不可不認識：陣列</title>
      <link href="/2022/08/13/Ruby/%E5%88%B0Ruby%E4%B8%96%E7%95%8C%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AA%8D%E8%AD%98%EF%BC%9A%E9%99%A3%E5%88%97/"/>
      <url>/2022/08/13/Ruby/%E5%88%B0Ruby%E4%B8%96%E7%95%8C%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AA%8D%E8%AD%98%EF%BC%9A%E9%99%A3%E5%88%97/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><h2 id="陣列-Array"><a href="#陣列-Array" class="headerlink" title="陣列 Array"></a>陣列 Array</h2><p>陣列是每個程式語言很常碰到的資料型態，你可以想像前面講過的字串、數字通通可以塞進一個容器裡面，必且依照順序的排好，所以陣列最特別的是，<strong>有順序且是一堆資料的集合</strong>，在程式的世界裡常用這樣的方式來儲存資料，因此衍伸出許多特別的方法來處理這類型的資料，讓我們可以輕鬆拿到其中想要的內容。</p></div><h3 id="建立陣列"><a href="#建立陣列" class="headerlink" title="建立陣列"></a>建立陣列</h3><p>可以透過直接指定的方式，或是藉由 ruby 特殊的%w 方式建立，但要注意這種方式所產生的內容都是字串。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">list = [<span class="string">&quot;apple&quot;</span>,<span class="string">&quot;bird&quot;</span>,<span class="string">&quot;哈樓&quot;</span>, <span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">list = <span class="string">%w(apple bird 哈樓 1 2)</span> <span class="comment"># [&quot;apple&quot;,&quot;bird&quot;,&quot;哈樓&quot;, &quot;1&quot;, &quot;2&quot;] =&gt; 用這種方式會產生的 &quot;1&quot;,&quot;2&quot; 是字串</span></span><br></pre></td></tr></table></figure><h3 id="拿出陣列內的元素-x2F-長度"><a href="#拿出陣列內的元素-x2F-長度" class="headerlink" title="拿出陣列內的元素&#x2F;長度"></a>拿出陣列內的元素&#x2F;長度</h3><p>要拿到內部的元素，我們可以透過 [索引] 的方式來取得，其中索引依照順序是從 0 開始算，<br>像是下面的例子可以看到 [0] 是代表取出第 1 個，而 [1] 則是第 2 個，以此類推，比較特別的是負數是表示從最後面開始算，所以 [-1] 表示最後 1 個。</p><p>我們可以透過 array.length 的方式知道其中內部含有幾個元素。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">pokemon = [<span class="string">&quot;皮卡丘&quot;</span>,<span class="string">&quot;傑尼龜&quot;</span>,<span class="string">&quot;妙蛙種子&quot;</span>,<span class="string">&quot;小火龍&quot;</span>]</span><br><span class="line">puts pokemon[<span class="number">0</span>] <span class="comment"># 印出 皮卡丘</span></span><br><span class="line">puts pokemon[<span class="number">1</span>] <span class="comment"># 印出 傑尼龜</span></span><br><span class="line">puts pokemon[-<span class="number">1</span>] <span class="comment"># 印出 小火龍</span></span><br><span class="line">puts pokemon[-<span class="number">2</span>] <span class="comment"># 印出 妙蛙種子</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以用first和last取出頭或尾，</span></span><br><span class="line">puts pokemon.first <span class="comment"># 印出 皮卡丘</span></span><br><span class="line">puts pokemon.last <span class="comment"># 印出 小火龍</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># length表示陣列的長度</span></span><br><span class="line">puts pokemon.length <span class="comment"># 印出 4</span></span><br><span class="line">pokemon &lt;&lt; <span class="string">&#x27;小智&#x27;</span> <span class="comment"># 在最後⾯加入</span></span><br><span class="line">puts pokemon.length <span class="comment"># 印出 5</span></span><br><span class="line">pokemon.push(<span class="string">&#x27;小霞&#x27;</span>) <span class="comment"># 最後面加入</span></span><br><span class="line">puts pokemon.length <span class="comment"># 印出 6</span></span><br><span class="line">puts pokemon <span class="comment"># 經過上面處理印出 皮卡丘, 傑尼龜, 妙蛙種子, 小火龍, 小智, 小霞</span></span><br></pre></td></tr></table></figure><h3 id="好用方法"><a href="#好用方法" class="headerlink" title="好用方法"></a>好用方法</h3><p>和許多程式語言一樣，ruby 在處理陣列的資料類型中也可以透過許多方便的方法來進行處理。</p><h4 id="map"><a href="#map" class="headerlink" title="map"></a>map</h4><ul><li>可以對陣列裡的每個元素進行操作，並收集成一個新的陣列。</li><li>|x|表示內部的每個元素，所以這個 x 可以自己改變名字，後面可以寫下對每個元素進行的操作或運算處理。</li></ul><p>同意詞：collect</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">p a.map &#123; |<span class="params">x</span>| x*<span class="number">2</span> &#125;</span><br><span class="line"><span class="comment"># 印出 [2, 4, 6]</span></span><br></pre></td></tr></table></figure><h4 id="select"><a href="#select" class="headerlink" title="select"></a>select</h4><ul><li>從陣列裡挑選符合條件的元素，並收集成一個新的陣列。</li><li>|x|表示內部的每個元素，所以這個 x 可以自己改變名字，後面可以寫下選取的條件。<br>同意詞：filter<br>反意詞：reject</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]</span><br><span class="line">p a.select &#123; |<span class="params">x</span>| x &lt; <span class="number">5</span> &#125;</span><br><span class="line"><span class="comment"># 印出 [1, 2, 3, 4]</span></span><br></pre></td></tr></table></figure><h4 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h4><ul><li>對陣列內的每個元素進行運算，並將所有的運算結果歸納成一個單一結果。</li><li>括號內的第一個參數表示累加值(範例使用 sum)，預設沒特別指定的話就是 0，第 2 個參數表示當前的元素(範例使用 n)，當前元素會依續代入陣列內數值並依照運算指示，所以下面例子中 sum 會與陣列內每個數字 n 相加，最後回傳就變成將陣列內所有數字加總的數值。<br>同意詞：inject</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>]</span><br><span class="line">p a.reduce &#123; |<span class="params">sum, n</span>| sum + n &#125;</span><br><span class="line"><span class="comment"># 印出 55</span></span><br></pre></td></tr></table></figure><hr><p><strong>參考資料:</strong></p><ol><li><a href="https://railsbook.tw/chapters/06-ruby-basic-2">為你自己學 Ruby on rails</a></li><li><a href="https://ruby-doc.org/core-3.1.2/Array.html">Ruby Docs - Array</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>到Ruby世界不可不認識：變數、數字、字串</title>
      <link href="/2022/08/12/Ruby/%E5%88%B0Ruby%E4%B8%96%E7%95%8C%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AA%8D%E8%AD%98%EF%BC%9A%E8%AE%8A%E6%95%B8%E3%80%81%E6%95%B8%E5%AD%97%E3%80%81%E5%AD%97%E4%B8%B2/"/>
      <url>/2022/08/12/Ruby/%E5%88%B0Ruby%E4%B8%96%E7%95%8C%E4%B8%8D%E5%8F%AF%E4%B8%8D%E8%AA%8D%E8%AD%98%EF%BC%9A%E8%AE%8A%E6%95%B8%E3%80%81%E6%95%B8%E5%AD%97%E3%80%81%E5%AD%97%E4%B8%B2/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><h2 id="變數、數字、字串"><a href="#變數、數字、字串" class="headerlink" title="變數、數字、字串"></a>變數、數字、字串</h2><p>程式語言的世界由許多種不同類型的資料型態構成，讓我們可以在進行撰寫時針對不同的情況做選擇，今天讓我們來認識基本的幾種類型吧!</p></div><h3 id="變數-Variable"><a href="#變數-Variable" class="headerlink" title="變數 Variable"></a>變數 Variable</h3><h4 id="變數指定與使用"><a href="#變數指定與使用" class="headerlink" title="變數指定與使用"></a>變數指定與使用</h4><p>變數可以想像成一個標籤，可以貼在各種類型的資料上面，如數字、字串、陣列等，而變數本身沒有型態，被貼上後就成了指定東西的型態。</p><p>通常在程式語言中 “&#x3D;” 並不是大家想的等於，而是<mark>指定</mark>的意思，被指定過的變數還是可以再指定成別的資料。</p><p>在 Ruby 中變數有以下的特性：</p><blockquote><ul><li>使用不須宣告或指定型態，可以直接拿來使用</li><li>可以重複被指定</li><li>命名使用英文字母、數字或底線的組合、或是非英文字母也可以</li><li>常數</li></ul></blockquote><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 變數指定</span></span><br><span class="line">name = <span class="string">&quot;Sean&quot;</span></span><br><span class="line">s = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#指定多個變數</span></span><br><span class="line">a,b,c = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">puts name <span class="comment"># 印出 Sean</span></span><br><span class="line">puts s <span class="comment"># 印出 1</span></span><br><span class="line">puts a,c <span class="comment"># 印出 1, 3</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="常數定義"><a href="#常數定義" class="headerlink" title="常數定義"></a>常數定義</h4><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Food = “rice”</span><br><span class="line">Drink= “coke”</span><br></pre></td></tr></table></figure><p>在 Ruby 比較特別的是常數可被修改，會出現警告訊息，但就只是警告而已，不是錯誤訊息，程式仍可正常執行，以大寫開頭命名。</p><div class="note info no-icon modern"><h4 id="補充：常數跟變數有甚麼不同"><a href="#補充：常數跟變數有甚麼不同" class="headerlink" title="補充：常數跟變數有甚麼不同?"></a>補充：常數跟變數有甚麼不同?</h4><ul><li>值都可以被修改，變數命名沒有限制，常數開頭用大寫字母命名。</li><li>避免使用關鍵字與保留字命名(Keyword &amp; reserved word) ex: if、else、end、then、class、and、begin、do、or……</li></ul></div><h3 id="字串-String"><a href="#字串-String" class="headerlink" title="字串 String"></a>字串 String</h3><p>通常以引號包住，可使用單引號或雙引號，可以包任何字元、數字，都可以成為字串。</p><ul><li>用單引號或雙引號包住<ul><li>‘string’ 單引號 (注意用這個不能配合變數帶入#{variable}，或是內部有其他單引號出現會失效)</li><li>“string” 雙引號</li></ul></li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p <span class="string">&quot;hello world&quot;</span></span><br><span class="line">p <span class="string">&#x27;hello world&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>%Q &amp; %q<ul><li>%Q 等同雙引號</li><li>%q 等同單引號</li></ul></li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">p %Q (hello world) <span class="comment"># 印出 &quot;hello world&quot;</span></span><br><span class="line">p %q (hello world) <span class="comment"># 印出 &#x27;hello world&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>字串安插（String Interpolation），將字串中帶入變數，非常好用。</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&quot;Sean&quot;</span></span><br><span class="line">age = <span class="number">18</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">&quot;I&#x27;m <span class="subst">#&#123;name&#125;</span>, and I am <span class="subst">#&#123;age&#125;</span> years old&quot;</span> <span class="comment"># I&#x27;m Sean, and I am 18 years old</span></span><br><span class="line">puts <span class="string">&#x27;I&#x27;</span>m <span class="comment">#&#123;name&#125;, and I am #&#123;age&#125; years old&#x27; # 單引號中間又有單引號會失效</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">%Q(I&#x27;m <span class="subst">#&#123;name&#125;</span>, and I am <span class="subst">#&#123;age&#125;</span> years old)</span> <span class="comment"># I&#x27;m Sean, and I am 18 years old</span></span><br><span class="line">puts <span class="string">%q(I&#x27;m <span class="subst">#&#123;name&#125;</span>, and I am <span class="subst">#&#123;age&#125;</span> years old)</span> <span class="comment"># 同單引號會失效</span></span><br></pre></td></tr></table></figure><ul><li>字串可以看成是許多字元的組合，在 Ruby 的字串可已透過索引方式找到其中的字元 (字排序的索引從 0 開始算)。</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">say_hi = <span class="string">&quot;hello world&quot;</span></span><br><span class="line"></span><br><span class="line">puts say_hi[<span class="number">0</span>] <span class="comment"># =&gt; 印出 h</span></span><br><span class="line">puts say_hi[<span class="number">5</span>] <span class="comment"># =&gt; 印出 空白 (注意空格也是字元)</span></span><br><span class="line"></span><br><span class="line">say_hi[<span class="number">0</span>..<span class="number">5</span>] = <span class="string">&quot;Hi!&quot;</span> <span class="comment">#(把第0位到第5位字元重新指定，中間的..是範圍的用法)</span></span><br><span class="line">puts say_hi    <span class="comment"># =&gt; Hi! World</span></span><br></pre></td></tr></table></figure><h3 id="數字-Number"><a href="#數字-Number" class="headerlink" title="數字 Number"></a>數字 Number</h3><p>任何數字組成包含整數(Integer)、小數(Float)都可以算是一種類別，Ruby 裡，整數數值其實就只是 Integer 這個類別的一個實體（instance）而已，小數也是以此類推，後續物件導向部分會再補充。</p><h4 id="運算使用"><a href="#運算使用" class="headerlink" title="運算使用"></a>運算使用</h4><ul><li>使用加減乘除 + - * &#x2F;</li><li>% 取餘數</li><li>使用這些運算符號其實也是在使用方法</li><li>運算碰到有小數點要特別注意，有用到小數點結果就會有小數點</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">puts <span class="number">1</span>+<span class="number">2</span>*(<span class="number">5</span>-<span class="number">3</span>) <span class="comment"># 先處理括號內，由左至右先乘除後加減 = 5</span></span><br><span class="line">puts <span class="number">10</span>/<span class="number">3</span>   <span class="comment">#整數除整數等於整數 = 3</span></span><br><span class="line">puts <span class="number">10.0</span>/<span class="number">3</span> <span class="comment">#小數除以整數等於小數 = 3.33333</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 實際上的運算符號的方法運作</span></span><br><span class="line">puts <span class="number">1</span> + <span class="number">1</span></span><br><span class="line">puts <span class="number">1</span>.+(<span class="number">1</span>) <span class="comment"># 結果同上，其實.+是一個方法後面是參數帶入，其他四則運算也相同</span></span><br></pre></td></tr></table></figure><h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><p>Ruby 有許多特別的數字方法可以直接使用，與其他程式語言不同，因為數字在 ruby 中也是一種物件，有特別設計給數字物件的方法。</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">puts <span class="number">5.4</span>.round <span class="comment"># 轉成整數，四捨五入 =&gt; 5</span></span><br><span class="line">puts <span class="number">3.65</span>.floor <span class="comment"># 轉成整數，無條件捨去 =&gt; 3</span></span><br><span class="line">puts <span class="number">3.14</span>.ceil  <span class="comment"># 轉成整數，無條件進位 =&gt; 4</span></span><br><span class="line">puts <span class="number">3.14</span>.to_i  <span class="comment"># 轉成整數，無條件捨去 =&gt; 3</span></span><br></pre></td></tr></table></figure><p>判斷資料類別可以用.class</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">name = <span class="string">&quot;Sean&quot;</span></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">p name.<span class="keyword">class</span> <span class="comment"># String 表示字串類型</span></span><br><span class="line">p a.<span class="keyword">class</span> <span class="comment"># Integer 表示數字類型中的整數</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果再往上找 class 會找到?</span></span><br><span class="line">p Integer.<span class="keyword">class</span> <span class="comment"># Class</span></span><br><span class="line">p String.<span class="keyword">class</span> <span class="comment"># Class</span></span><br></pre></td></tr></table></figure><hr><p><strong>參考資料:</strong></p><ol><li><a href="https://railsbook.tw/chapters/06-ruby-basic-2">為你自己學 Ruby on rails</a></li><li><a href="https://ruby-doc.org/core-3.1.2/String.html">Ruby Docs - String</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>進入Ruby世界記得說 “hello world”</title>
      <link href="/2022/08/12/Ruby/%E9%80%B2%E5%85%A5Ruby%E4%B8%96%E7%95%8C%E8%A8%98%E5%BE%97%E8%AA%AA%20%E2%80%9Chello-world%E2%80%9D/"/>
      <url>/2022/08/12/Ruby/%E9%80%B2%E5%85%A5Ruby%E4%B8%96%E7%95%8C%E8%A8%98%E5%BE%97%E8%AA%AA%20%E2%80%9Chello-world%E2%80%9D/</url>
      
        <content type="html"><![CDATA[<div class="note simple"><h2 id="Hello-World"><a href="#Hello-World" class="headerlink" title="Hello World"></a>Hello World</h2><p>剛開始學一個程式語言通常都會要你先想辦法印出 “hello world”，主要是能夠把目前程式執行的狀態或是結果呈現出來，確認我們的程式碼以及環境能夠正常執行。</p></div><p>至於實際為什麼是印出 hello world 這兩個字可以參考 <a href="https://ottaster.com/hello-world/">Hello World 程式是什麼意思？這 1 篇講解由來與原因</a></p><hr><p>初學者可以使用的 Ruby 編輯器 <a href="https://replit.com/">Replit</a></p><h2 id="印出字串"><a href="#印出字串" class="headerlink" title="印出字串"></a>印出字串</h2><p>主要有三種方式，比較常見的為第 2-3 種</p><ul><li>print ：印出字，不含換行 (視覺效果差，較少用，<del>加上是其他程式語言使用的，不夠 Ruby</del>)</li><li>puts ： 印出字，含換行</li><li>p ： 印出字及引號，含換行，可以藉此來判斷目前印的完整狀態 (是否有逗號、括號、引號等等)</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 印出 Hello, World</span></span><br><span class="line">print <span class="string">&quot;Hello, World&quot;</span></span><br><span class="line"><span class="comment"># 印出 Hello, World 字樣，並在結尾加上換⾏</span></span><br><span class="line">puts <span class="string">&quot;Hello, World&quot;</span></span><br><span class="line"><span class="comment"># 印出 &quot;Hello, World&quot; 字樣（含雙引號），並在結尾加上換⾏</span></span><br><span class="line">p <span class="string">&quot;Hello, World&quot;</span></span><br></pre></td></tr></table></figure><h2 id="註解"><a href="#註解" class="headerlink" title="註解"></a>註解</h2><ul><li>通常會將不需要被運行的註解，也可以用來補充說明程式碼。</li><li>註解的部分是不會被運行，在 Ruby 裡面會用到的註解方式主要使用 # 字號。</li><li>也可以用 &#x3D;begin ….. &#x3D;end 把多行進行註解。</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># puts &quot;hello, world&quot;</span></span><br><span class="line">  puts <span class="string">&quot;hello, world&quot;</span> <span class="comment"># 印出 &quot;hello, world&quot;</span></span><br><span class="line"><span class="comment"># 這是單⾏註解</span></span><br><span class="line">  我沒被註解到</span><br><span class="line"></span><br><span class="line"><span class="comment">=begin</span></span><br><span class="line"><span class="comment">puts &quot;hello, world&quot;</span></span><br><span class="line"><span class="comment">這是多⾏註解</span></span><br><span class="line"><span class="comment">puts &quot;hello&quot;</span></span><br><span class="line"><span class="comment">這是多⾏註解</span></span><br><span class="line"><span class="comment">=end</span></span><br><span class="line">puts <span class="string">&quot;hello, world&quot;</span></span><br></pre></td></tr></table></figure><h2 id="撰寫的風格"><a href="#撰寫的風格" class="headerlink" title="撰寫的風格"></a>撰寫的風格</h2><ul><li>縮排：空 2 格縮排，其他程式語言習慣可能是 4 格。</li><li>命名方式：蛇式 snake_case ，會用底線隔開個別單字，像是把變數或是一些方法命名為 new_number, say_hello_to_you 等等。</li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">say_hello_to_you</span></span><br><span class="line">puts <span class="string">&quot;hi, 你好啊!&quot;</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><hr><p><strong>參考資料:</strong></p><ol><li><a href="https://railsbook.tw/chapters/05-ruby-basic-1">為你自己學 Ruby on rails</a></li></ol>]]></content>
      
      
      <categories>
          
          <category> Ruby基礎 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Ruby </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
